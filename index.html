<!doctype html>
<html lang="id" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Expense Tracker — Aplikasi tracking pengeluaran uang harian dengan penyimpanan lokal."
    />
    <title>Expense Tracker — Tracking Pengeluaran</title>
    <meta name="theme-color" content="#0f766e" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/svg+xml" href="assets/icon.svg" />
    <link rel="apple-touch-icon" href="assets/icon.svg" />
    <link rel="manifest" href="manifest.json" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
/* ===========================
   CSS Variables & Reset
   =========================== */
:root {
  --primary-500: var(--clr-teal-700);
  --primary-600: var(--clr-teal-800);
  --success-500: var(--clr-teal-700-v2);
  --danger-500: var(--clr-red-500);
  --danger-600: var(--clr-red-600);
  --neutral-0: var(--clr-white-50);
  --neutral-50: var(--clr-sky-50);
  --neutral-100: var(--clr-sky-50-v2);
  --neutral-200: var(--clr-sky-100);
  --neutral-300: var(--clr-sky-200);
  --neutral-500: var(--clr-sky-600);
  --neutral-700: var(--clr-sky-800);
  --neutral-900: var(--clr-blue-950);
  --space-1: 8px;
  --space-2: 16px;
  --space-3: 24px;
  --space-4: 32px;
  --radius-sm: 12px;
  --radius-md: 16px;
  --radius-lg: 24px;
  --shadow-low: 0 2px 8px var(--clr-ink-950-a04);
  --shadow-medium: 0 4px 20px var(--clr-ink-950-a06);
  --font-size-lg: 1.25rem;
  --font-size-md: 1rem;
  --font-size-sm: 0.875rem;
  --line-height-base: 1.5;
  --line-height-tight: 1.2;
  --clr-bg: var(--neutral-100);
  --clr-surface: var(--neutral-0);
  --clr-surface-solid: var(--neutral-0);
  --clr-surface-hover: var(--neutral-50);
  --clr-border: var(--clr-slate-100);
  --clr-border-subtle: var(--clr-sky-50-v3);
  --clr-text: var(--neutral-900);
  --clr-text-secondary: var(--neutral-500);
  --clr-primary: var(--primary-500);
  --clr-primary-hover: var(--primary-600);
  --clr-primary-light: var(--clr-green-100);
  --clr-danger: var(--danger-500);
  --clr-danger-hover: var(--danger-600);
  --clr-danger-light: var(--clr-red-100);
  --clr-accent: var(--clr-sky-700);
  --clr-accent-hover: var(--clr-sky-700-v2);
  --clr-warning: var(--clr-amber-600);
  --clr-success: var(--success-500);
  --radius: var(--radius-md);
  --shadow-sm: var(--shadow-low);
  --shadow: var(--shadow-medium);
  --shadow-lg: 0 12px 32px var(--clr-ink-950-a08);
  --shadow-glow: 0 0 22px var(--clr-teal-700-a15);
  --grad-primary: linear-gradient(135deg, var(--clr-teal-700) 0%, var(--clr-teal-700-v2) 100%);
  --grad-surface: var(--clr-white-50);
  --transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  --font-body:
    "Plus Jakarta Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    "Helvetica Neue", Arial, sans-serif;
  --font-heading:
    "Sora", "Plus Jakarta Sans", -apple-system, BlinkMacSystemFont, "Segoe UI",
    Roboto, "Helvetica Neue", Arial, sans-serif;
  --blur: 12px;
}

/* ===========================
   Dark Mode
   =========================== */
[data-theme="dark"] {
  --clr-bg: var(--clr-sky-950);
  --clr-surface: var(--clr-blue-950-a86);
  --clr-surface-solid: var(--clr-sky-950-v2);
  --clr-surface-hover: var(--clr-sky-900);
  --clr-border: var(--clr-sky-400-a22);
  --clr-border-subtle: var(--clr-sky-400-a12);
  --clr-text: var(--clr-sky-100);
  --clr-text-secondary: var(--clr-sky-400);
  --clr-primary-light: var(--clr-sky-600-a26);
  --clr-danger-light: var(--clr-red-500-a18);
  --grad-surface: linear-gradient(
    180deg,
    var(--clr-sky-950-a95) 0%,
    var(--clr-sky-950-a82) 100%
  );
}

[data-theme="dark"] body {
  background: var(--clr-bg);
}

[data-theme="dark"] .header {
  background: var(--clr-sky-950-a72);
  border-bottom: 1px solid var(--clr-border);
}

[data-theme="dark"] .header::before {
  opacity: 0.55;
}

[data-theme="dark"] .btn-theme-toggle {
  background: var(--clr-blue-950-a78);
}

[data-theme="dark"] .summary-card {
  background: var(--clr-surface-solid);
  border: 1px solid var(--clr-border);
}

[data-theme="dark"] .filter-card {
  background: var(--clr-surface-solid);
}

[data-theme="dark"] .hero-card {
  border-color: var(--clr-border);
}

[data-theme="dark"] .hero-value {
  color: var(--clr-sky-50-v4);
}

[data-theme="dark"] .card-illus {
  background: var(--clr-sky-950-a92);
  color: var(--clr-sky-500);
  border-color: var(--clr-sky-500-a30);
}

[data-theme="dark"] .form-group input,
[data-theme="dark"] .form-group select,
[data-theme="dark"] .filter-group select,
[data-theme="dark"] .filter-group input {
  background: var(--clr-blue-950-a60);
  border-color: var(--clr-border);
  color: var(--clr-text);
}

[data-theme="dark"] .modal {
  background: var(--clr-surface-solid);
}

[data-theme="dark"] #expense-table thead th,
[data-theme="dark"] #split-ledger-table thead th {
  background: var(--clr-sky-950-a86);
  border-bottom: 1px solid var(--clr-border);
}

[data-theme="dark"] #expense-table tbody tr:nth-child(even),
[data-theme="dark"] #split-ledger-table tbody tr:nth-child(even) {
  background: var(--clr-blue-950);
}

/* ===========================
   Global Reset
   =========================== */
*,
*::before,
*::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
}

h1,
h2,
h3 {
  line-height: var(--line-height-tight);
}

body {
  font-family: var(--font-body);
  background: var(--clr-bg);
  color: var(--clr-text);
  line-height: var(--line-height-base);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  transition:
    background var(--transition),
    color var(--transition);
}

button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
a:focus-visible {
  outline: 2px solid var(--clr-primary);
  outline-offset: 2px;
}

/* ===========================
   Glassmorphism
   =========================== */
.glass {
  background: var(--grad-surface);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--clr-border);
}

/* ===========================
   Header
   =========================== */
.header {
  background: var(--clr-white-50-a72);
  color: var(--clr-text);
  padding: 1.1rem 1.5rem;
  position: sticky;
  top: 0;
  z-index: 30;
  border-bottom: 1px solid var(--clr-border);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
}

.header::before {
  content: "";
  position: absolute;
  inset: 0;
  content: none;
  pointer-events: none;
  opacity: 0.9;
}

.header::after {
  content: none;
}

.header-inner {
  max-width: 1100px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 1rem;
  position: relative;
  z-index: 1;
}

.header-icon {
  font-size: 2rem;
  filter: drop-shadow(0 10px 22px var(--clr-blue-950-a20));
}

.header h1 {
  font-size: var(--font-size-lg);
  font-weight: 800;
  letter-spacing: -0.02em;
  line-height: var(--line-height-tight);
  font-family: var(--font-heading);
}

.header-subtitle {
  font-size: var(--font-size-sm);
  opacity: 0.8;
  margin-top: 0.2rem;
  color: var(--clr-text-secondary);
}

/* Theme Toggle Button */
.btn-theme-toggle {
  margin-left: auto;
  background: var(--clr-white-50-a80);
  border: 1px solid var(--clr-border);
  border-radius: 999px;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition:
    background var(--transition),
    transform var(--transition);
  backdrop-filter: blur(8px);
}

.btn-theme-toggle:hover {
  background: var(--clr-white-50);
  transform: translateY(-1px) rotate(6deg);
}

.theme-icon {
  font-size: 1.25rem;
  line-height: 1;
  transition: transform 0.4s ease;
}

/* ===========================
   Container
   =========================== */
.container {
  max-width: 1100px;
  width: 100%;
  margin: 0 auto;
  padding: var(--space-3);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  flex: 1;
}

.container > section {
  opacity: 0;
  transform: translateY(12px);
  animation: sectionIn 0.45s ease forwards;
}

.container > section:nth-child(2) {
  animation-delay: 0.04s;
}

.container > section:nth-child(3) {
  animation-delay: 0.08s;
}

.container > section:nth-child(4) {
  animation-delay: 0.12s;
}

.container > section:nth-child(5) {
  animation-delay: 0.16s;
}

.container > section:nth-child(6) {
  animation-delay: 0.2s;
}

/* ===========================
   Cards
   =========================== */
.card {
  background: var(--grad-surface);
  border: 1px solid var(--clr-border);
  border-radius: var(--radius-lg);
  padding: var(--space-3);
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
  transition:
    box-shadow var(--transition),
    transform var(--transition),
    background var(--transition);
}

.card:not(.summary-card)::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--clr-primary);
  opacity: 1;
}

.card:not(.summary-card)::after {
  display: none;
}

.card-illus {
  display: none !important;
}

.card:hover {
  box-shadow: var(--shadow);
  transform: translateY(-3px);
}

.card-title {
  font-size: var(--font-size-md);
  font-weight: 700;
  margin-bottom: var(--space-2);
  color: var(--clr-text);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-family: var(--font-heading);
}

.card-title::before {
  content: "";
  width: 4px;
  height: 1.1rem;
  background: linear-gradient(180deg, var(--clr-primary), var(--clr-accent));
  border-radius: 2px;
  flex-shrink: 0;
}

/* ===========================
   Hero
   =========================== */
.hero-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 2rem;
  padding: 2rem;
  background: linear-gradient(135deg, var(--clr-primary) 0%, var(--clr-teal-700-v2) 100%);
  border: none;
  border-radius: var(--radius-lg);
  color: var(--clr-white-50);
  box-shadow: 0 8px 24px var(--clr-teal-700-a20);
  overflow: hidden;
  position: relative;
}

.hero-card .card-illus {
  background: var(--clr-white-50-a90);
  color: var(--clr-cyan-800);
}

.hero-content {
  max-width: 520px;
}

.hero-kicker {
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--clr-white-50-a80);
}

.hero-title {
  font-size: 1.15rem;
  font-weight: 800;
  font-family: var(--font-heading);
  margin: 0.25rem 0 0;
}

.hero-value {
  font-size: 2.5rem;
  font-weight: 800;
  font-family: var(--font-heading);
  letter-spacing: -0.02em;
  line-height: 1.15;
  margin: 0.25rem 0 0.6rem;
  color: var(--clr-white-50);
}

.hero-meta {
  display: flex;
  gap: 1.4rem;
  font-size: 0.85rem;
  color: var(--clr-white-50-a90);
  flex-wrap: wrap;
}

.hero-meta strong {
  color: var(--clr-white-50);
  font-weight: 700;
}

.hero-note {
  margin-top: 0.6rem;
  font-size: 0.85rem;
  color: var(--clr-white-50-a75);
}

.hero-graphic {
  display: none;
}

/* ===========================
   Form
   =========================== */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.form-group label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

/* Segmented Control for Transaction Type */
.segmented-control {
  position: relative;
  display: flex;
  background-color: var(--clr-bg);
  border: 1.5px solid var(--clr-border-subtle);
  border-radius: 12px;
  overflow: hidden;
  height: 2.8rem;
}

.segmented-control input[type="radio"] {
  display: none;
}

.segmented-control label {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--clr-text-secondary);
  cursor: pointer;
  z-index: 2;
  transition: color 0.3s ease;
  user-select: none;
  text-transform: none;
  letter-spacing: normal;
  margin: 0;
}

.segmented-control label:hover {
  color: var(--clr-text);
}

.segmented-control input[type="radio"]:checked + label {
  color: var(--clr-white-50-v2);
}

.segmented-bg {
  position: absolute;
  top: 3px;
  bottom: 3px;
  width: calc(33.333% - 2px);
  background: var(--clr-primary);
  border-radius: 8px;
  z-index: 1;
  transition:
    transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1),
    background-color 0.35s ease;
}

input[value="expense"]:checked ~ .segmented-bg {
  transform: translateX(3px);
  background: var(--clr-danger);
}

input[value="income"]:checked ~ .segmented-bg {
  transform: translateX(calc(100% + 3px));
  background: var(--clr-success);
}

input[value="transfer"]:checked ~ .segmented-bg {
  transform: translateX(calc(200% + 6px));
  background: var(--clr-accent);
}

.form-group input,
.form-group select {
  padding: 0.7rem 0.9rem;
  font-size: 0.95rem;
  font-family: var(--font-body);
  border: 1.5px solid var(--clr-border-subtle);
  border-radius: var(--radius-sm);
  background: var(--clr-surface-solid);
  color: var(--clr-text);
  transition:
    border-color var(--transition),
    box-shadow var(--transition),
    background var(--transition);
  outline: none;
}

.form-group input:focus,
.form-group select:focus {
  border-color: var(--clr-primary);
  box-shadow: 0 0 0 3px var(--clr-primary-light);
  background: var(--clr-surface);
}

.form-group input.invalid,
.form-group select.invalid {
  border-color: var(--clr-danger);
  box-shadow: 0 0 0 3px var(--clr-danger-light);
  animation: shake 0.4s ease;
}

.form-group select option {
  color: var(--clr-text);
  background-color: var(--clr-surface-solid);
}

.help-text {
  min-height: 1rem;
  font-size: 0.75rem;
  color: var(--clr-danger);
}

@keyframes shake {
  0%,
  100% {
    transform: translateX(0);
  }
  20% {
    transform: translateX(-4px);
  }
  40% {
    transform: translateX(4px);
  }
  60% {
    transform: translateX(-3px);
  }
  80% {
    transform: translateX(3px);
  }
}

.form-actions {
  margin-top: 1.25rem;
  display: flex;
  gap: 0.75rem;
}

#btn-submit.is-loading {
  opacity: 0.8;
  pointer-events: none;
}

#btn-submit:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.btn-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid var(--clr-white-50-a35);
  border-top-color: var(--clr-white-50-v2);
  border-radius: 50%;
  display: inline-block;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ===========================
   Buttons
   =========================== */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  padding: 0.65rem 1.25rem;
  min-height: 44px;
  font-size: 0.9rem;
  font-weight: 600;
  font-family: var(--font-body);
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
}

/* shine effect removed for cleaner design */

.btn:active {
  transform: scale(0.96);
}

.btn-primary {
  background: var(--clr-primary);
  color: var(--clr-white-50-v2);
  box-shadow: 0 4px 12px var(--clr-teal-700-a20);
}

.btn-primary:hover {
  background: var(--clr-primary-hover);
  box-shadow: 0 6px 16px var(--clr-teal-700-a25);
  transform: translateY(-1px);
}

.btn-ghost {
  background: transparent;
  color: var(--clr-text-secondary);
  border: 1.5px solid var(--clr-border-subtle);
}

.btn-ghost:hover {
  background: var(--clr-primary-light);
  color: var(--clr-primary);
  border-color: var(--clr-primary);
}

.btn-danger {
  background: var(--clr-danger);
  color: var(--clr-white-50-v2);
  box-shadow: 0 4px 12px var(--clr-red-500-a22);
}

.btn-danger:hover {
  background: var(--clr-danger-hover);
  box-shadow: 0 6px 14px var(--clr-red-500-a30);
  transform: translateY(-1px);
}

.btn-accent {
  background: var(--clr-accent);
  color: var(--clr-white-50-v2);
  box-shadow: 0 4px 12px var(--clr-sky-700-a20);
}

.btn-accent:hover {
  background: var(--clr-accent-hover);
  box-shadow: 0 6px 16px var(--clr-sky-700-a25);
  transform: translateY(-1px);
}

.btn-icon {
  font-size: 1.1rem;
  line-height: 1;
}

.btn-sm {
  padding: 0.4rem 0.85rem;
  min-height: 44px;
  font-size: 0.8rem;
  border-radius: 8px;
}

/* ===========================
   Summary
   =========================== */
.summary-card {
  background: var(--clr-surface-solid);
  border: 1px solid var(--clr-border);
  color: var(--clr-text);
  position: relative;
  overflow: hidden;
  transition: background var(--transition);
}

.summary-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--clr-primary);
}

.summary-card:hover {
  box-shadow: var(--shadow);
  transform: translateY(-1px);
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1.5rem;
  position: relative;
  z-index: 1;
}

.summary-item {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
  padding-right: 1rem;
  border-right: 1px solid var(--clr-border-subtle);
}

.summary-item:last-child {
  border-right: none;
  padding-right: 0;
}

.summary-label {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  opacity: 0.8;
  font-weight: 500;
  color: var(--clr-text-secondary);
}

.summary-value {
  font-size: 1.2rem;
  font-weight: 800;
  letter-spacing: -0.02em;
  font-family: var(--font-heading);
}

.summary-value-sm {
  font-size: 0.95rem;
  font-weight: 700;
  font-family: var(--font-heading);
}

.summary-item:first-child .summary-value {
  font-size: 1.7rem;
  color: var(--clr-blue-950-v2);
}

[data-theme="dark"] .summary-item:first-child .summary-value {
  color: var(--clr-sky-50-v4);
}

.summary-value.pulse {
  animation: pulse 0.5s ease;
}

@keyframes pulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.08);
  }
  100% {
    transform: scale(1);
  }
}

/* ===========================
   Chart
   =========================== */
.chart-card {
  overflow: hidden;
}

.chart-container {
  display: flex;
  align-items: center;
  gap: 2rem;
  padding: 0.5rem;
  position: relative;
}

#category-chart {
  flex-shrink: 0;
}

.chart-legend {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  flex: 1;
  min-width: 0;
}

.chart-tooltip {
  position: absolute;
  padding: 0.45rem 0.6rem;
  background: var(--clr-surface-solid);
  border: 1px solid var(--clr-border);
  border-radius: 8px;
  font-size: 0.75rem;
  color: var(--clr-text);
  box-shadow: var(--shadow-sm);
  pointer-events: none;
  opacity: 0;
  transform: translateY(4px);
  transition:
    opacity var(--transition),
    transform var(--transition);
  z-index: 2;
}

.chart-tooltip.visible {
  opacity: 1;
  transform: translateY(0);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  font-size: 0.85rem;
  font-weight: 500;
}

.legend-color {
  width: 12px;
  height: 12px;
  border-radius: 3px;
  flex-shrink: 0;
}

.legend-label {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: var(--clr-text-secondary);
}

.legend-value {
  font-weight: 700;
  color: var(--clr-text);
  white-space: nowrap;
}

.chart-empty {
  text-align: center;
  padding: 2rem 1rem;
  color: var(--clr-text-secondary);
  font-size: 0.95rem;
  display: none;
}

.chart-empty.visible {
  display: block;
}

/* ===========================
   Filter
   =========================== */
.filter-card {
  padding: 1.1rem 1.35rem;
  background: var(--clr-surface-hover);
  border: 1px solid var(--clr-border);
}

.filter-card .card-title {
  margin-bottom: 0.85rem;
}

.filter-layout {
  display: grid;
  gap: 0.8rem;
}

.filter-fields {
  display: grid;
  grid-template-columns: repeat(4, minmax(150px, 1fr));
  gap: 0.7rem;
  align-items: end;
}

.filter-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.65rem;
}

.filter-group {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 0.35rem;
}

.filter-group-undo {
  min-width: 170px;
}

.undo-inline {
  display: flex;
  gap: 0.45rem;
  align-items: center;
}

.undo-indicator {
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--clr-text-secondary);
  background: var(--clr-sky-600-a10);
  border: 1px solid var(--clr-border-subtle);
  padding: 0.4rem 0.6rem;
  border-radius: 10px;
  min-height: 44px;
  display: inline-flex;
  align-items: center;
}

.filter-group label {
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--clr-text-secondary);
  line-height: 1.2;
}

.filter-group select,
.filter-group input[type="month"] {
  min-height: 44px;
  padding: 0.55rem 0.75rem;
  font-size: 0.85rem;
  font-family: var(--font-body);
  border: 1.5px solid var(--clr-border-subtle);
  border-radius: 10px;
  background: var(--clr-white-50-a90);
  color: var(--clr-text);
  outline: none;
  transition:
    border-color var(--transition),
    box-shadow var(--transition),
    background var(--transition);
}

.filter-group select:focus,
.filter-group input[type="month"]:focus {
  border-color: var(--clr-primary);
  box-shadow: 0 0 0 3px var(--clr-primary-light);
  background: var(--clr-white-50-v2);
}

[data-theme="dark"] .filter-group select,
[data-theme="dark"] .filter-group input[type="month"],
[data-theme="dark"] .undo-indicator {
  background: var(--clr-blue-950-a78);
}

/* ===========================
   Table
   =========================== */
.table-wrapper {
  overflow: auto;
  max-height: 440px;
  margin: 0 -1.5rem;
  padding: 0 1.5rem;
  position: relative;
}

.table-wrapper::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.table-wrapper::-webkit-scrollbar-thumb {
  background: var(--clr-border);
  border-radius: 999px;
}

#expense-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}

#expense-table thead th {
  text-align: left;
  font-size: 0.72rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--clr-text-secondary);
  padding: 0.75rem 1rem;
  background: var(--clr-sky-50-a86);
  border-bottom: 1px solid var(--clr-border);
  position: sticky;
  top: 0;
  z-index: 1;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

#expense-table tbody tr {
  transition:
    background var(--transition),
    transform var(--transition),
    box-shadow var(--transition);
}

#expense-table tbody tr:hover {
  background: var(--clr-surface-hover);
  transform: translateY(-1px);
  box-shadow: 0 8px 18px var(--clr-blue-950-a08);
}

#expense-table tbody tr:nth-child(even) {
  background: var(--clr-sky-50-a82);
}

#expense-table tbody td {
  padding: 0.85rem 1rem;
  border-bottom: 1px solid var(--clr-border-subtle);
  vertical-align: middle;
}

#expense-table tbody tr:last-child td {
  border-bottom: none;
}

.text-right {
  text-align: right !important;
}

.text-center {
  text-align: center !important;
}

/* Split Ledger Table */
.split-ledger-card {
  overflow: hidden;
}

.split-ledger-header {
  margin-bottom: 0.85rem;
}

.split-ledger-subtitle {
  margin-top: 0.35rem;
  font-size: 0.85rem;
  color: var(--clr-text-secondary);
}

.split-ledger-wrapper {
  max-height: 360px;
}

#split-ledger-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.88rem;
}

#split-ledger-table thead th {
  text-align: left;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--clr-text-secondary);
  padding: 0.72rem 0.9rem;
  background: var(--clr-sky-50-a86);
  border-bottom: 1px solid var(--clr-border);
  position: sticky;
  top: 0;
  z-index: 1;
}

#split-ledger-table tbody tr {
  transition: background var(--transition);
}

#split-ledger-table tbody tr:hover {
  background: var(--clr-surface-hover);
}

#split-ledger-table tbody tr:nth-child(even) {
  background: var(--clr-sky-50-a82);
}

#split-ledger-table tbody td {
  padding: 0.78rem 0.9rem;
  border-bottom: 1px solid var(--clr-border-subtle);
  vertical-align: middle;
}

#split-ledger-table tbody tr:last-child td {
  border-bottom: none;
}

.split-ledger-status,
.split-ledger-sync {
  display: inline-flex;
  align-items: center;
  border-radius: 999px;
  padding: 0.2rem 0.55rem;
  font-size: 0.75rem;
  font-weight: 700;
  white-space: nowrap;
}

.split-ledger-status.receive {
  background: var(--clr-teal-700-a15-v2);
  color: var(--clr-success);
}

.split-ledger-status.pay {
  background: var(--clr-red-500-a14);
  color: var(--clr-danger);
}

.split-ledger-status.even {
  background: var(--clr-sky-400-a20);
  color: var(--clr-text-secondary);
}

.split-ledger-status.done {
  background: var(--clr-teal-700-a18);
  color: var(--clr-success);
}

.split-ledger-sync.synced {
  background: var(--clr-teal-700-a15-v2);
  color: var(--clr-success);
}

.split-ledger-sync.pending {
  background: var(--clr-sky-700-a12);
  color: var(--clr-accent);
}

.split-ledger-empty::before {
  content: "Belum ada split bill";
}

/* Category Badge */
.badge {
  display: inline-block;
  padding: 0.25rem 0.65rem;
  font-size: 0.75rem;
  font-weight: 600;
  border-radius: 50px;
  background: var(--clr-primary-light);
  color: var(--clr-primary);
  border: none;
  white-space: nowrap;
}

/* Amount formatting */
.amount {
  font-weight: 700;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  color: var(--clr-danger);
}

/* Action Buttons in Table */
.action-group {
  display: flex;
  gap: 0.4rem;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
}

.btn-edit {
  background: var(--clr-primary-light);
  color: var(--clr-primary);
  border: none;
}

.btn-edit:hover {
  background: var(--clr-primary);
  color: var(--clr-white-50-v2);
}

.btn-delete {
  background: var(--clr-danger-light);
  color: var(--clr-danger);
  border: none;
}

.btn-delete:hover {
  background: var(--clr-danger);
  color: var(--clr-white-50-v2);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 2rem 1rem;
  color: var(--clr-text-secondary);
  font-size: var(--font-size-sm);
  display: none;
  border: 1px dashed var(--clr-border);
  border-radius: var(--radius);
  background: var(--clr-surface-solid);
}

.empty-state.visible {
  display: block;
}

.empty-state::before {
  content: "Belum ada data";
  display: block;
  font-size: var(--font-size-md);
  font-weight: 700;
  color: var(--clr-text);
  margin-bottom: 6px;
}

.render-state {
  display: none;
  font-size: 0.8rem;
  color: var(--clr-text-secondary);
  margin: -0.25rem 0 0.75rem;
}

.render-state.visible {
  display: block;
}

/* ===========================
   Modal
   =========================== */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: var(--clr-ink-950-a50);
  backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.3s,
    visibility 0.3s;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: var(--clr-surface-solid);
  border-radius: var(--radius);
  padding: 2rem;
  max-width: 380px;
  width: 90%;
  box-shadow: var(--shadow-lg);
  transform: translateY(20px) scale(0.95);
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.modal-overlay.active .modal {
  transform: translateY(0) scale(1);
}

.modal-icon {
  text-align: center;
  font-size: 2.5rem;
  margin-bottom: 0.75rem;
}

.modal-text {
  font-size: 1rem;
  font-weight: 500;
  margin-bottom: 1.5rem;
  text-align: center;
  color: var(--clr-text);
}

.modal-subtext {
  text-align: center;
  color: var(--clr-text-secondary);
  font-size: 0.85rem;
  margin: -0.75rem 0 1.5rem;
  line-height: 1.5;
}

.modal-actions {
  display: flex;
  gap: 0.75rem;
  justify-content: center;
}

/* ===========================
   Import Modal
   =========================== */
.import-modal {
  max-width: 520px;
}

.import-options {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
}

.radio-option {
  display: grid;
  grid-template-columns: 18px 1fr;
  gap: 0.6rem 0.75rem;
  align-items: start;
  background: var(--clr-bg);
  border: 1px solid var(--clr-border-subtle);
  padding: 0.75rem 0.9rem;
  border-radius: 10px;
  cursor: pointer;
  transition: all var(--transition);
}

.radio-option:hover {
  border-color: var(--clr-primary);
  box-shadow: 0 0 0 2px var(--clr-primary-light);
}

.radio-option input[type="radio"] {
  margin-top: 3px;
}

.radio-label {
  font-weight: 600;
  color: var(--clr-text);
}

.radio-desc {
  grid-column: 2 / -1;
  font-size: 0.8rem;
  color: var(--clr-text-secondary);
}

.import-summary-modal {
  max-width: 420px;
}

.import-summary-modal .modal-icon {
  animation:
    popIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1),
    glowPulse 1.1s ease-out 0.1s both;
  filter: drop-shadow(0 0 0 var(--clr-teal-700-a00));
}

.import-summary-modal .modal-text {
  animation:
    fadeSlideUp 0.35s ease,
    subtleBounce 0.5s ease 0.1s both;
}

/* Icon Selector for Custom Category */
.icon-selector {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  padding: 0.5rem;
  background: var(--clr-bg);
  border-radius: 10px;
  border: 1px solid var(--clr-border-subtle);
  max-height: 150px;
  overflow-y: auto;
}

.icon-btn {
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  border: 1.5px solid transparent;
  background: var(--clr-surface-solid);
  color: var(--clr-text-secondary);
  cursor: pointer;
  transition: all var(--transition);
  font-size: 1.25rem;
}

.icon-btn:hover {
  background: var(--clr-primary-light);
  color: var(--clr-primary);
}

.icon-btn.selected {
  border-color: var(--clr-primary);
  background: var(--clr-primary-light);
  color: var(--clr-primary);
  box-shadow: 0 0 0 2px var(--clr-teal-700-a10);
}

/* Checkbox group styling */
.checkbox-group {
  display: flex !important;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  background: var(--clr-bg);
  border-radius: 12px;
  border: 1px solid var(--clr-border-subtle);
  transition: all var(--transition);
  user-select: none;
}

.checkbox-group:hover {
  border-color: var(--clr-primary);
  background: var(--clr-primary-light);
}

.checkbox-group input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: var(--clr-primary);
  cursor: pointer;
}

.checkbox-group label {
  cursor: pointer;
}

.import-summary {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1.25rem;
  background: var(--clr-bg);
  border: 1px solid var(--clr-border-subtle);
  border-radius: 10px;
  padding: 0.9rem 1rem;
  animation: fadeSlideUp 0.4s ease;
}

.import-summary-row {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--clr-text);
}

@keyframes popIn {
  from {
    transform: scale(0.85);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes fadeSlideUp {
  from {
    transform: translateY(8px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes glowPulse {
  0% {
    filter: drop-shadow(0 0 0 var(--clr-teal-700-a00));
  }
  60% {
    filter: drop-shadow(0 0 12px var(--clr-teal-700-a45));
  }
  100% {
    filter: drop-shadow(0 0 6px var(--clr-teal-700-a18));
  }
}

@keyframes subtleBounce {
  0% {
    transform: translateY(8px);
  }
  60% {
    transform: translateY(-2px);
  }
  100% {
    transform: translateY(0);
  }
}

/* ===========================
   Toast Notifications
   =========================== */
.toast-container {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 2000;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  pointer-events: none;
}

.toast {
  background: var(--clr-surface-solid);
  border: 1px solid var(--clr-border-subtle);
  border-radius: var(--radius-sm);
  padding: 0.8rem 1.2rem;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: 0.6rem;
  font-size: 0.88rem;
  font-weight: 500;
  color: var(--clr-text);
  pointer-events: auto;
  animation: toastIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  max-width: 340px;
}

.toast-action {
  margin-left: auto;
  background: transparent;
  border: 1px solid var(--clr-border-subtle);
  color: var(--clr-text);
  font-size: 0.78rem;
  font-weight: 600;
  padding: 0.3rem 0.6rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all var(--transition);
}

.toast-action:hover {
  background: var(--clr-primary-light);
  color: var(--clr-primary);
  border-color: var(--clr-primary);
}

.toast.toast-out {
  animation: toastOut 0.3s ease forwards;
}

.toast-icon {
  font-size: 1.2rem;
  flex-shrink: 0;
}

.toast-success {
  border-left: 4px solid var(--clr-success);
}
.toast-error {
  border-left: 4px solid var(--clr-danger);
}
.toast-info {
  border-left: 4px solid var(--clr-accent);
}

@keyframes toastIn {
  from {
    opacity: 0;
    transform: translateX(40px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

@keyframes toastOut {
  from {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
  to {
    opacity: 0;
    transform: translateX(40px) scale(0.9);
  }
}

/* ===========================
   Footer
   =========================== */
.footer {
  text-align: center;
  padding: 1.5rem;
  font-size: 0.8rem;
  color: var(--clr-text-secondary);
  border-top: 1px solid var(--clr-border-subtle);
  margin-top: auto;
}

/* ===========================
   Row animation
   =========================== */
@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: translateY(-8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes sectionIn {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes floatY {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-8px);
  }
}

.row-animate {
  animation: fadeSlideIn 0.3s ease forwards;
}

.row-removing {
  opacity: 0;
  transform: translateY(-4px);
  transition:
    opacity var(--transition),
    transform var(--transition);
}

@media (prefers-reduced-motion: reduce) {
  .container > section,
  .row-animate,
  .hero-orb,
  .import-summary-modal .modal-icon,
  .import-summary-modal .modal-text,
  .import-summary,
  .toast,
  .toast.toast-out {
    animation: none !important;
  }

  .card,
  .btn,
  .modal,
  .chart-tooltip,
  #expense-table tbody tr {
    transition: none !important;
  }
}

/* ===========================
   Split Bill Button
   =========================== */
.btn-split {
  background: var(--clr-primary);
  color: var(--clr-white-50-v2);
  box-shadow: 0 4px 12px var(--clr-teal-700-a20);
}

.btn-split:hover {
  background: var(--clr-primary-hover);
  box-shadow: 0 6px 16px var(--clr-teal-700-a25);
  transform: translateY(-1px);
}

/* ===========================
   Split Bill Modal
   =========================== */
.split-modal {
  max-width: 560px;
  width: 94%;
  max-height: 88vh;
  overflow-y: auto;
  padding: 0;
  border-radius: var(--radius);
}

.split-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid var(--clr-border-subtle);
  position: sticky;
  top: 0;
  background: var(--clr-surface-solid);
  z-index: 2;
  border-radius: var(--radius) var(--radius) 0 0;
}

.split-header h2 {
  font-size: 1.2rem;
  font-weight: 700;
  margin: 0;
  font-family: var(--font-heading);
}

.btn-close {
  background: none;
  border: none;
  font-size: 1.6rem;
  color: var(--clr-text-secondary);
  cursor: pointer;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all var(--transition);
}

.btn-close:hover {
  background: var(--clr-danger-light);
  color: var(--clr-danger);
}

.split-body {
  padding: 1.25rem 1.5rem;
}

.split-form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1.25rem;
}

/* Split Mode Toggle */
.split-mode-toggle {
  display: flex;
  background: var(--clr-bg);
  border-radius: var(--radius-sm);
  padding: 4px;
  gap: 4px;
  margin-bottom: 1.25rem;
}

.split-mode-btn {
  flex: 1;
  padding: 0.5rem 1rem;
  font-size: 0.85rem;
  font-weight: 600;
  font-family: var(--font-body);
  border: none;
  border-radius: 7px;
  cursor: pointer;
  background: transparent;
  color: var(--clr-text-secondary);
  transition: all var(--transition);
}

.split-mode-btn.active {
  background: var(--clr-surface-solid);
  color: var(--clr-primary);
  box-shadow: var(--shadow-sm);
}

.split-mode-btn:hover:not(.active) {
  color: var(--clr-text);
}

/* Participants */
.split-participants {
  margin-bottom: 1.25rem;
}

.split-payer-group {
  margin-bottom: 1.25rem;
}

.split-owner-group {
  margin-bottom: 1rem;
}

.split-owner-group .help-text,
.split-payer-group .help-text {
  color: var(--clr-text-secondary);
  min-height: 0;
}

.split-participants-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.split-participants-header label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.split-person-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.split-person-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  animation: fadeSlideIn 0.25s ease forwards;
}

.split-person-row .person-name-input {
  flex: 1;
  padding: 0.55rem 0.8rem;
  font-size: 0.9rem;
  font-family: var(--font-body);
  border: 1.5px solid var(--clr-border-subtle);
  border-radius: 8px;
  background: var(--clr-surface-solid);
  color: var(--clr-text);
  outline: none;
  transition: border-color var(--transition);
}

.split-person-row .person-name-input:focus {
  border-color: var(--clr-primary);
  box-shadow: 0 0 0 2px var(--clr-primary-light);
}

.split-person-row .custom-amount {
  width: 120px;
  padding: 0.55rem 0.8rem;
  font-size: 0.9rem;
  font-family: var(--font-body);
  border: 1.5px solid var(--clr-border-subtle);
  border-radius: 8px;
  background: var(--clr-surface-solid);
  color: var(--clr-text);
  outline: none;
  transition: border-color var(--transition);
}

.split-person-row .custom-amount:focus {
  border-color: var(--clr-primary);
  box-shadow: 0 0 0 2px var(--clr-primary-light);
}

.split-person-row .custom-amount {
  display: none;
}

.split-person-row .custom-amount.visible {
  display: block;
}

.btn-remove-person {
  background: var(--clr-danger-light);
  color: var(--clr-danger);
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  font-size: 1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--transition);
  flex-shrink: 0;
}

.btn-remove-person:hover {
  background: var(--clr-danger);
  color: var(--clr-white-50-v2);
}

.split-form-actions {
  display: flex;
  gap: 0.75rem;
  margin-top: 0.5rem;
}

/* Split Results */
.split-result-summary {
  text-align: center;
  padding: 1rem;
  margin-bottom: 1rem;
  background: var(--clr-primary);
  color: var(--clr-white-50-v2);
  border-radius: var(--radius-sm);
}

.split-result-summary .result-bill-name {
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  opacity: 0.85;
}

.split-result-summary .result-total {
  font-size: 1.5rem;
  font-weight: 800;
  margin-top: 0.2rem;
}

.split-result-summary .result-people-count {
  font-size: 0.85rem;
  opacity: 0.85;
  margin-top: 0.15rem;
}

.split-result-summary .result-payer {
  font-size: 0.8rem;
  opacity: 0.95;
  margin-top: 0.35rem;
}

.split-result-summary .result-owner-status {
  font-size: 0.8rem;
  opacity: 0.95;
  margin-top: 0.2rem;
}

.split-result-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.split-result-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  background: var(--clr-bg);
  border-radius: 8px;
  animation: fadeSlideIn 0.3s ease forwards;
}

.split-result-item .person-name {
  font-weight: 600;
  font-size: 0.95rem;
}

.split-result-item .person-detail {
  display: block;
  margin-top: 0.1rem;
  font-size: 0.78rem;
  color: var(--clr-text-secondary);
}

.split-result-item .person-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--clr-white-50-v2);
  flex-shrink: 0;
}

.split-result-item .person-info {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

.split-result-item .person-text {
  display: flex;
  flex-direction: column;
}

.split-result-item .person-result {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 0.1rem;
}

.split-result-item .person-share {
  font-weight: 700;
  font-size: 0.85rem;
  color: var(--clr-primary);
  font-variant-numeric: tabular-nums;
}

.split-result-item .person-settlement {
  font-size: 0.86rem;
  font-weight: 700;
}

.split-result-item .person-settlement.receive {
  color: var(--clr-success);
}

.split-result-item .person-settlement.pay {
  color: var(--clr-danger);
}

.split-result-item .person-settlement.even {
  color: var(--clr-text-secondary);
}

/* Split History */
.split-history {
  border-top: 1px solid var(--clr-border-subtle);
  padding: 1rem 1.5rem 1.25rem;
}

.split-history-title {
  font-size: 0.9rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
  color: var(--clr-text);
}

.split-history-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  max-height: 200px;
  overflow-y: auto;
}

.split-history-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.6rem 0.8rem;
  background: var(--clr-bg);
  border-radius: 8px;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all var(--transition);
}

.split-history-item:hover {
  background: var(--clr-primary-light);
}

.split-history-item .hist-name {
  font-weight: 600;
  color: var(--clr-text);
}

.split-history-item .hist-meta {
  color: var(--clr-text-secondary);
  font-size: 0.78rem;
}

.split-history-item .hist-amount {
  font-weight: 700;
  color: var(--clr-primary);
  white-space: nowrap;
}

.split-history-empty {
  text-align: center;
  color: var(--clr-text-secondary);
  font-size: 0.85rem;
  padding: 1rem;
}

[data-theme="dark"] .split-header {
  background: var(--clr-surface-solid);
}

[data-theme="dark"] .split-person-row input {
  background: var(--clr-blue-950-a60);
  border-color: var(--clr-border);
  color: var(--clr-text);
}

/* ===========================
   UI Polish
   =========================== */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  background:
    radial-gradient(
      circle at 12% 10%,
      var(--clr-teal-700-a13),
      transparent 42%
    ),
    radial-gradient(circle at 85% 14%, var(--clr-sky-700-a12), transparent 40%);
  z-index: -1;
}

.wallet-balances {
  display: flex;
  gap: 0.8rem;
  margin: 0.5rem 0;
  flex-wrap: wrap;
}

.budget-container {
  margin-top: 1.3rem;
  background: var(--clr-white-50-a14);
  border: 1px solid var(--clr-white-50-a18);
  border-radius: 14px;
  padding: 1rem;
  backdrop-filter: blur(2px);
}

.budget-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 0.65rem;
}

.budget-header-label {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
}

.btn-budget-edit {
  min-height: auto;
  height: auto;
  padding: 4px 8px;
  border-radius: 8px;
  background: var(--clr-white-50-a12);
  border-color: var(--clr-white-50-a20);
  color: var(--clr-white-50-v2);
}

.btn-budget-edit:hover {
  background: var(--clr-white-50-a20);
  border-color: var(--clr-white-50-a34);
  color: var(--clr-white-50-v2);
}

.budget-stats,
.budget-footer {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  gap: 0.8rem;
}

.budget-stats {
  margin-bottom: 0.5rem;
}

.budget-text-used {
  font-size: 1.15rem;
  font-weight: 700;
  letter-spacing: -0.02em;
}

.budget-text-limit {
  font-size: 0.85rem;
  opacity: 0.85;
}

.budget-bar {
  height: 8px;
  background: var(--clr-white-50-a24);
  border-radius: 999px;
  overflow: hidden;
  position: relative;
  box-shadow: inset 0 1px 2px var(--clr-ink-950-a14);
}

.budget-fill {
  position: absolute;
  inset: 0 auto 0 0;
  height: 100%;
  width: 0;
  border-radius: inherit;
  background: var(--clr-white-50-v2);
  transition:
    width 0.45s cubic-bezier(0.4, 0, 0.2, 1),
    background-color 0.45s;
}

.budget-footer {
  margin-top: 0.65rem;
  align-items: center;
}

.budget-note {
  margin: 0;
  font-size: 0.8rem;
}

.budget-pct {
  display: none;
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 0.01em;
  border-radius: 999px;
  padding: 2px 8px;
  background: var(--clr-white-50-a22);
}

#group-wallet-to {
  display: none;
}

.field-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
}

.btn-add-category {
  font-size: 0.75rem;
  padding: 2px 8px;
  border-radius: 6px;
  border: 1px solid var(--clr-primary-light);
  color: var(--clr-primary);
  font-weight: 700;
  cursor: pointer;
  min-height: auto;
  text-transform: none;
}

.summary-value-income {
  color: var(--clr-success);
}

.summary-value-expense {
  color: var(--clr-danger);
}

.goal-card {
  margin-bottom: var(--space-3);
  border-top: 4px solid var(--clr-accent);
  background:
    linear-gradient(160deg, var(--clr-sky-700-a08), transparent 28%),
    var(--grad-surface);
  position: relative;
  overflow: hidden;
}

.goal-illus {
  display: block !important;
  color: var(--clr-accent) !important;
  opacity: 0.12;
}

.goal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  position: relative;
  z-index: 1;
}

.goal-title {
  margin-bottom: 0;
}

.goal-title i {
  color: var(--clr-accent);
}

.btn-add-goal {
  padding: 4px 10px;
  border-color: var(--clr-sky-700-a45);
  color: var(--clr-accent);
}

.btn-add-goal:hover {
  background: var(--clr-sky-700-a10);
  border-color: var(--clr-accent);
  color: var(--clr-accent-hover);
}

.goal-btn-label {
  display: inline-block;
  font-weight: 700;
}

.goal-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  position: relative;
  z-index: 1;
}

[data-theme="dark"] .budget-container {
  background: var(--clr-sky-950-a38);
  border-color: var(--clr-sky-400-a25);
}

[data-theme="dark"] .btn-budget-edit {
  background: var(--clr-sky-950-a44);
  border-color: var(--clr-sky-400-a30);
}

[data-theme="dark"] .btn-budget-edit:hover {
  background: var(--clr-sky-900-a72);
}

[data-theme="dark"] .goal-card {
  background:
    linear-gradient(170deg, var(--clr-sky-600-a15), transparent 34%),
    var(--grad-surface);
}

/* ===========================
   Responsive
   =========================== */
@media (max-width: 768px) {
  .hero-card {
    flex-direction: column;
    align-items: flex-start;
  }

  .hero-graphic {
    width: 180px;
    height: 120px;
    align-self: flex-end;
  }

  .summary-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .summary-item {
    border-right: none;
    padding-right: 0;
    padding-bottom: 0.8rem;
    border-bottom: 1px solid var(--clr-border-subtle);
  }

  .summary-item:nth-child(3),
  .summary-item:nth-child(4) {
    border-bottom: none;
    padding-bottom: 0;
  }

  .chart-container {
    flex-direction: column;
    align-items: center;
  }

  .chart-legend {
    width: 100%;
  }

  .filter-fields {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .goal-header {
    flex-wrap: wrap;
    gap: 0.75rem;
  }
}

@media (max-width: 640px) {
  .header {
    padding: 1.5rem 1rem;
  }

  .header h1 {
    font-size: 1.3rem;
  }

  .header-icon {
    font-size: 1.5rem;
  }

  .container {
    padding: 1rem;
    gap: 1rem;
  }

  .card {
    padding: 1.25rem;
  }

  .hero-card {
    padding: 1.25rem;
    gap: 1.25rem;
  }

  .hero-title {
    font-size: 1rem;
  }

  .hero-value {
    font-size: 1.35rem;
  }

  .budget-container {
    padding: 0.85rem;
  }

  .budget-stats,
  .budget-footer {
    flex-wrap: wrap;
    align-items: center;
  }

  .hero-graphic {
    width: 120px;
    height: 78px;
    opacity: 0.82;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }

  .summary-grid {
    grid-template-columns: 1fr 1fr;
    gap: 0.8rem;
  }

  .summary-value {
    font-size: 1.05rem;
  }

  .summary-value-sm {
    font-size: 0.85rem;
  }

  .summary-item:first-child .summary-value {
    font-size: 1.3rem;
  }

  .form-actions {
    flex-direction: column;
  }

  .form-actions .btn {
    width: 100%;
  }

  .filter-fields {
    grid-template-columns: 1fr;
  }

  .filter-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.55rem;
  }

  .filter-actions .btn {
    width: 100%;
  }

  .filter-group-undo {
    min-width: 0;
  }

  .undo-inline {
    width: 100%;
  }

  .undo-indicator,
  #btn-undo {
    flex: 1;
    justify-content: center;
  }

  #expense-table {
    font-size: 0.82rem;
  }

  #expense-table thead th,
  #expense-table tbody td {
    padding: 0.65rem 0.6rem;
  }

  .table-wrapper {
    margin: 0;
    padding: 0;
    max-height: none;
  }

  #expense-table thead {
    display: none;
  }

  #expense-table,
  #expense-table tbody,
  #expense-table tr,
  #expense-table td {
    display: block;
    width: 100%;
  }

  #expense-table tbody tr {
    background: var(--clr-surface-solid);
    border: 1px solid var(--clr-border-subtle);
    border-radius: var(--radius-sm);
    padding: 0.6rem 0.8rem;
    margin-bottom: 0.75rem;
    box-shadow: var(--shadow-sm);
  }

  #expense-table tbody tr:nth-child(even) {
    background: var(--clr-surface-solid);
  }

  #expense-table tbody td {
    border: none;
    padding: 0.4rem 0;
    display: flex;
    justify-content: space-between;
    gap: 1rem;
  }

  #expense-table tbody td::before {
    content: attr(data-label);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--clr-text-secondary);
  }

  .action-group {
    flex-direction: row;
    gap: 0.4rem;
    flex-wrap: wrap;
    justify-content: flex-end;
  }

  .toast-container {
    bottom: 1rem;
    right: 1rem;
    left: 1rem;
  }

  .toast {
    max-width: none;
  }
}

/* ===========================
   WOW Visual Upgrade
   =========================== */
:root {
  --wow-ease: cubic-bezier(0.22, 1, 0.36, 1);
  --wow-cyan: var(--clr-sky-600-v2);
  --wow-emerald: var(--clr-teal-700-v2);
  --wow-gold: var(--clr-amber-600);
  --wow-shadow: 0 22px 55px var(--clr-blue-950-a14);
}

body {
  position: relative;
  isolation: isolate;
  overflow-x: hidden;
  background:
    radial-gradient(
      1200px circle at 8% -12%,
      var(--clr-sky-600-a20),
      transparent 55%
    ),
    radial-gradient(
      900px circle at 94% -8%,
      var(--clr-teal-700-a18),
      transparent 52%
    ),
    linear-gradient(180deg, var(--clr-sky-50-v5) 0%, var(--clr-green-50) 48%, var(--clr-blue-50) 100%);
}

body::before {
  content: "";
  position: fixed;
  inset: -20% -10%;
  pointer-events: none;
  z-index: -2;
  background:
    radial-gradient(
      circle at 22% 18%,
      var(--clr-teal-700-a24),
      transparent 36%
    ),
    radial-gradient(
      circle at 78% 15%,
      var(--clr-sky-600-a22),
      transparent 34%
    ),
    radial-gradient(
      circle at 50% 88%,
      var(--clr-amber-600-a16),
      transparent 32%
    );
  animation: ambientOrbit 26s linear infinite alternate;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1;
  opacity: 0.09;
  background-image: radial-gradient(
    var(--clr-blue-950-a08) 0.7px,
    transparent 0.7px
  );
  background-size: 3px 3px;
  mix-blend-mode: soft-light;
  animation: grainShift 7s steps(8) infinite;
}

.header {
  width: min(1120px, calc(100% - 2rem));
  margin: 0.75rem auto 0;
  border-radius: 22px;
  top: 0.55rem;
  padding: 1rem 1.2rem;
  border: 1px solid var(--clr-white-50-a80);
  background: var(--clr-white-50-a63);
  box-shadow: 0 12px 30px var(--clr-blue-950-a12);
  overflow: hidden;
}

.header::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(
    120deg,
    var(--clr-teal-700-a20-v2),
    var(--clr-sky-600-a14),
    var(--clr-amber-600-a16)
  );
  opacity: 0.72;
}

.header-inner {
  max-width: none;
}

.header-icon {
  width: 2.85rem;
  height: 2.85rem;
  border-radius: 14px;
  display: grid;
  place-items: center;
  background: linear-gradient(145deg, var(--clr-teal-800-v2), var(--clr-sky-700));
  color: var(--clr-white-50);
  font-size: 1.3rem;
  box-shadow: 0 10px 24px var(--clr-sky-700-a36);
  animation: headerIconFloat 6s ease-in-out infinite;
}

.header h1 {
  font-size: 1.4rem;
  letter-spacing: -0.03em;
}

.header-subtitle {
  font-size: 0.8rem;
}

.btn-theme-toggle {
  width: 46px;
  height: 46px;
  border: 1px solid var(--clr-sky-400-a35);
  background: var(--clr-white-50-a72);
  box-shadow: 0 8px 16px var(--clr-blue-950-a10);
}

.container {
  padding-top: 1.45rem;
  gap: 1.4rem;
}

.container > section {
  opacity: 1;
  transform: none;
  animation: none;
}

.reveal-ready {
  opacity: 0 !important;
  transform: translateY(30px) scale(0.98) !important;
  filter: blur(2px);
}

.reveal-ready.revealed {
  opacity: 1 !important;
  transform: translateY(0) scale(1) !important;
  filter: blur(0);
  transition:
    opacity 0.8s var(--wow-ease),
    transform 0.8s var(--wow-ease),
    filter 0.6s var(--wow-ease);
}

.card {
  --mx: 50%;
  --my: 50%;
  background: linear-gradient(
    160deg,
    var(--clr-white-50-a88) 0%,
    var(--clr-white-50-a70) 100%
  );
  border: 1px solid var(--clr-sky-400-a32);
  box-shadow: var(--wow-shadow);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
}

.card:not(.summary-card)::before {
  height: 2px;
  background: linear-gradient(
    90deg,
    var(--clr-teal-700-a92),
    var(--clr-sky-600-a85),
    var(--clr-amber-600-a82)
  );
  opacity: 0.95;
}

.card:not(.summary-card)::after,
.summary-card::after {
  display: block;
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(
    380px circle at var(--mx) var(--my),
    var(--clr-sky-600-a20),
    transparent 58%
  );
  opacity: 0;
  transition: opacity 0.35s var(--wow-ease);
}

.card.card-glow::after,
.card:hover::after {
  opacity: 1;
}

.card:hover {
  transform: translateY(-9px) scale(1.01);
}

.card-illus {
  display: grid !important;
  place-items: center;
  position: absolute;
  top: 14px;
  right: 14px;
  width: 2.15rem;
  height: 2.15rem;
  border-radius: 10px;
  font-size: 0.95rem;
  font-weight: 700;
  color: var(--clr-cyan-800);
  border: 1px solid var(--clr-teal-700-a35);
  background: var(--clr-white-50-a74);
  backdrop-filter: blur(8px);
  box-shadow: 0 8px 18px var(--clr-blue-950-a12-v2);
  animation: illusBob 4.5s ease-in-out infinite;
}

.hero-card {
  --hero-tilt-x: 0deg;
  --hero-tilt-y: 0deg;
  --hero-mx: 50%;
  --hero-my: 50%;
  min-height: 260px;
  border: 1px solid var(--clr-white-50-a34);
  background: linear-gradient(140deg, var(--clr-teal-800-v3) 0%, var(--clr-teal-800-v2) 38%, var(--clr-sky-700) 100%);
  box-shadow: 0 28px 60px var(--clr-teal-900-a35);
  transform-style: preserve-3d;
}

.hero-card::before {
  content: "";
  position: absolute;
  inset: -90% -30%;
  pointer-events: none;
  background: linear-gradient(
    120deg,
    var(--clr-white-50-a00),
    var(--clr-white-50-a25),
    var(--clr-white-50-a00)
  );
  transform: rotate(12deg);
  animation: heroSweep 10s linear infinite;
}

.hero-card::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(
    420px circle at var(--hero-mx) var(--hero-my),
    var(--clr-white-50-a32),
    transparent 60%
  );
  opacity: 0.8;
}

.hero-card:hover {
  transform: perspective(1050px) rotateX(var(--hero-tilt-x))
    rotateY(var(--hero-tilt-y)) translateY(-8px);
}

.hero-content,
.hero-graphic {
  position: relative;
  z-index: 2;
}

.hero-kicker {
  letter-spacing: 0.14em;
  font-size: 0.72rem;
}

.hero-value {
  font-size: clamp(2.1rem, 5vw, 3.1rem);
  text-shadow: 0 14px 28px var(--clr-blue-950-a32);
  animation: heroValuePulse 4.8s ease-in-out infinite;
}

.wallet-balances {
  gap: 0.55rem;
  margin-top: 0.7rem;
}

.wallet-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.32rem 0.72rem;
  border-radius: 999px;
  border: 1px solid var(--clr-white-50-a28);
  background: var(--clr-white-50-a16);
  font-size: 0.8rem;
  backdrop-filter: blur(4px);
  animation: fadeSlideIn 0.35s ease both;
}

.wallet-pill-label {
  display: inline-flex;
  align-items: center;
  gap: 0.32rem;
  opacity: 0.92;
}

.wallet-pill-value {
  font-size: 0.82rem;
  font-weight: 700;
  letter-spacing: 0.01em;
}

.budget-container {
  margin-top: 1rem;
  background: linear-gradient(
    165deg,
    var(--clr-white-50-a18),
    var(--clr-white-50-a06)
  );
  border: 1px solid var(--clr-white-50-a30);
  box-shadow: inset 0 1px 0 var(--clr-white-50-a22);
}

.budget-bar {
  height: 10px;
}

.budget-fill {
  box-shadow: 0 0 12px var(--clr-white-50-a55);
}

.hero-graphic {
  display: block;
  width: 260px;
  height: 190px;
  flex-shrink: 0;
}

.hero-orb {
  position: absolute;
  width: 134px;
  height: 134px;
  right: 8px;
  top: 8px;
  border-radius: 50%;
  background: radial-gradient(
    circle at 30% 30%,
    var(--clr-white-50-a95),
    var(--clr-white-50-a18) 45%,
    var(--clr-white-50-a02) 72%
  );
  box-shadow: 0 0 40px var(--clr-white-50-a28);
  animation: orbDriftA 7s ease-in-out infinite;
}

.hero-orb-2 {
  width: 90px;
  height: 90px;
  left: 16px;
  bottom: 14px;
  top: auto;
  right: auto;
  background: radial-gradient(
    circle at 32% 28%,
    var(--clr-white-50-a90),
    var(--clr-sky-500-a42),
    var(--clr-sky-500-a06)
  );
  animation: orbDriftB 6s ease-in-out infinite;
}

.hero-lines {
  position: absolute;
  inset: 18px 14px;
  border-radius: 20px;
  border: 1px solid var(--clr-white-50-a24);
  overflow: hidden;
  background: var(--clr-white-50-a06);
}

.hero-lines::before {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    105deg,
    var(--clr-white-50-a26),
    var(--clr-white-50-a26) 2px,
    transparent 2px,
    transparent 10px
  );
  opacity: 0.26;
  animation: lineScan 8s linear infinite;
}

.hero-lines::after {
  content: "";
  position: absolute;
  inset: -70% -30%;
  background: linear-gradient(
    110deg,
    var(--clr-white-50-a00),
    var(--clr-white-50-a45),
    var(--clr-white-50-a00)
  );
  transform: rotate(14deg);
  animation: heroShine 6.5s ease-in-out infinite;
}

.btn {
  border: 1px solid transparent;
  font-weight: 700;
  letter-spacing: 0.01em;
}

.btn::before {
  content: "";
  position: absolute;
  top: -120%;
  bottom: -120%;
  width: 48px;
  left: -70px;
  transform: rotate(20deg);
  background: linear-gradient(
    180deg,
    var(--clr-white-50-a00),
    var(--clr-white-50-a45),
    var(--clr-white-50-a00)
  );
  transition: transform 0.65s var(--wow-ease);
}

.btn:hover::before {
  transform: translateX(260px) rotate(20deg);
}

.btn-primary {
  background: linear-gradient(120deg, var(--clr-teal-700-v2), var(--clr-sky-600-v2));
  box-shadow: 0 14px 26px var(--clr-sky-600-a24);
}

.btn-primary:hover {
  background: linear-gradient(120deg, var(--clr-teal-700-v2), var(--clr-sky-700));
  transform: translateY(-2px);
}

.btn-accent {
  background: linear-gradient(120deg, var(--clr-sky-600-v2), var(--clr-sky-700));
}

.btn-ghost {
  background: var(--clr-white-50-a60);
  border-color: var(--clr-sky-400-a35);
}

.form-group input,
.form-group select,
.filter-group select,
.filter-group input[type="month"] {
  background: var(--clr-white-50-a78);
  border-color: var(--clr-sky-400-a35);
}

.summary-card {
  background: linear-gradient(
    150deg,
    var(--clr-white-50-a90),
    var(--clr-white-50-a72)
  );
}

.summary-grid {
  gap: 1rem;
}

.summary-item {
  border: 1px solid var(--clr-sky-400-a23);
  border-right: 1px solid var(--clr-sky-400-a23);
  border-radius: 14px;
  padding: 0.95rem 1rem;
  background: var(--clr-white-50-a62);
  backdrop-filter: blur(6px);
  transition:
    transform var(--transition),
    box-shadow var(--transition),
    border-color var(--transition);
}

.summary-item:last-child {
  padding-right: 1rem;
}

.summary-item:hover {
  transform: translateY(-4px);
  border-color: var(--clr-sky-600-a35);
  box-shadow: 0 10px 20px var(--clr-sky-700-a12);
}

.chart-container {
  align-items: flex-start;
}

#category-chart {
  filter: drop-shadow(0 16px 30px var(--clr-blue-950-a18));
  animation: chartHover 6s ease-in-out infinite;
}

.legend-item {
  padding: 0.35rem 0.5rem;
  border-radius: 10px;
  transition:
    background var(--transition),
    transform var(--transition);
}

.legend-item:hover {
  background: var(--clr-sky-600-a08);
  transform: translateX(4px);
}

.filter-card {
  background: linear-gradient(
    160deg,
    var(--clr-white-50-a88),
    var(--clr-white-50-a70)
  );
}

.table-card {
  background: linear-gradient(
    160deg,
    var(--clr-white-50-a86),
    var(--clr-white-50-a70)
  );
}

#expense-table tbody tr {
  border-radius: 12px;
}

#expense-table tbody tr:hover {
  box-shadow: 0 14px 28px var(--clr-blue-950-a12);
}

.badge {
  background: linear-gradient(
    130deg,
    var(--clr-teal-700-a18),
    var(--clr-sky-600-a20)
  );
  border: 1px solid var(--clr-sky-600-a28);
}

.goal-card {
  border-top: 1px solid var(--clr-sky-600-a35);
}

.goal-empty {
  text-align: center;
  padding: 1.6rem;
  border: 1px dashed var(--clr-sky-600-a36);
  background: var(--clr-white-50-a44);
  border-radius: 14px;
  color: var(--clr-text-secondary);
  font-size: 0.9rem;
  line-height: 1.55;
}

.goal-empty-hint {
  display: block;
  margin-top: 0.15rem;
  font-size: 0.8rem;
  opacity: 0.72;
}

.goal-item {
  position: relative;
  padding: 1rem;
  border-radius: 14px;
  border: 1px solid var(--clr-sky-400-a28);
  background: linear-gradient(
    145deg,
    var(--clr-white-50-a82),
    var(--clr-white-50-a65)
  );
  box-shadow: 0 14px 30px var(--clr-blue-950-a08);
  overflow: hidden;
}

.goal-item::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(
    300px circle at 0% 0%,
    var(--clr-sky-600-a18),
    transparent 60%
  );
}

.goal-item-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  gap: 0.75rem;
  margin-bottom: 0.55rem;
}

.goal-item-name {
  font-weight: 800;
  font-size: 1.02rem;
  color: var(--clr-text);
}

.goal-item-amount {
  text-align: right;
  font-size: 0.82rem;
  color: var(--clr-text-secondary);
  font-weight: 600;
}

.goal-progress-track {
  height: 10px;
  border-radius: 999px;
  background: var(--clr-sky-400-a22);
  overflow: hidden;
  margin-bottom: 0.8rem;
}

.goal-progress-fill {
  height: 100%;
  border-radius: inherit;
  background: linear-gradient(90deg, var(--clr-accent), var(--clr-success));
  box-shadow: 0 0 14px var(--clr-sky-600-a40);
  transition: width 0.8s var(--wow-ease);
}

.goal-item-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.75rem;
}

.goal-progress-label {
  font-size: 0.78rem;
  font-weight: 700;
  color: var(--clr-accent);
  letter-spacing: 0.02em;
}

.goal-action-group {
  display: flex;
  align-items: center;
  gap: 0.45rem;
}

.goal-action-group .btn-fund-goal {
  min-height: 34px;
  padding: 4px 10px;
  font-size: 0.76rem;
}

.goal-action-group .btn-del-goal {
  min-height: 34px;
  width: 34px;
  padding: 0;
  border-color: transparent;
  color: var(--clr-danger);
}

.goal-action-group .btn-del-goal:hover {
  background: var(--clr-danger-light);
  color: var(--clr-danger);
  border-color: var(--clr-red-500-a25);
}

.modal-overlay {
  background: var(--clr-blue-950-a46);
  backdrop-filter: blur(10px) saturate(125%);
}

.modal {
  border: 1px solid var(--clr-sky-400-a28);
}

.modal-overlay.active .modal {
  animation: modalPop 0.45s var(--wow-ease);
}

[data-theme="dark"] body {
  background:
    radial-gradient(
      1100px circle at 8% -12%,
      var(--clr-sky-600-a22),
      transparent 55%
    ),
    radial-gradient(
      840px circle at 90% -8%,
      var(--clr-teal-700-a16),
      transparent 50%
    ),
    linear-gradient(180deg, var(--clr-sky-950-v3) 0%, var(--clr-sky-950-v4) 45%, var(--clr-sky-950-v5) 100%);
}

[data-theme="dark"] body::before {
  background:
    radial-gradient(
      circle at 22% 18%,
      var(--clr-teal-700-a22),
      transparent 36%
    ),
    radial-gradient(
      circle at 78% 15%,
      var(--clr-sky-600-a24),
      transparent 34%
    ),
    radial-gradient(
      circle at 50% 88%,
      var(--clr-amber-600-a14),
      transparent 32%
    );
}

[data-theme="dark"] body::after {
  opacity: 0.06;
  mix-blend-mode: normal;
}

[data-theme="dark"] .header {
  background: var(--clr-sky-950-a72-v2);
  border-color: var(--clr-sky-400-a28);
}

[data-theme="dark"] .header::before {
  opacity: 0.36;
}

[data-theme="dark"] .btn-theme-toggle {
  background: var(--clr-sky-950-a72-v2);
}

[data-theme="dark"] .card,
[data-theme="dark"] .summary-card {
  background: linear-gradient(
    160deg,
    var(--clr-sky-950-a92),
    var(--clr-sky-950-a72)
  );
  border-color: var(--clr-sky-400-a25);
  box-shadow: 0 20px 48px var(--clr-blue-950-a50);
}

[data-theme="dark"] .card-illus {
  background: var(--clr-sky-950-a82);
  border-color: var(--clr-sky-500-a30);
  color: var(--clr-sky-500);
}

[data-theme="dark"] .btn-ghost {
  background: var(--clr-sky-950-a52);
  border-color: var(--clr-sky-400-a35);
  color: var(--clr-sky-200);
}

[data-theme="dark"] .form-group input,
[data-theme="dark"] .form-group select,
[data-theme="dark"] .filter-group select,
[data-theme="dark"] .filter-group input[type="month"] {
  background: var(--clr-sky-950-a72-v2);
  border-color: var(--clr-sky-400-a34);
}

[data-theme="dark"] .summary-item {
  background: var(--clr-sky-950-a62);
  border-color: var(--clr-sky-400-a26);
}

[data-theme="dark"] .goal-item {
  background: linear-gradient(
    145deg,
    var(--clr-sky-950-a80),
    var(--clr-sky-950-a62)
  );
  border-color: var(--clr-sky-400-a28);
}

[data-theme="dark"] .goal-empty {
  background: var(--clr-sky-950-a52);
  border-color: var(--clr-sky-400-a30);
}

[data-theme="dark"] .wallet-pill {
  background: var(--clr-sky-950-a36);
  border-color: var(--clr-white-50-a20);
}

[data-theme="dark"] .budget-container {
  background: linear-gradient(
    160deg,
    var(--clr-sky-950-a40),
    var(--clr-sky-950-a24)
  );
}

@media (max-width: 768px) {
  .header {
    width: calc(100% - 1rem);
    margin-top: 0.45rem;
    top: 0.35rem;
    border-radius: 18px;
    padding: 0.9rem 1rem;
  }

  .hero-card {
    min-height: 0;
    padding: 1.35rem;
  }

  .hero-card:hover {
    transform: translateY(-4px);
  }

  .hero-graphic {
    width: 100%;
    height: 122px;
  }

  .hero-lines {
    inset: 8px;
  }

  .summary-item {
    padding: 0.8rem 0.85rem;
  }

  .goal-item-footer {
    flex-direction: column;
    align-items: flex-start;
  }

  .goal-action-group {
    width: 100%;
  }

  .goal-action-group .btn-fund-goal {
    flex: 1;
  }
}

@media (max-width: 640px) {
  .container {
    padding: 0.9rem;
  }

  .header h1 {
    font-size: 1.14rem;
  }

  .header-subtitle {
    font-size: 0.74rem;
  }

  .header-icon {
    width: 2.5rem;
    height: 2.5rem;
  }

  .card {
    border-radius: 18px;
  }

  .hero-value {
    font-size: 1.9rem;
  }

  .hero-graphic {
    height: 95px;
  }

  .wallet-pill {
    width: 100%;
    justify-content: space-between;
  }
}

@media (prefers-reduced-motion: reduce) {
  body::before,
  body::after,
  .header-icon,
  .card-illus,
  .hero-card::before,
  .hero-value,
  .hero-orb,
  .hero-lines::before,
  .hero-lines::after,
  #category-chart {
    animation: none !important;
  }

  .card,
  .btn,
  .summary-item,
  .hero-card,
  .goal-item,
  .modal {
    transition: none !important;
  }

  .reveal-ready,
  .reveal-ready.revealed {
    opacity: 1 !important;
    transform: none !important;
    filter: none !important;
  }
}

@keyframes ambientOrbit {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(2%, -2%, 0) scale(1.04);
  }
  100% {
    transform: translate3d(-2%, 2%, 0) scale(1.02);
  }
}

@keyframes grainShift {
  0% {
    transform: translate(0, 0);
  }
  25% {
    transform: translate(0.7px, -0.7px);
  }
  50% {
    transform: translate(-0.7px, 0.7px);
  }
  75% {
    transform: translate(0.7px, 0.7px);
  }
  100% {
    transform: translate(0, 0);
  }
}

@keyframes headerIconFloat {
  0%,
  100% {
    transform: translateY(0) rotate(0deg);
  }
  50% {
    transform: translateY(-4px) rotate(-3deg);
  }
}

@keyframes illusBob {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-4px);
  }
}

@keyframes heroSweep {
  0% {
    transform: translateX(-18%) rotate(12deg);
  }
  100% {
    transform: translateX(22%) rotate(12deg);
  }
}

@keyframes orbDriftA {
  0%,
  100% {
    transform: translate3d(0, 0, 0);
  }
  50% {
    transform: translate3d(-12px, -8px, 0);
  }
}

@keyframes orbDriftB {
  0%,
  100% {
    transform: translate3d(0, 0, 0);
  }
  50% {
    transform: translate3d(10px, -10px, 0);
  }
}

@keyframes lineScan {
  0% {
    transform: translateX(-10px);
  }
  100% {
    transform: translateX(12px);
  }
}

@keyframes heroShine {
  0% {
    transform: translateX(-14%) rotate(14deg);
  }
  50% {
    transform: translateX(8%) rotate(14deg);
  }
  100% {
    transform: translateX(-14%) rotate(14deg);
  }
}

@keyframes heroValuePulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.015);
  }
}

@keyframes chartHover {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-4px);
  }
}

@keyframes modalPop {
  0% {
    transform: translateY(18px) scale(0.94);
  }
  60% {
    transform: translateY(-4px) scale(1.01);
  }
  100% {
    transform: translateY(0) scale(1);
  }
}

/* ===========================
   Professional Theme Refresh
   =========================== */
:root {
  --font-body:
    "Manrope", -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue",
    Arial, sans-serif;
  --font-heading:
    "Space Grotesk", "Manrope", -apple-system, BlinkMacSystemFont, "Segoe UI",
    "Helvetica Neue", Arial, sans-serif;
  --clr-bg: var(--clr-sky-50-v6);
  --clr-surface-solid: var(--clr-white-50);
  --clr-border: var(--clr-blue-950-a12);
  --clr-border-subtle: var(--clr-blue-950-a08);
  --shadow-sm: 0 8px 18px var(--clr-blue-950-a07);
  --shadow: 0 18px 42px var(--clr-blue-950-a10);
}

body {
  letter-spacing: -0.01em;
  text-rendering: optimizeLegibility;
  background:
    radial-gradient(
      950px circle at 8% -12%,
      var(--clr-sky-600-a11),
      transparent 54%
    ),
    radial-gradient(
      880px circle at 96% -18%,
      var(--clr-teal-700-a10-v2),
      transparent 55%
    ),
    linear-gradient(180deg, var(--clr-blue-50-v2) 0%, var(--clr-sky-50-v7) 52%, var(--clr-sky-50-v8) 100%);
}

h1,
h2,
h3,
.card-title,
.hero-title,
.summary-value,
.report-value {
  font-family: var(--font-heading);
  letter-spacing: -0.025em;
}

.header {
  width: min(1160px, calc(100% - 1.75rem));
  margin-top: 0.65rem;
  border: 1px solid var(--clr-white-50-a76);
  background: var(--clr-white-50-a72);
  box-shadow: 0 16px 30px var(--clr-blue-950-a10);
}

.header::before {
  opacity: 0.58;
}

.header h1 {
  font-weight: 700;
  font-size: clamp(1.15rem, 2vw, 1.45rem);
}

.header-subtitle {
  font-size: 0.79rem;
  font-weight: 500;
}

.container {
  max-width: 1160px;
  padding: clamp(1rem, 2.2vw, 2.1rem);
  gap: 1.05rem;
}

.card {
  border-radius: 20px;
  border: 1px solid var(--clr-border);
  box-shadow: var(--shadow-sm);
}

.card:hover {
  box-shadow: var(--shadow);
  transform: translateY(-6px);
}

.card-title {
  margin-bottom: 1rem;
  font-size: clamp(1rem, 1.8vw, 1.08rem);
  font-weight: 700;
}

.hero-card {
  border-radius: 22px;
  padding: clamp(1.25rem, 3vw, 2rem);
  background: linear-gradient(145deg, var(--clr-cyan-800-v2) 0%, var(--clr-teal-700-v3) 38%, var(--clr-sky-600-v3) 100%);
  box-shadow: 0 24px 48px var(--clr-teal-900-a28);
}

.hero-kicker {
  font-size: 0.7rem;
  font-weight: 700;
}

.hero-value {
  font-weight: 700;
  font-size: clamp(2rem, 5vw, 3rem);
}

.budget-container {
  border-radius: 16px;
  border-color: var(--clr-white-50-a33);
}

.summary-grid,
.report-grid {
  gap: 0.8rem;
}

.summary-item,
.report-item {
  border-radius: 14px;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a70);
  box-shadow: 0 8px 20px var(--clr-blue-950-a04);
}

.summary-label,
.report-label {
  font-size: 0.68rem;
  font-weight: 700;
}

.form-card,
.filter-card,
.table-card,
.chart-card,
.goal-card,
.report-card,
.category-budget-card {
  background: linear-gradient(
    165deg,
    var(--clr-white-50-a90),
    var(--clr-white-50-a74)
  );
  border-color: var(--clr-sky-400-a24);
}

.form-group label {
  font-size: 0.7rem;
  font-weight: 700;
}

.form-group input,
.form-group select,
.filter-group input,
.filter-group select,
.category-budget-input {
  border-radius: 11px;
  border-color: var(--clr-sky-400-a35);
  background: var(--clr-white-50-a90);
}

.form-group input:focus,
.form-group select:focus,
.filter-group input:focus,
.filter-group select:focus,
.category-budget-input:focus {
  box-shadow: 0 0 0 3px var(--clr-teal-700-a17);
}

.btn {
  border-radius: 11px;
  font-size: 0.84rem;
  font-weight: 700;
}

.btn-primary,
.btn-accent,
.btn-split {
  box-shadow: 0 12px 24px var(--clr-sky-700-a20);
}

#expense-table thead th {
  font-size: 0.67rem;
  letter-spacing: 0.08em;
  background: var(--clr-sky-100-a58);
}

#expense-table tbody td {
  font-size: 0.86rem;
}

.badge {
  border-radius: 999px;
  font-weight: 700;
}

.report-highlights {
  border-radius: 14px;
}

.category-budget-item {
  border-radius: 12px;
}

.modal {
  border-radius: 18px;
  border: 1px solid var(--clr-sky-400-a28);
}

[data-theme="dark"] {
  --clr-bg: var(--clr-sky-950-v6);
  --clr-surface-solid: var(--clr-sky-950-v7);
  --clr-border: var(--clr-sky-400-a24);
  --clr-border-subtle: var(--clr-sky-400-a18);
}

[data-theme="dark"] body {
  background:
    radial-gradient(
      960px circle at 8% -12%,
      var(--clr-sky-600-a20),
      transparent 54%
    ),
    radial-gradient(
      850px circle at 96% -18%,
      var(--clr-teal-700-a16),
      transparent 55%
    ),
    linear-gradient(180deg, var(--clr-sky-950-v8) 0%, var(--clr-sky-950-v9) 60%, var(--clr-sky-950-v10) 100%);
}

[data-theme="dark"] .header {
  border-color: var(--clr-sky-400-a28);
  background: var(--clr-sky-950-a78);
}

[data-theme="dark"] .summary-item,
[data-theme="dark"] .report-item,
[data-theme="dark"] .report-highlights,
[data-theme="dark"] .category-budget-item,
[data-theme="dark"] .form-card,
[data-theme="dark"] .filter-card,
[data-theme="dark"] .table-card,
[data-theme="dark"] .chart-card,
[data-theme="dark"] .goal-card,
[data-theme="dark"] .report-card,
[data-theme="dark"] .category-budget-card {
  background: linear-gradient(
    165deg,
    var(--clr-sky-950-a90),
    var(--clr-sky-950-a74)
  );
  border-color: var(--clr-sky-400-a26);
}

[data-theme="dark"] .form-group input,
[data-theme="dark"] .form-group select,
[data-theme="dark"] .filter-group input,
[data-theme="dark"] .filter-group select,
[data-theme="dark"] .category-budget-input {
  background: var(--clr-sky-950-a74-v2);
  border-color: var(--clr-sky-400-a36);
}

@media (max-width: 768px) {
  .header {
    width: calc(100% - 1rem);
    top: 0.35rem;
  }

  .container {
    padding: 0.95rem;
    gap: 0.9rem;
  }

  .card {
    border-radius: 17px;
  }

  .summary-item,
  .report-item {
    padding: 0.75rem 0.8rem;
  }
}

/* ===========================
   Search + Monthly Report + Category Budget
   =========================== */
.filter-fields {
  grid-template-columns: repeat(5, minmax(130px, 1fr));
}

.filter-group input[type="search"] {
  min-height: 44px;
  padding: 0.55rem 0.75rem;
  font-size: 0.85rem;
  font-family: var(--font-body);
  border: 1.5px solid var(--clr-border-subtle);
  border-radius: 10px;
  background: var(--clr-white-50-a90);
  color: var(--clr-text);
  outline: none;
  transition:
    border-color var(--transition),
    box-shadow var(--transition),
    background var(--transition);
}

.filter-group input[type="search"]:focus {
  border-color: var(--clr-primary);
  box-shadow: 0 0 0 3px var(--clr-primary-light);
  background: var(--clr-white-50-v2);
}

.report-card {
  border-color: var(--clr-sky-600-a28);
}

.report-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.8rem;
  margin-bottom: 0.85rem;
}

.report-header .card-title {
  margin-bottom: 0;
}

.report-month {
  display: inline-flex;
  align-items: center;
  min-height: 34px;
  padding: 0.35rem 0.75rem;
  border-radius: 999px;
  border: 1px solid var(--clr-sky-600-a35);
  background: var(--clr-sky-600-a12);
  font-size: 0.78rem;
  font-weight: 700;
  color: var(--clr-accent);
  letter-spacing: 0.02em;
}

.report-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 0.75rem;
}

.report-item {
  border: 1px solid var(--clr-sky-400-a24);
  border-radius: 12px;
  padding: 0.78rem 0.85rem;
  background: var(--clr-white-50-a58);
  backdrop-filter: blur(6px);
}

.report-label {
  display: block;
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--clr-text-secondary);
  margin-bottom: 0.35rem;
  font-weight: 700;
}

.report-value {
  font-family: var(--font-heading);
  font-size: 1.1rem;
  letter-spacing: -0.02em;
}

.report-value-income {
  color: var(--clr-success);
}

.report-value-expense {
  color: var(--clr-danger);
}

.report-value-positive {
  color: var(--clr-success);
}

.report-value-negative {
  color: var(--clr-danger);
}

.report-highlights {
  margin-top: 0.85rem;
  border: 1px solid var(--clr-sky-400-a22);
  border-radius: 12px;
  padding: 0.85rem 0.95rem;
  background: var(--clr-white-50-a48);
}

.report-line {
  font-size: 0.84rem;
  color: var(--clr-text-secondary);
}

.report-line + .report-line {
  margin-top: 0.35rem;
}

.report-advice {
  margin-top: 0.6rem;
  font-size: 0.82rem;
  color: var(--clr-text);
  font-weight: 600;
}

.category-budget-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  margin-bottom: 0.45rem;
}

.category-budget-header .card-title {
  margin-bottom: 0;
}

.category-budget-meta {
  font-size: 0.82rem;
  color: var(--clr-text-secondary);
  margin-bottom: 0.7rem;
}

.category-budget-list {
  display: grid;
  gap: 0.55rem;
}

.category-budget-item {
  border: 1px solid var(--clr-sky-400-a25);
  border-radius: 11px;
  padding: 0.7rem 0.8rem;
  background: var(--clr-white-50-a50);
}

.category-budget-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.category-budget-name {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.86rem;
  font-weight: 700;
}

.category-budget-amount {
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--clr-text-secondary);
}

.category-budget-track {
  height: 9px;
  border-radius: 999px;
  background: var(--clr-sky-400-a25);
  overflow: hidden;
}

.category-budget-fill {
  height: 100%;
  border-radius: inherit;
  width: 0;
  transition: width 0.5s var(--wow-ease);
}

.category-budget-fill.is-safe {
  background: linear-gradient(90deg, var(--clr-teal-700-v2), var(--clr-teal-600));
}

.category-budget-fill.is-warn {
  background: linear-gradient(90deg, var(--clr-amber-600), var(--clr-amber-500));
}

.category-budget-fill.is-over {
  background: linear-gradient(90deg, var(--clr-red-500), var(--clr-red-400));
}

.category-budget-empty {
  display: none;
  margin-top: 0.65rem;
  padding: 0.95rem;
  border-radius: 10px;
  border: 1px dashed var(--clr-sky-400-a35);
  color: var(--clr-text-secondary);
  font-size: 0.85rem;
  text-align: center;
}

.category-budget-empty.visible {
  display: block;
}

.category-budget-modal {
  max-width: 560px;
}

.category-budget-editor {
  display: grid;
  gap: 0.7rem;
  max-height: 50vh;
  overflow-y: auto;
  padding-right: 0.3rem;
  margin-bottom: 1.1rem;
}

.category-budget-edit-row {
  display: grid;
  grid-template-columns: minmax(0, 1fr) 170px;
  gap: 0.65rem;
  align-items: center;
}

.category-budget-edit-label {
  display: inline-flex;
  align-items: center;
  gap: 0.45rem;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--clr-text);
}

.category-budget-input {
  min-height: 42px;
  width: 100%;
  padding: 0.62rem 0.75rem;
  font-size: 0.88rem;
  font-family: var(--font-body);
  border: 1.5px solid var(--clr-border-subtle);
  border-radius: 10px;
  background: var(--clr-white-50-a88);
  color: var(--clr-text);
  outline: none;
  transition:
    border-color var(--transition),
    box-shadow var(--transition),
    background var(--transition);
}

.category-budget-input:focus {
  border-color: var(--clr-primary);
  box-shadow: 0 0 0 3px var(--clr-primary-light);
  background: var(--clr-white-50-v2);
}

[data-theme="dark"] .filter-group input[type="search"] {
  background: var(--clr-sky-950-a72-v2);
  border-color: var(--clr-sky-400-a34);
}

[data-theme="dark"] .filter-group input[type="search"]:focus {
  background: var(--clr-sky-950-a90-v2);
}

[data-theme="dark"] .category-budget-input {
  background: var(--clr-sky-950-a72-v2);
  border-color: var(--clr-sky-400-a34);
}

[data-theme="dark"] .report-item,
[data-theme="dark"] .report-highlights,
[data-theme="dark"] .category-budget-item {
  background: var(--clr-sky-950-a55);
  border-color: var(--clr-sky-400-a28);
}

[data-theme="dark"] .category-budget-empty {
  border-color: var(--clr-sky-400-a30);
  background: var(--clr-sky-950-a50);
}

@media (max-width: 980px) {
  .filter-fields {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }

  .report-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (max-width: 768px) {
  .filter-fields {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .report-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .category-budget-edit-row {
    grid-template-columns: 1fr;
  }

  .category-budget-input {
    width: 100%;
  }
}

@media (max-width: 640px) {
  .filter-fields {
    grid-template-columns: 1fr;
  }

  .report-grid {
    grid-template-columns: 1fr;
  }
}

/* ===========================
   Layout Readability Upgrade
   =========================== */
.container {
  max-width: 1240px;
  padding: clamp(1.1rem, 2.3vw, 2.35rem);
  gap: 1.22rem;
}

.card {
  padding: clamp(1.15rem, 2vw, 1.95rem);
  border-radius: 22px;
}

.card-title {
  font-size: clamp(1.02rem, 1.7vw, 1.16rem);
  margin-bottom: 1.08rem;
}

.hero-card {
  display: grid;
  grid-template-columns: minmax(0, 1.25fr) minmax(240px, 0.75fr);
  gap: clamp(1rem, 2.4vw, 2rem);
  align-items: center;
  min-height: 340px;
  padding: clamp(1.4rem, 2.8vw, 2.35rem);
}

.hero-content {
  max-width: 680px;
}

.hero-title {
  font-size: 1.3rem;
}

.hero-note,
.budget-note {
  font-size: 0.88rem;
}

.wallet-pill {
  min-height: 36px;
  padding: 0.42rem 0.82rem;
  font-size: 0.84rem;
}

.form-card,
.summary-card,
.report-card,
.goal-card,
.chart-card,
.category-budget-card,
.filter-card,
.table-card {
  padding: clamp(1.18rem, 2.1vw, 1.95rem);
}

.form-grid {
  gap: 1.05rem;
}

.form-group input,
.form-group select,
.filter-group input,
.filter-group select {
  min-height: 46px;
  font-size: 0.93rem;
}

.summary-grid,
.report-grid {
  gap: 0.95rem;
}

.summary-item,
.report-item {
  min-height: 104px;
  padding: 0.92rem 0.95rem;
}

.summary-value {
  font-size: 1.28rem;
}

.summary-item:first-child .summary-value {
  font-size: 1.72rem;
}

.report-value {
  font-size: 1.22rem;
}

.report-highlights {
  margin-top: 0.95rem;
  padding: 0.95rem 1rem;
}

.report-line {
  font-size: 0.9rem;
}

.report-advice {
  font-size: 0.88rem;
}

.goal-list,
.category-budget-list {
  gap: 0.72rem;
}

.goal-item {
  padding: 1.08rem;
}

.category-budget-item {
  padding: 0.85rem 0.9rem;
}

.chart-container {
  gap: clamp(1.2rem, 2.6vw, 2.6rem);
  padding: 0.65rem 0.25rem;
  align-items: center;
}

#category-chart {
  width: 320px;
  height: 320px;
}

.chart-legend {
  gap: 0.72rem;
}

.legend-item {
  padding: 0.45rem 0.58rem;
}

.legend-label {
  font-size: 0.9rem;
}

.legend-value {
  font-size: 0.88rem;
}

.filter-fields {
  grid-template-columns: repeat(5, minmax(165px, 1fr));
  gap: 0.82rem;
}

.filter-actions {
  gap: 0.7rem;
}

.filter-actions .btn {
  min-height: 46px;
}

.table-wrapper {
  max-height: 560px;
  margin: 0 -1.2rem;
  padding: 0 1.2rem;
}

#expense-table {
  font-size: 0.94rem;
}

#expense-table thead th {
  padding: 0.82rem 1rem;
}

#expense-table tbody td {
  padding: 0.95rem 1rem;
}

.amount {
  font-size: 0.95rem;
}

@media (max-width: 1100px) {
  .hero-card {
    grid-template-columns: 1fr;
    min-height: 0;
  }

  .hero-graphic {
    width: 100%;
    height: 150px;
  }

  .filter-fields {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

@media (max-width: 768px) {
  .container {
    padding: 1rem;
    gap: 0.95rem;
  }

  .card {
    border-radius: 18px;
  }

  .form-card,
  .summary-card,
  .report-card,
  .goal-card,
  .chart-card,
  .category-budget-card,
  .filter-card,
  .table-card {
    padding: 1rem;
  }

  .summary-item,
  .report-item {
    min-height: 90px;
  }

  #category-chart {
    width: 280px;
    height: 280px;
  }

  .filter-fields {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .table-wrapper {
    margin: 0;
    padding: 0;
    max-height: none;
  }
}

/* ===========================
   Performance Lite Mode
   =========================== */
html.perf-lite,
body.perf-lite {
  --transition: 0.18s ease-out;
}

body.perf-lite::before,
body.perf-lite::after {
  animation: none !important;
}

body.perf-lite .glass,
body.perf-lite .header,
body.perf-lite .card,
body.perf-lite .wallet-pill,
body.perf-lite .modal-overlay {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

body.perf-lite .card,
body.perf-lite .summary-item,
body.perf-lite .report-item,
body.perf-lite .goal-item,
body.perf-lite .category-budget-item,
body.perf-lite .modal,
body.perf-lite .toast {
  box-shadow: 0 6px 14px var(--clr-blue-950-a08) !important;
}

body.perf-lite .card::after,
body.perf-lite .summary-card::after {
  display: none !important;
}

body.perf-lite .header-icon,
body.perf-lite .card-illus,
body.perf-lite .hero-card::before,
body.perf-lite .hero-value,
body.perf-lite .hero-orb,
body.perf-lite .hero-lines::before,
body.perf-lite .hero-lines::after,
body.perf-lite #category-chart,
body.perf-lite .toast,
body.perf-lite .row-animate {
  animation: none !important;
}

body.perf-lite .card:hover,
body.perf-lite .summary-item:hover,
body.perf-lite .btn:hover,
body.perf-lite .hero-card:hover,
body.perf-lite #expense-table tbody tr:hover {
  transform: none !important;
}

body.perf-lite .reveal-ready,
body.perf-lite .reveal-ready.revealed {
  opacity: 1 !important;
  transform: none !important;
  filter: none !important;
  transition: none !important;
}

/* ===========================
   Wallet Management Styles
   =========================== */
.btn-manage-wallet {
  margin-top: 1rem;
  background: var(--clr-white-50-a15);
  border: 1px solid var(--clr-white-50-a30);
  color: var(--clr-white-50-v2);
  font-size: 0.85rem;
  padding: 0.5rem 1rem;
  border-radius: 99px;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.btn-manage-wallet:hover {
  background: var(--clr-white-50-a25);
  border-color: var(--clr-white-50-a50);
  color: var(--clr-white-50-v2);
}

.wallet-modal {
  max-width: 480px;
}

.wallet-add-row {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.wallet-add-row input,
.wallet-add-row select {
  font-size: 0.9rem;
  padding: 0.6rem;
}

.wallet-add-row select {
  width: 80px;
  cursor: pointer;
}

.wallet-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  max-height: 250px;
  overflow-y: auto;
  padding-right: 4px;
}

.wallet-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  background: var(--clr-bg);
  border: 1px solid var(--clr-border);
  border-radius: var(--radius);
  transition: var(--transition);
}

.wallet-item:hover {
  border-color: var(--clr-primary);
  background: var(--clr-primary-light);
}

.wallet-item-icon {
  width: 36px;
  height: 36px;
  background: var(--grad-primary);
  color: var(--clr-white-50-v2);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
}

.wallet-item-name {
  font-weight: 600;
  font-size: 0.95rem;
}

.wallet-item-meta {
  flex: 1;
  min-width: 0;
}

.wallet-item-usage {
  font-size: 0.74rem;
  color: var(--clr-text-secondary);
}

.btn-del-wallet[disabled] {
  opacity: 0.45;
  cursor: not-allowed;
}

/* ===========================
   Quick Add Styles
   =========================== */
.quick-add-card {
  margin-bottom: 2rem;
}

.quick-add-header {
  margin-bottom: 1.5rem;
}

.quick-add-subtitle {
  font-size: 0.85rem;
  color: var(--clr-text-secondary);
  margin-top: 0.25rem;
}

.quick-add-strip {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
  padding: 0.5rem 0.25rem 1rem;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

.quick-add-strip::-webkit-scrollbar {
  height: 6px;
}

.quick-add-strip::-webkit-scrollbar-thumb {
  background: var(--clr-border);
  border-radius: 10px;
}

.template-card {
  flex: 0 0 auto;
  width: 140px;
  background: var(--clr-bg);
  border: 1.5px solid var(--clr-border);
  border-radius: var(--radius-lg);
  padding: 1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
}

.template-card:hover {
  transform: translateY(-4px);
  border-color: var(--clr-primary);
  background: var(--clr-primary-light);
  box-shadow: var(--shadow);
}

.template-icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: var(--clr-border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  margin-bottom: 0.75rem;
}

.template-name {
  font-weight: 700;
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
  line-height: 1.2;
}

.template-amount {
  font-size: 0.75rem;
  color: var(--clr-text-secondary);
}

.btn-del-template {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: var(--clr-red-500-a10);
  color: var(--clr-danger);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  opacity: 0;
  transition: 0.2s;
}

.template-card:hover .btn-del-template {
  opacity: 1;
}

.quick-add-empty {
  text-align: center;
  padding: 2rem;
  color: var(--clr-text-secondary);
  font-size: 0.9rem;
  opacity: 0.7;
}

/* ===========================
   Trend Chart Styles
   =========================== */
.trend-card {
  margin-bottom: 2.5rem;
}

.trend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.trend-legend {
  display: flex;
  gap: 1rem;
  font-size: 0.8rem;
}

.trend-legend-item {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.trend-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.trend-legend-income .trend-dot {
  background: var(--clr-teal-700-v2);
}
.trend-legend-expense .trend-dot {
  background: var(--clr-red-500-v2);
}

.trend-chart-wrapper {
  margin-top: 1rem;
  min-height: 260px;
  position: relative;
  width: 100%;
  overflow-x: auto;
}

.trend-empty {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--clr-text-secondary);
  font-size: 0.9rem;
}

.trend-tooltip {
  position: absolute;
  background: var(--clr-blue-950-a95);
  color: white;
  padding: 0.75rem 1rem;
  border-radius: 12px;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s;
  z-index: 100;
  font-size: 0.85rem;
  box-shadow: 0 10px 15px -3px var(--clr-ink-950-a20);
  min-width: 140px;
}

/* ===========================
   Calendar View Styles
   =========================== */
.calendar-card {
  margin-bottom: 2.5rem;
  position: relative;
  overflow: hidden;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.calendar-nav {
  display: flex;
  align-items: center;
  gap: 1rem;
  background: var(--clr-bg);
  padding: 0.4rem 0.6rem;
  border: 1px solid var(--clr-border);
  border-radius: 99px;
}

.calendar-month-label {
  font-weight: 700;
  font-size: 0.9rem;
  min-width: 120px;
  text-align: center;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.cal-day-header {
  text-align: center;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  color: var(--clr-text-secondary);
  padding-bottom: 0.5rem;
}

.cal-day {
  aspect-ratio: 1;
  background: var(--clr-bg);
  border: 1px solid var(--clr-border);
  border-radius: 8px;
  padding: 4px;
  display: flex;
  flex-direction: column;
  gap: 2px;
  cursor: pointer;
  transition: 0.2s;
  min-height: 48px;
}

.cal-day:hover {
  background: var(--clr-primary-light);
  border-color: var(--clr-primary);
  transform: scale(1.05);
  z-index: 2;
}

.cal-day.empty {
  opacity: 0.3;
  cursor: default;
  pointer-events: none;
}

.cal-day.today {
  border: 2px solid var(--clr-primary) !important;
  background: var(--clr-teal-700-a05);
}

.cal-num {
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--clr-text-secondary);
}

.cal-spending {
  margin-top: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.cal-dots {
  display: flex;
  gap: 2px;
}

.cal-dot {
  width: 4px;
  height: 4px;
  border-radius: 50%;
}

.cal-amount {
  font-size: 0.6rem;
  font-weight: 700;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 100%;
}

.cal-amount-exp {
  color: var(--clr-danger);
}
.cal-amount-inc {
  color: var(--clr-success);
}

/* Day Detail Drawer-like overlay */
.calendar-day-detail {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--clr-surface-solid);
  z-index: 200;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.cal-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.cal-detail-summary {
  display: flex;
  gap: 1.5rem;
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: var(--clr-bg);
  border-radius: 12px;
  border: 1px solid var(--clr-border);
}

.cal-detail-list {
  flex: 1;
  overflow-y: auto;
}

.cal-item {
  display: flex;
  justify-content: space-between;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--clr-border);
}

.cal-item:last-child {
  border: none;
}

.cal-item-left {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

.cal-item-info strong {
  display: block;
  font-size: 0.9rem;
}

.cal-item-info span {
  font-size: 0.75rem;
  color: var(--clr-text-secondary);
}

/* ===========================
   Miscellaneous Fixes
   =========================== */
#expense-table th {
  white-space: nowrap;
}

.btn-pin {
  color: var(--clr-accent);
}

.btn-pin.active {
  color: var(--clr-white-50-v2);
  background: var(--clr-accent);
}

@media (max-width: 640px) {
  .trend-card {
    padding: 1rem;
  }
  .trend-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  .cal-num {
    font-size: 0.65rem;
  }
  .cal-amount {
    display: none;
  }
  .cal-day {
    min-height: 40px;
    padding: 2px;
  }
}

/* ===========================
   SAV1N-Inspired Redesign
   =========================== */
:root,
[data-theme="dark"] {
  --clr-bg: var(--clr-sky-950-v11);
  --clr-surface: var(--clr-sky-950-a88);
  --clr-surface-solid: var(--clr-sky-950-v12);
  --clr-surface-hover: var(--clr-sky-950-v13);
  --clr-border: var(--clr-white-50-a16);
  --clr-border-subtle: var(--clr-white-50-a08);
  --clr-text: var(--clr-sky-50-v9);
  --clr-text-secondary: var(--clr-sky-50-a65);
  --clr-primary: var(--clr-cyan-700);
  --clr-primary-hover: var(--clr-cyan-600);
  --clr-primary-light: var(--clr-cyan-700-a24);
  --clr-danger: var(--clr-red-600-v2);
  --clr-danger-hover: var(--clr-red-500-v3);
  --clr-danger-light: var(--clr-red-600-a18);
  --clr-accent: var(--clr-cyan-300);
  --clr-accent-hover: var(--clr-cyan-200);
  --clr-warning: var(--clr-orange-500);
  --clr-success: var(--clr-teal-600-v2);
  --shadow-sm: 0 22px 38px var(--clr-sky-950-a32);
  --shadow: 0 34px 72px var(--clr-sky-950-a48);
  --shadow-lg: 0 46px 88px var(--clr-sky-950-a56);
  --font-body: "Roboto", "Segoe UI", sans-serif;
  --font-heading: "Rubik", "Segoe UI", sans-serif;
  --transition: 0.26s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="light"] {
  --clr-bg: var(--clr-sky-950-v14);
  --clr-surface: var(--clr-sky-950-a88-v2);
  --clr-surface-solid: var(--clr-sky-950-v15);
  --clr-surface-hover: var(--clr-sky-900-v2);
  --clr-border: var(--clr-white-50-a17);
  --clr-border-subtle: var(--clr-white-50-a10);
  --clr-text: var(--clr-sky-50-v5);
  --clr-text-secondary: var(--clr-sky-50-a68);
}

body {
  position: relative;
  isolation: isolate;
  background:
    radial-gradient(
      58vw 58vw at -12% -18%,
      var(--clr-cyan-700-a24),
      transparent 64%
    ),
    radial-gradient(
      42vw 42vw at 110% 0%,
      var(--clr-blue-400-a16),
      transparent 66%
    ),
    var(--clr-bg);
  color: var(--clr-text);
  letter-spacing: 0.01em;
}

body::before,
body::after {
  content: "";
  position: fixed;
  pointer-events: none;
  z-index: -1;
  border-radius: 50%;
  filter: blur(42px);
}

body::before {
  width: 26rem;
  height: 26rem;
  left: -8rem;
  top: 42vh;
  background: var(--clr-cyan-700-a13);
}

body::after {
  width: 22rem;
  height: 22rem;
  right: -7rem;
  top: 26vh;
  background: var(--clr-cyan-300-a10);
}

.header {
  background: var(--clr-sky-950-a78-v2);
  border-bottom: 1px solid var(--clr-border);
  padding: 0.96rem 1.2rem;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

.header-inner {
  max-width: 1240px;
  gap: 0.85rem;
}

.header-icon {
  width: 2.8rem;
  height: 2.8rem;
  border-radius: 999px;
  border: 1px solid var(--clr-border);
  background: var(--clr-white-50-a04);
  color: var(--clr-accent);
  display: grid;
  place-items: center;
  font-size: 1.24rem;
  filter: none;
}

.header h1 {
  font-family: var(--font-heading);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-size: 0.95rem;
  font-weight: 600;
}

.header-subtitle {
  margin-top: 0.25rem;
  font-size: 0.62rem;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--clr-text-secondary);
}

.btn-theme-toggle {
  margin-left: auto;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 999px;
  border: 1px solid var(--clr-border);
  background: var(--clr-white-50-a04);
  color: var(--clr-text);
}

.btn-theme-toggle:hover {
  background: var(--clr-white-50-a10);
  border-color: var(--clr-cyan-700-a60);
  transform: translateY(-1px);
}

.container {
  max-width: 1240px;
  padding: 1.25rem clamp(1rem, 3vw, 2.4rem) 2.8rem;
  gap: 1.15rem;
}

.card {
  padding: 1.25rem;
  border-radius: 1.45rem;
  border: 1px solid var(--clr-border);
  background:
    linear-gradient(165deg, var(--clr-white-50-a05), var(--clr-white-50-a01)
      48%),
    var(--clr-surface-solid);
  box-shadow:
    inset 0 1px 0 var(--clr-white-50-a08),
    var(--shadow-sm);
}

.card::before {
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent,
    var(--clr-white-50-a35),
    transparent
  );
  opacity: 0.72;
}

.card:hover {
  border-color: var(--clr-cyan-700-a56);
  transform: translateY(-2px);
  box-shadow:
    inset 0 1px 0 var(--clr-white-50-a10),
    var(--shadow);
}

.card-title {
  margin-bottom: 0.92rem;
  text-transform: uppercase;
  letter-spacing: 0.14em;
  color: var(--clr-text-secondary);
  font-size: 0.67rem;
  font-weight: 600;
}

.card-title::before {
  display: none;
}

.card-illus {
  display: none !important;
}

.glass {
  background:
    linear-gradient(165deg, var(--clr-white-50-a04), var(--clr-white-50-a01)
      44%),
    var(--clr-surface-solid);
}

.hero-card {
  display: grid;
  grid-template-columns: minmax(0, 1.55fr) minmax(220px, 1fr);
  align-items: center;
  gap: 1.15rem;
  color: var(--clr-text);
  border: 1px solid var(--clr-cyan-700-a42);
  background:
    linear-gradient(
      130deg,
      var(--clr-cyan-700-a24),
      var(--clr-sky-950-a92-v2) 46%,
      var(--clr-sky-950-a95-v2)
    );
  box-shadow:
    inset 0 1px 0 var(--clr-white-50-a10),
    0 34px 74px var(--clr-sky-950-a58);
  padding: 1.45rem clamp(1.1rem, 2.7vw, 2.1rem);
}

.hero-card::after {
  content: "";
  position: absolute;
  width: 16rem;
  height: 16rem;
  right: -5rem;
  bottom: -6rem;
  background: radial-gradient(
    circle,
    var(--clr-cyan-300-a17),
    var(--clr-cyan-300-a00)
  );
  pointer-events: none;
}

.hero-content {
  max-width: none;
  position: relative;
  z-index: 1;
}

.hero-kicker {
  font-size: 0.63rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--clr-accent);
}

.hero-title {
  margin-top: 0.45rem;
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.14em;
  font-size: 0.64rem;
  font-weight: 500;
}

.hero-value {
  margin: 0.44rem 0 0.4rem;
  color: var(--clr-white-50);
  font-size: clamp(1.95rem, 4vw, 3.3rem);
  line-height: 1.08;
  letter-spacing: -0.01em;
}

.hero-note {
  color: var(--clr-text-secondary);
  font-size: 0.76rem;
  margin-top: 0.58rem;
}

.wallet-balances {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin: 0.8rem 0 0.95rem;
}

.wallet-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.42rem;
  border: 1px solid var(--clr-white-50-a17);
  background: var(--clr-white-50-a06);
  color: var(--clr-text);
  border-radius: 999px;
  padding: 0.35rem 0.72rem;
  font-size: 0.74rem;
}

.wallet-pill strong {
  color: var(--clr-white-50-v2);
  font-family: var(--font-heading);
  font-weight: 500;
}

.wallet-pill-icon {
  color: var(--clr-accent);
}

.budget-container {
  margin-top: 0.95rem;
  border: 1px solid var(--clr-border-subtle);
  border-radius: 1rem;
  padding: 0.9rem;
  background: var(--clr-ink-950-a28);
}

.budget-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
}

.budget-header-label {
  text-transform: uppercase;
  letter-spacing: 0.11em;
  font-size: 0.6rem;
  color: var(--clr-text-secondary);
}

.budget-stats {
  margin-top: 0.55rem;
  margin-bottom: 0.55rem;
  display: flex;
  align-items: baseline;
  gap: 0.45rem;
}

.budget-text-used {
  font-family: var(--font-heading);
  font-size: 1.03rem;
  color: var(--clr-white-50-v2);
}

.budget-text-limit {
  font-size: 0.72rem;
  color: var(--clr-text-secondary);
}

.budget-bar {
  height: 0.65rem;
  background: var(--clr-white-50-a08);
  border: 1px solid var(--clr-white-50-a12);
  border-radius: 999px;
}

.budget-fill {
  background: linear-gradient(90deg, var(--clr-cyan-700), var(--clr-cyan-300));
}

.budget-footer {
  margin-top: 0.58rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.budget-pct {
  font-family: var(--font-heading);
  font-size: 0.78rem;
  color: var(--clr-white-50-v2);
}

.hero-graphic {
  display: block;
  position: relative;
  min-height: 10.5rem;
  border-radius: 1rem;
  border: 1px solid var(--clr-white-50-a14);
  background: var(--clr-sky-950-a42);
  overflow: hidden;
}

.hero-orb {
  position: absolute;
  width: 8rem;
  height: 8rem;
  border-radius: 50%;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  background: radial-gradient(
    circle,
    var(--clr-cyan-700-a46),
    var(--clr-cyan-700-a00) 68%
  );
  filter: blur(1px);
}

.hero-orb-2 {
  width: 10.5rem;
  height: 10.5rem;
  background: radial-gradient(
    circle,
    var(--clr-cyan-300-a14),
    var(--clr-cyan-300-a00) 72%
  );
}

.hero-lines {
  position: absolute;
  inset: 13%;
  border-radius: 0.9rem;
  background:
    repeating-linear-gradient(
      120deg,
      var(--clr-white-50-a12) 0 1px,
      transparent 1px 12px
    ),
    repeating-linear-gradient(
      0deg,
      var(--clr-white-50-a07) 0 1px,
      transparent 1px 11px
    );
  opacity: 0.65;
}

.form-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.95rem;
}

.form-group label,
.filter-group label {
  font-size: 0.61rem;
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.15em;
}

.form-group input,
.form-group select,
.filter-group select,
.filter-group input,
.wallet-add-row input,
.wallet-add-row select,
.split-person-row input,
.category-budget-input,
#input-budget-limit {
  background: var(--clr-white-50-a04);
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.85rem;
  color: var(--clr-text);
  min-height: 2.7rem;
  padding: 0.7rem 0.9rem;
}

.form-group input::placeholder,
.filter-group input::placeholder,
.wallet-add-row input::placeholder,
.split-person-row input::placeholder {
  color: var(--clr-sky-100-a44);
}

.form-group input:focus,
.form-group select:focus,
.filter-group input:focus,
.filter-group select:focus,
.wallet-add-row input:focus,
.wallet-add-row select:focus,
.split-person-row input:focus,
.category-budget-input:focus,
#input-budget-limit:focus {
  border-color: var(--clr-cyan-700-a75);
  box-shadow: 0 0 0 3px var(--clr-cyan-700-a18);
  background: var(--clr-white-50-a07-v2);
}

.field-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.checkbox-group {
  margin-top: 0.7rem;
  padding: 0.55rem 0.7rem;
  border-radius: 0.82rem;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a03);
  gap: 0.55rem;
}

.checkbox-group label {
  text-transform: none;
  letter-spacing: 0.01em;
  font-size: 0.8rem;
  color: var(--clr-text);
}

.checkbox-group input {
  accent-color: var(--clr-primary);
}

.segmented-control {
  background: var(--clr-white-50-a03);
  border: 1px solid var(--clr-border-subtle);
  border-radius: 1rem;
  padding: 3px;
  height: 3.05rem;
}

.segmented-control label {
  font-family: var(--font-heading);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-size: 0.64rem;
  border-radius: 0.85rem;
}

.segmented-control input[type="radio"]:checked + label {
  color: var(--clr-sky-950-v16);
}

input[value="expense"]:checked + label {
  color: var(--clr-white-50-v2);
}

input[value="income"]:checked + label,
input[value="transfer"]:checked + label {
  color: var(--clr-sky-950-v16);
}

.segmented-bg {
  top: 3px;
  bottom: 3px;
  width: calc(33.333% - 2px);
  border-radius: 0.82rem;
  background: var(--clr-white-50);
}

input[value="expense"]:checked ~ .segmented-bg {
  background: var(--clr-danger);
}

input[value="income"]:checked ~ .segmented-bg {
  background: var(--clr-success);
}

input[value="transfer"]:checked ~ .segmented-bg {
  background: var(--clr-primary);
}

.form-actions {
  margin-top: 0.95rem;
  display: flex;
  gap: 0.55rem;
  flex-wrap: wrap;
}

.btn {
  border-radius: 999px;
  border: 1px solid var(--clr-border);
  background: var(--clr-white-50-a04);
  color: var(--clr-text);
  min-height: 2.5rem;
  padding: 0.55rem 0.95rem;
  font-family: var(--font-heading);
  font-size: 0.64rem;
  text-transform: uppercase;
  letter-spacing: 0.11em;
  line-height: 1;
  transition:
    transform var(--transition),
    border-color var(--transition),
    background var(--transition),
    color var(--transition),
    box-shadow var(--transition);
}

.btn:hover {
  transform: translateY(-1px);
  border-color: var(--clr-cyan-700-a70);
  background: var(--clr-white-50-a10);
}

.btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
  transform: none;
}

.btn-primary {
  background: var(--clr-white-50-v2);
  color: var(--clr-sky-950-v17);
  border-color: var(--clr-white-50-v2);
}

.btn-primary:hover {
  background: var(--clr-primary);
  border-color: var(--clr-primary);
  color: var(--clr-cyan-950);
  box-shadow: 0 0 0 3px var(--clr-cyan-700-a20);
}

.btn-ghost {
  background: var(--clr-white-50-a01);
  color: var(--clr-text);
}

.btn-accent {
  background: var(--clr-accent);
  border-color: var(--clr-accent);
  color: var(--clr-cyan-950);
}

.btn-accent:hover {
  background: var(--clr-accent-hover);
  border-color: var(--clr-accent-hover);
}

.btn-danger,
.btn-delete {
  background: var(--clr-red-600-a16);
  border-color: var(--clr-red-600-a50);
  color: var(--clr-red-200);
}

.btn-danger:hover,
.btn-delete:hover {
  border-color: var(--clr-red-600-a75);
  background: var(--clr-red-600-a24);
}

.btn-edit {
  background: var(--clr-cyan-300-a14);
  border-color: var(--clr-cyan-300-a45);
  color: var(--clr-cyan-100);
}

.btn-pin {
  background: var(--clr-cyan-700-a14);
  border-color: var(--clr-cyan-700-a46);
  color: var(--clr-cyan-300-v2);
}

.btn-pin.active {
  color: var(--clr-cyan-950-v2);
  background: var(--clr-accent);
  border-color: var(--clr-accent);
}

.btn-split {
  background: var(--clr-cyan-300-a14);
  border-color: var(--clr-cyan-300-a45);
  color: var(--clr-cyan-100);
}

.btn-sm {
  min-height: 2.1rem;
  padding: 0.46rem 0.78rem;
  font-size: 0.58rem;
}

.btn-icon {
  font-size: 0.88rem;
}

.btn-spinner {
  width: 0.9rem;
  height: 0.9rem;
  border: 2px solid var(--clr-sky-950-a22);
  border-top-color: var(--clr-sky-950-a86-v2);
  border-radius: 50%;
  animation: spin 0.55s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.summary-grid,
.report-grid {
  gap: 0.72rem;
  grid-template-columns: repeat(4, minmax(0, 1fr));
}

.summary-item,
.report-item {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.95rem;
  padding: 0.86rem 0.9rem;
  background: var(--clr-white-50-a02);
}

.summary-label,
.report-label {
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.13em;
  font-size: 0.58rem;
  margin-bottom: 0.42rem;
}

.summary-value,
.report-value {
  font-family: var(--font-heading);
  font-size: 0.98rem;
  color: var(--clr-white-50-v2);
}

.summary-value-sm {
  font-size: 0.78rem;
}

.summary-value-income,
.report-value-income,
.text-success {
  color: var(--clr-teal-400);
}

.summary-value-expense,
.report-value-expense {
  color: var(--clr-red-300);
}

.text-accent {
  color: var(--clr-cyan-300);
}

.report-value-positive {
  color: var(--clr-teal-400);
}

.report-value-negative {
  color: var(--clr-red-300);
}

.report-header,
.trend-header,
.calendar-header,
.goal-header,
.split-ledger-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.8rem;
  flex-wrap: wrap;
}

.report-month {
  border-radius: 999px;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a02);
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  font-size: 0.58rem;
  padding: 0.35rem 0.72rem;
}

.report-highlights {
  margin-top: 0.72rem;
  display: grid;
  gap: 0.52rem;
}

.report-line,
.report-advice {
  border: 1px dashed var(--clr-border-subtle);
  border-radius: 0.78rem;
  background: var(--clr-white-50-a02);
  color: var(--clr-text-secondary);
  font-size: 0.77rem;
  padding: 0.58rem 0.78rem;
}

.report-advice {
  border-style: solid;
  color: var(--clr-cyan-200-v2);
}

.quick-add-strip {
  display: flex;
  gap: 0.65rem;
  overflow-x: auto;
  padding-bottom: 0.2rem;
}

.template-card {
  min-width: 11.5rem;
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.95rem;
  background: var(--clr-white-50-a03);
  padding: 0.74rem 0.82rem 0.72rem;
  cursor: pointer;
  position: relative;
  transition:
    transform var(--transition),
    border-color var(--transition),
    background var(--transition);
}

.template-card:hover {
  transform: translateY(-2px);
  border-color: var(--clr-cyan-700-a62);
  background: var(--clr-cyan-700-a10);
}

.template-icon {
  width: 1.95rem;
  height: 1.95rem;
  border-radius: 0.6rem;
  display: grid;
  place-items: center;
  background: var(--clr-cyan-700-a20);
  color: var(--clr-cyan-200);
  margin-bottom: 0.42rem;
}

.template-name {
  font-size: 0.76rem;
  font-weight: 500;
  color: var(--clr-white-50-v2);
}

.template-amount {
  margin-top: 0.24rem;
  color: var(--clr-cyan-100-v2);
  font-family: var(--font-heading);
  font-size: 0.8rem;
}

.btn-del-template {
  position: absolute;
  top: 0.42rem;
  right: 0.42rem;
  width: 1.5rem;
  height: 1.5rem;
  border: 1px solid var(--clr-red-600-a44);
  border-radius: 999px;
  background: var(--clr-red-600-a14);
  color: var(--clr-red-200-v2);
  cursor: pointer;
}

.quick-add-empty,
.goal-empty,
.category-budget-empty,
.chart-empty,
.trend-empty,
.split-history-empty {
  color: var(--clr-text-secondary);
  font-size: 0.77rem;
}

.goal-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(16rem, 1fr));
  gap: 0.72rem;
}

.goal-empty {
  border: 1px dashed var(--clr-border-subtle);
  border-radius: 0.9rem;
  padding: 0.95rem;
}

.goal-empty-hint {
  display: block;
  margin-top: 0.32rem;
  font-size: 0.72rem;
}

.goal-item {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.92rem;
  background: var(--clr-white-50-a03);
  padding: 0.82rem;
  display: grid;
  gap: 0.72rem;
}

.goal-item-header {
  display: grid;
  gap: 0.2rem;
}

.goal-item-name {
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--clr-white-50-v2);
}

.goal-item-amount {
  font-size: 0.72rem;
  color: var(--clr-text-secondary);
}

.goal-progress-track {
  height: 0.62rem;
  background: var(--clr-white-50-a08);
  border-radius: 999px;
  overflow: hidden;
  border: 1px solid var(--clr-white-50-a13);
}

.goal-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--clr-cyan-700), var(--clr-cyan-300));
}

.goal-item-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.goal-progress-label {
  font-size: 0.7rem;
  color: var(--clr-text-secondary);
}

.goal-action-group {
  display: flex;
  gap: 0.42rem;
}

.goal-action-group .btn-del-goal {
  min-width: 2rem;
  padding: 0.45rem;
}

.chart-container {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 1rem;
  background: var(--clr-ink-950-a27);
  padding: 0.9rem;
  display: grid;
  gap: 0.82rem;
  grid-template-columns: minmax(220px, 285px) 1fr;
  align-items: center;
}

#category-chart {
  width: min(100%, 280px);
  height: auto;
  margin-inline: auto;
}

.chart-legend {
  display: grid;
  gap: 0.45rem;
  max-height: 16rem;
  overflow-y: auto;
  padding-right: 0.2rem;
}

.legend-item {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.74rem;
  background: var(--clr-white-50-a03);
  padding: 0.48rem 0.6rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.72rem;
  font-size: 0.73rem;
}

.chart-tooltip,
.trend-tooltip {
  pointer-events: none;
  opacity: 0;
  background: var(--clr-sky-950-v18);
  color: var(--clr-text);
  border: 1px solid var(--clr-border);
  border-radius: 0.65rem;
  padding: 0.34rem 0.5rem;
  box-shadow: 0 14px 25px var(--clr-ink-950-a45);
  font-size: 0.69rem;
}

.chart-tooltip.visible,
.trend-tooltip.visible {
  opacity: 1;
}

.trend-legend {
  display: flex;
  gap: 0.58rem;
  flex-wrap: wrap;
}

.trend-legend-item {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 999px;
  padding: 0.3rem 0.66rem;
  font-size: 0.64rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--clr-text-secondary);
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
}

.trend-dot {
  width: 0.46rem;
  height: 0.46rem;
  border-radius: 50%;
  display: inline-block;
  background: currentColor;
}

.trend-legend-income .trend-dot {
  color: var(--clr-teal-400);
}

.trend-legend-expense .trend-dot {
  color: var(--clr-red-300);
}

.trend-chart-wrapper {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 1rem;
  background: var(--clr-ink-950-a27);
  padding: 0.75rem;
  position: relative;
}

#trend-chart {
  width: 100%;
  height: auto;
}

.category-budget-meta {
  color: var(--clr-text-secondary);
  font-size: 0.76rem;
}

.category-budget-list {
  display: grid;
  gap: 0.52rem;
  margin-top: 0.7rem;
}

.category-budget-item,
.category-budget-edit-row {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.78rem;
  background: var(--clr-white-50-a03);
  padding: 0.55rem 0.68rem;
  display: grid;
  gap: 0.5rem;
  align-items: center;
}

.category-budget-editor {
  max-height: 52vh;
  overflow-y: auto;
  display: grid;
  gap: 0.55rem;
  padding-right: 0.18rem;
}

.category-budget-edit-label {
  font-size: 0.74rem;
  color: var(--clr-white-50-v2);
  display: inline-flex;
  align-items: center;
  gap: 0.38rem;
}

.category-budget-input {
  max-width: 11rem;
  justify-self: end;
}

.category-budget-empty {
  display: none;
}

.category-budget-empty.visible {
  display: block;
}

.calendar-nav {
  display: inline-flex;
  align-items: center;
  gap: 0.45rem;
}

.calendar-month-label {
  text-transform: uppercase;
  letter-spacing: 0.11em;
  font-size: 0.64rem;
  color: var(--clr-text-secondary);
}

.calendar-grid {
  gap: 0.42rem;
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.96rem;
  background: var(--clr-white-50-a02-v2);
  padding: 0.55rem;
}

.cal-day-header {
  text-transform: uppercase;
  letter-spacing: 0.15em;
  font-size: 0.52rem;
  color: var(--clr-text-secondary);
  text-align: center;
  padding-bottom: 0.25rem;
}

.cal-day {
  min-height: 4.8rem;
  border-radius: 0.72rem;
  border: 1px solid transparent;
  background: var(--clr-white-50-a03);
  padding: 0.32rem;
  transition: border-color var(--transition), background var(--transition);
}

.cal-day:hover {
  border-color: var(--clr-cyan-700-a55);
  background: var(--clr-cyan-700-a12);
}

.cal-day.today {
  border-color: var(--clr-cyan-700-a80);
}

.cal-day.empty {
  opacity: 0.26;
}

.cal-num {
  font-size: 0.64rem;
  color: var(--clr-text-secondary);
}

.cal-amount {
  font-size: 0.62rem;
  color: var(--clr-white-50-v2);
}

.calendar-day-detail {
  background: var(--clr-sky-950-v19);
  border: 1px solid var(--clr-border);
  border-radius: 1rem;
  padding: 1rem;
}

.cal-detail-summary {
  border-radius: 0.8rem;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a03);
}

.cal-item {
  border-bottom: 1px solid var(--clr-border-subtle);
}

.filter-layout {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 0.86rem;
}

.filter-fields {
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 0.68rem;
}

.filter-actions {
  display: flex;
  flex-wrap: wrap;
  align-content: flex-start;
  gap: 0.52rem;
  min-width: 13rem;
}

.undo-inline {
  border-radius: 999px;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a03);
  padding: 0.16rem 0.25rem 0.16rem 0.56rem;
}

.undo-indicator {
  color: var(--clr-text-secondary);
  font-size: 0.68rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.table-wrapper {
  border-radius: 1rem;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-ink-950-a28);
}

#expense-table,
#split-ledger-table {
  width: 100%;
  min-width: 58rem;
}

#expense-table thead th,
#split-ledger-table thead th {
  background: var(--clr-white-50-a03);
  border-bottom: 1px solid var(--clr-border-subtle);
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  font-size: 0.56rem;
  padding: 0.76rem 0.85rem;
}

#expense-table tbody td,
#split-ledger-table tbody td {
  border-bottom: 1px solid var(--clr-white-50-a06-v2);
  padding: 0.74rem 0.85rem;
  font-size: 0.78rem;
}

#expense-table tbody tr:hover,
#split-ledger-table tbody tr:hover {
  background: var(--clr-cyan-700-a09);
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 0.34rem;
  padding: 0.25rem 0.54rem;
  border: 1px solid var(--clr-border-subtle);
  border-radius: 999px;
  background: var(--clr-white-50-a04);
  font-size: 0.67rem;
}

.amount {
  font-family: var(--font-heading);
}

.action-group {
  display: flex;
  gap: 0.34rem;
  flex-wrap: wrap;
  justify-content: center;
}

.split-ledger-status,
.split-ledger-sync {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.54rem;
  border-radius: 999px;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a03);
  font-size: 0.58rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.split-ledger-status.receive {
  color: var(--clr-teal-300);
  border-color: var(--clr-teal-600-a45);
}

.split-ledger-status.pay {
  color: var(--clr-red-200-v3);
  border-color: var(--clr-red-600-a45);
}

.split-ledger-status.even,
.split-ledger-status.done {
  color: var(--clr-cyan-100-v2);
  border-color: var(--clr-cyan-300-a42);
}

.split-ledger-sync.synced {
  color: var(--clr-teal-300-v2);
  border-color: var(--clr-teal-600-a45);
}

.split-ledger-sync.pending {
  color: var(--clr-orange-200);
  border-color: var(--clr-orange-500-a45);
}

.render-state {
  color: var(--clr-text-secondary);
  font-size: 0.72rem;
  margin-bottom: 0.45rem;
}

.render-state.visible,
.empty-state.visible,
.split-ledger-empty.visible {
  display: block;
}

.empty-state,
.split-ledger-empty {
  display: none;
  border: 1px dashed var(--clr-border-subtle);
  border-radius: 0.84rem;
  color: var(--clr-text-secondary);
  font-size: 0.76rem;
  padding: 0.9rem;
  margin-top: 0.72rem;
}

.split-modal {
  width: min(100%, 54rem);
}

.split-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.7rem;
  margin-bottom: 0.85rem;
}

.split-header h2 {
  font-family: var(--font-heading);
  font-size: 0.82rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
}

.btn-close {
  width: 2rem;
  height: 2rem;
  border-radius: 999px;
  border: 1px solid var(--clr-border);
  background: var(--clr-white-50-a02);
  color: var(--clr-text);
}

.split-form-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.75rem;
}

.split-mode-toggle {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.52rem;
  margin: 0.82rem 0;
}

.split-mode-btn {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.8rem;
  background: var(--clr-white-50-a03);
  color: var(--clr-text-secondary);
  font-family: var(--font-heading);
  text-transform: uppercase;
  letter-spacing: 0.09em;
  font-size: 0.6rem;
  min-height: 2.35rem;
}

.split-mode-btn.active {
  border-color: var(--clr-cyan-700-a72);
  background: var(--clr-cyan-700-a20);
  color: var(--clr-cyan-100-v3);
}

.split-participants {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.9rem;
  background: var(--clr-white-50-a02);
  padding: 0.78rem;
}

.split-participants-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.62rem;
}

.split-person-list {
  display: grid;
  gap: 0.48rem;
}

.split-person-row {
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(8.2rem, 0.56fr) auto;
  gap: 0.44rem;
  align-items: center;
}

.custom-amount {
  display: none;
}

.custom-amount.visible {
  display: block;
}

.btn-remove-person {
  width: 2.2rem;
  height: 2.2rem;
  border-radius: 0.7rem;
  border: 1px solid var(--clr-red-600-a55);
  background: var(--clr-red-600-a16);
  color: var(--clr-red-200-v4);
}

.split-form-actions {
  margin-top: 0.9rem;
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.split-result-summary {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.9rem;
  background: var(--clr-white-50-a03);
  padding: 0.72rem;
  display: grid;
  gap: 0.25rem;
}

.result-bill-name {
  font-size: 0.8rem;
  font-weight: 600;
}

.result-total {
  font-family: var(--font-heading);
  font-size: 1.2rem;
  color: var(--clr-white-50-v2);
}

.result-people-count,
.result-payer,
.result-owner-status {
  font-size: 0.71rem;
  color: var(--clr-text-secondary);
}

.split-result-list {
  margin-top: 0.72rem;
  display: grid;
  gap: 0.48rem;
  max-height: 18rem;
  overflow-y: auto;
}

.split-result-item {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.8rem;
  background: var(--clr-white-50-a03);
  padding: 0.52rem 0.62rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.6rem;
}

.person-info {
  display: inline-flex;
  align-items: center;
  gap: 0.52rem;
}

.person-avatar {
  width: 2rem;
  height: 2rem;
  border-radius: 999px;
  display: grid;
  place-items: center;
  color: var(--clr-cyan-950);
  font-size: 0.62rem;
  font-weight: 700;
}

.person-text {
  display: grid;
}

.person-name {
  font-size: 0.76rem;
  color: var(--clr-white-50-v2);
}

.person-detail {
  font-size: 0.67rem;
  color: var(--clr-text-secondary);
}

.person-result {
  display: grid;
  justify-items: end;
  gap: 0.2rem;
}

.person-share {
  font-size: 0.67rem;
  color: var(--clr-text-secondary);
}

.person-settlement {
  font-size: 0.62rem;
  border-radius: 999px;
  border: 1px solid var(--clr-border-subtle);
  padding: 0.14rem 0.44rem;
}

.person-settlement.receive {
  color: var(--clr-teal-300-v3);
  border-color: var(--clr-teal-600-a40);
}

.person-settlement.pay {
  color: var(--clr-red-200-v5);
  border-color: var(--clr-red-600-a45);
}

.person-settlement.even {
  color: var(--clr-cyan-100-v4);
  border-color: var(--clr-cyan-300-a45);
}

.split-history {
  margin-top: 0.9rem;
  border-top: 1px solid var(--clr-border-subtle);
  padding-top: 0.8rem;
}

.split-history-title {
  font-size: 0.62rem;
  color: var(--clr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 0.5rem;
}

.split-history-list {
  display: grid;
  gap: 0.42rem;
  max-height: 11.5rem;
  overflow-y: auto;
}

.split-history-item {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.7rem;
  background: var(--clr-white-50-a03);
  padding: 0.52rem 0.62rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.7rem;
}

.hist-name {
  font-size: 0.74rem;
  color: var(--clr-white-50-v2);
}

.hist-meta {
  margin-top: 0.15rem;
  font-size: 0.64rem;
  color: var(--clr-text-secondary);
}

.hist-amount {
  font-size: 0.72rem;
  color: var(--clr-cyan-100-v5);
  font-family: var(--font-heading);
}

.wallet-add-row {
  display: grid;
  grid-template-columns: 1fr auto auto;
  gap: 0.48rem;
  margin-bottom: 0.72rem;
}

.wallet-list {
  display: grid;
  gap: 0.5rem;
  max-height: 18rem;
  overflow-y: auto;
}

.wallet-item {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.8rem;
  background: var(--clr-white-50-a03);
  padding: 0.5rem 0.65rem;
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 0.55rem;
  align-items: center;
}

.wallet-item-icon {
  width: 1.95rem;
  height: 1.95rem;
  border-radius: 0.62rem;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-cyan-700-a18);
  color: var(--clr-cyan-100-v6);
  display: grid;
  place-items: center;
}

.wallet-item-name {
  font-size: 0.76rem;
  color: var(--clr-white-50-v2);
}

.icon-selector {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(2.35rem, 1fr));
  gap: 0.42rem;
}

.icon-btn {
  min-height: 2.35rem;
  border-radius: 0.68rem;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a02);
  color: var(--clr-text-secondary);
}

.icon-btn:hover,
.icon-btn.selected {
  border-color: var(--clr-cyan-700-a75);
  color: var(--clr-cyan-100-v7);
  background: var(--clr-cyan-700-a18);
}

.import-options {
  display: grid;
  gap: 0.48rem;
}

.radio-option {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.82rem;
  background: var(--clr-white-50-a03);
  padding: 0.62rem 0.72rem;
  display: block;
}

.radio-option input {
  accent-color: var(--clr-primary);
}

.radio-label {
  margin-top: 0.25rem;
  display: block;
  color: var(--clr-white-50-v2);
  font-size: 0.71rem;
}

.radio-desc {
  margin-top: 0.16rem;
  display: block;
  color: var(--clr-text-secondary);
  font-size: 0.67rem;
}

.import-summary {
  border: 1px solid var(--clr-border-subtle);
  border-radius: 0.82rem;
  background: var(--clr-white-50-a03);
  padding: 0.64rem 0.72rem;
}

.import-summary-row {
  display: flex;
  justify-content: space-between;
  gap: 0.65rem;
  padding: 0.32rem 0;
  font-size: 0.73rem;
  border-bottom: 1px solid var(--clr-border-subtle);
}

.import-summary-row:last-child {
  border-bottom: 0;
}

.modal-overlay {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  background: var(--clr-blue-950-a74);
  backdrop-filter: blur(7px);
  -webkit-backdrop-filter: blur(7px);
}

.modal {
  width: min(100%, 34rem);
  max-height: min(90vh, 54rem);
  overflow-y: auto;
  border-radius: 1.2rem;
  border: 1px solid var(--clr-border);
  background:
    linear-gradient(165deg, var(--clr-white-50-a04), var(--clr-white-50-a01)
      44%),
    var(--clr-sky-950-v20);
  box-shadow: var(--shadow-lg);
  padding: 1.08rem;
}

.wallet-modal,
.category-budget-modal,
.split-modal {
  max-width: 100%;
}

.modal-icon {
  width: 3.2rem;
  height: 3.2rem;
  border-radius: 1rem;
  border: 1px solid var(--clr-border-subtle);
  background: var(--clr-white-50-a04);
  margin: 0 auto 0.72rem;
  display: grid;
  place-items: center;
}

.modal-text {
  margin-bottom: 0.35rem;
  text-align: center;
  font-size: 0.82rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  font-family: var(--font-heading);
}

.modal-subtext {
  text-align: center;
  color: var(--clr-text-secondary);
  font-size: 0.74rem;
  margin-bottom: 0.8rem;
}

.modal-actions {
  margin-top: 0.9rem;
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.toast-container {
  position: fixed;
  right: 1rem;
  bottom: 1rem;
  z-index: 400;
  display: grid;
  gap: 0.46rem;
  width: min(92vw, 22rem);
}

.toast {
  border: 1px solid var(--clr-border);
  border-radius: 0.82rem;
  background: var(--clr-sky-950-a92-v3);
  box-shadow: 0 16px 30px var(--clr-ink-950-a38);
  color: var(--clr-text);
  font-size: 0.74rem;
  padding: 0.54rem 0.66rem;
  display: flex;
  align-items: center;
  gap: 0.48rem;
}

.toast-success {
  border-color: var(--clr-teal-600-a48);
}

.toast-error {
  border-color: var(--clr-red-600-a48);
}

.toast-info {
  border-color: var(--clr-cyan-300-a45);
}

.toast-action {
  margin-left: auto;
  border: 1px solid var(--clr-cyan-300-a45);
  background: var(--clr-cyan-300-a16);
  color: var(--clr-cyan-100-v8);
  border-radius: 999px;
  padding: 0.2rem 0.5rem;
  font-size: 0.62rem;
  text-transform: uppercase;
  letter-spacing: 0.09em;
}

.toast-out {
  opacity: 0;
  transform: translateY(8px);
}

.footer {
  margin-top: auto;
  border-top: 1px solid var(--clr-border-subtle);
  color: var(--clr-text-secondary);
  text-align: center;
  font-size: 0.67rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  padding: 1rem 0.9rem 1.35rem;
}

@media (max-width: 1100px) {
  .filter-fields {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

@media (max-width: 960px) {
  .hero-card {
    grid-template-columns: 1fr;
  }

  .hero-graphic {
    min-height: 8.8rem;
  }

  .summary-grid,
  .report-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .chart-container {
    grid-template-columns: 1fr;
  }

  .filter-layout {
    grid-template-columns: 1fr;
  }

  .filter-actions {
    min-width: 0;
  }
}

@media (max-width: 820px) {
  .container {
    padding-inline: 0.85rem;
    gap: 0.88rem;
  }

  .header {
    padding: 0.76rem 0.85rem;
  }

  .header-subtitle {
    display: none;
  }

  .form-grid,
  .split-form-grid {
    grid-template-columns: 1fr;
  }

  .filter-fields {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .wallet-add-row {
    grid-template-columns: 1fr;
  }

  .table-wrapper {
    border: none;
    background: transparent;
    overflow: visible;
  }

  #expense-table,
  #split-ledger-table,
  #expense-table thead,
  #split-ledger-table thead,
  #expense-table tbody,
  #split-ledger-table tbody,
  #expense-table tr,
  #split-ledger-table tr,
  #expense-table td,
  #split-ledger-table td {
    display: block;
    width: 100%;
    min-width: 0;
  }

  #expense-table thead,
  #split-ledger-table thead {
    display: none;
  }

  #expense-table tbody tr,
  #split-ledger-table tbody tr {
    border: 1px solid var(--clr-border-subtle);
    border-radius: 0.95rem;
    background: var(--clr-white-50-a03);
    margin-bottom: 0.56rem;
    padding: 0.45rem;
  }

  #expense-table tbody td,
  #split-ledger-table tbody td {
    border: 0;
    padding: 0.35rem 0.4rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.75rem;
  }

  #expense-table tbody td::before,
  #split-ledger-table tbody td::before {
    content: attr(data-label);
    color: var(--clr-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.57rem;
    flex-shrink: 0;
    max-width: 48%;
  }

  .action-group {
    justify-content: flex-end;
  }

  .split-person-row {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 560px) {
  .summary-grid,
  .report-grid,
  .filter-fields {
    grid-template-columns: 1fr;
  }

  .hero-value {
    font-size: 1.7rem;
  }

  .form-actions .btn,
  .modal-actions .btn,
  .filter-actions .btn,
  .split-form-actions .btn,
  .goal-action-group .btn {
    width: auto;
  }
}

/* ===========================
   UX Enhancement Layer (Incremental)
   =========================== */
:root,
[data-theme="dark"] {
  --clr-primary: var(--clr-cyan-700-v2);
  --clr-primary-hover: var(--clr-cyan-700-v3);
  --clr-primary-light: var(--clr-cyan-700-a24-v2);
  --clr-accent: var(--clr-red-500-v4);
  --clr-accent-hover: var(--clr-red-500-v5);
  --clr-danger: var(--clr-red-500-v5);
  --clr-danger-hover: var(--clr-red-600-v3);
  --clr-danger-light: var(--clr-red-500-a20);
  --clr-text: var(--clr-sky-50-v10);
  --clr-text-secondary: var(--clr-sky-50-a80);
  --clr-border: var(--clr-sky-200-a28);
  --clr-border-subtle: var(--clr-sky-200-a18);
}

[data-theme="light"] {
  --clr-bg: var(--clr-sky-50-v11);
  --clr-surface: var(--clr-white-50-a92);
  --clr-surface-solid: var(--clr-white-50);
  --clr-surface-hover: var(--clr-sky-50-v12);
  --clr-text: var(--clr-sky-950-v21);
  --clr-text-secondary: var(--clr-sky-700-v3);
  --clr-border: var(--clr-sky-950-a14);
  --clr-border-subtle: var(--clr-sky-950-a08);
}

[data-theme="light"] body {
  background:
    radial-gradient(54vw 54vw at -8% -18%, var(--clr-cyan-700-a17), transparent 66%),
    radial-gradient(44vw 44vw at 108% 4%, var(--clr-red-500-a12), transparent 68%),
    var(--clr-bg);
  color: var(--clr-text);
}

.header h1 {
  font-size: clamp(1.05rem, 1.35vw, 1.3rem);
  font-weight: 700;
  letter-spacing: 0.07em;
}

.header-subtitle {
  font-size: 0.7rem;
  letter-spacing: 0.11em;
}

.container {
  gap: 1.28rem;
}

.card {
  padding: clamp(1.2rem, 2.2vw, 1.7rem);
}

.card-title {
  margin-bottom: 1.05rem;
  text-transform: none;
  letter-spacing: 0.02em;
  color: var(--clr-text);
  font-size: clamp(1rem, 1.18vw, 1.18rem);
  font-weight: 700;
}

.hero-title {
  color: var(--clr-text-secondary);
  font-size: 0.74rem;
  font-weight: 700;
  letter-spacing: 0.12em;
}

.form-grid {
  gap: 1rem;
}

.summary-grid,
.report-grid {
  gap: 0.95rem;
}

.summary-label,
.report-label {
  font-size: 0.62rem;
  color: var(--clr-text-secondary);
}

.summary-value,
.report-value {
  font-size: 1.04rem;
}

.chart-container,
.trend-chart-wrapper,
.table-wrapper {
  margin-top: 0.3rem;
}

.btn-primary {
  background: var(--clr-primary);
  border-color: var(--clr-primary);
  color: var(--clr-cyan-50);
}

.btn-primary:hover {
  background: var(--clr-primary-hover);
  border-color: var(--clr-primary-hover);
  color: var(--clr-cyan-50);
  box-shadow: 0 0 0 3px var(--clr-cyan-700-a24-v2);
}

.btn-accent,
.btn-pin.active {
  background: var(--clr-accent);
  border-color: var(--clr-accent);
  color: var(--clr-red-50);
}

.btn-accent:hover,
.btn-pin.active:hover {
  background: var(--clr-accent-hover);
  border-color: var(--clr-accent-hover);
}

.btn-danger,
.btn-delete {
  background: var(--clr-red-500-a18-v2);
  border-color: var(--clr-red-500-a62);
  color: var(--clr-red-100-v2);
}

.btn-danger:hover,
.btn-delete:hover {
  border-color: var(--clr-red-500-a82);
  background: var(--clr-red-500-a28);
}

button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
a:focus-visible {
  outline: 3px solid var(--clr-accent);
  outline-offset: 2px;
  box-shadow: 0 0 0 3px var(--clr-red-500-a22-v2);
}

.form-group input.invalid,
.form-group select.invalid,
.filter-group input.invalid,
.filter-group select.invalid {
  border-color: var(--clr-accent) !important;
  box-shadow: 0 0 0 3px var(--clr-red-500-a20) !important;
}

.help-text {
  min-height: 1.05rem;
  margin-top: 0.34rem;
  font-size: 0.74rem;
  color: var(--clr-red-200-v6);
  font-weight: 600;
}

[data-theme="light"] .help-text {
  color: var(--clr-red-600-v4);
}

.toast {
  background: var(--clr-sky-950-a96);
  color: var(--clr-text);
  border: 1px solid var(--clr-border);
}

[data-theme="light"] .toast {
  background: var(--clr-white-50);
  color: var(--clr-sky-950-v21);
}

.toast-success {
  border-left: 4px solid var(--clr-primary);
}

.toast-error {
  border-left: 4px solid var(--clr-accent);
}

.toast-info {
  border-left: 4px solid var(--clr-cyan-300-a90);
}

.u-stack-sm > * + * {
  margin-top: 0.5rem;
}

.u-stack-md > * + * {
  margin-top: 0.9rem;
}

.u-stack-lg > * + * {
  margin-top: 1.25rem;
}

.u-text-muted {
  color: var(--clr-text-secondary);
}

.u-text-strong {
  font-weight: 700;
}

.u-bg-surface {
  background: var(--clr-surface-solid);
}

@media (max-width: 820px) {
  .card {
    padding: 1.05rem;
  }

  .form-actions .btn,
  .filter-actions .btn,
  .modal-actions .btn {
    min-width: 0;
  }
}

@media (max-width: 560px) {
  .container {
    gap: 0.92rem;
  }

  .card-title {
    font-size: 0.95rem;
  }
}

/* ====== Redesign Override: Navigation, Tabs, Mobile-First, Empty State ====== */
:root {
  --primary-500: var(--clr-cyan-800);
  --primary-600: var(--clr-cyan-900);
  --primary-50: var(--clr-cyan-100-v9);
  --bg: var(--clr-teal-50);
  --surface: var(--clr-white-50);
  --surface-soft: var(--clr-teal-50-v2);
  --border: var(--clr-teal-200);
  --text: var(--clr-blue-950);
  --text-muted: var(--clr-slate-700);
  --success-500: var(--clr-teal-700-v4);
  --danger-500: var(--clr-red-600-v5);
  --accent-500: var(--clr-sky-600-v2);
  --shadow-soft: 0 14px 32px var(--clr-cyan-800-a09);
  --radius-card: 12px;
  --radius-input: 8px;
  --space-1: 8px;
  --space-2: 16px;
  --space-3: 24px;
  --space-4: 32px;
  --fs-1: 0.875rem;
  --fs-2: 1rem;
  --fs-3: 1.5rem;
}

html,
body,
button,
input,
select,
textarea {
  font-family: "Manrope", sans-serif !important;
}

body {
  background:
    radial-gradient(circle at 0 0, var(--clr-cyan-800-a10), transparent 40%),
    radial-gradient(circle at 100% 0, var(--clr-teal-700-a10-v2), transparent 38%),
    var(--bg) !important;
  color: var(--text) !important;
  font-size: var(--fs-2);
}

.header {
  background: var(--clr-teal-50-a88) !important;
  border-bottom: 1px solid var(--border) !important;
}

.header h1 {
  font-size: var(--fs-3) !important;
}

.header-subtitle {
  color: var(--text-muted) !important;
}

.btn-theme-toggle {
  margin-left: auto;
  min-height: 44px;
  min-width: 44px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--surface);
}

.app-shell {
  max-width: 1280px;
  margin: 0 auto;
  width: 100%;
  padding: var(--space-2);
  display: grid;
  grid-template-columns: 250px minmax(0, 1fr);
  gap: var(--space-3);
  align-items: start;
}

.side-nav {
  position: sticky;
  top: 86px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-card);
  padding: var(--space-2);
  box-shadow: var(--shadow-soft);
}

.side-nav-title {
  font-size: var(--fs-1);
  color: var(--text-muted);
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.side-nav-list {
  list-style: none;
  display: grid;
  gap: 8px;
}

.nav-link {
  width: 100%;
  border: 0;
  min-height: 44px;
  border-radius: 10px;
  padding: 0 12px;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  justify-content: flex-start;
  background: transparent;
  color: var(--text);
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
}

.nav-link:hover {
  background: var(--surface-soft);
}

.nav-link.is-active,
.nav-link[aria-selected="true"] {
  background: linear-gradient(120deg, var(--primary-500), var(--clr-cyan-700-v4));
  color: var(--clr-white-50-v2);
}

.nav-link i {
  font-size: 1.1rem;
}

.container {
  max-width: none !important;
  margin: 0 !important;
  padding: 0 !important;
  display: grid;
  gap: var(--space-2);
}

.container > section[data-view] {
  display: none;
}

.container > section[data-view].is-active {
  display: block;
  animation: fadeView 0.26s ease;
}

@keyframes fadeView {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.card {
  border-radius: var(--radius-card) !important;
  border: 1px solid var(--border) !important;
  background: var(--surface) !important;
  box-shadow: var(--shadow-soft) !important;
}

.hero-card {
  min-height: 260px;
}

.hero-value {
  font-size: clamp(2rem, 5vw, 3rem) !important;
  text-align: center;
}

.hero-title,
.hero-kicker,
.hero-note {
  text-align: center;
}

.wallet-balances {
  justify-content: center;
}

.wallet-pill {
  border-radius: 999px !important;
  border: 1px solid var(--border) !important;
  background: var(--surface-soft) !important;
}

.dashboard-monthly-stats {
  margin-top: 10px;
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
}

.dashboard-stat {
  border: 1px solid var(--border);
  border-radius: 12px;
  background: var(--surface-soft);
  padding: 10px;
}

.dashboard-stat-label {
  font-size: var(--fs-1);
  color: var(--text-muted);
}

.dashboard-stat-value {
  margin-top: 4px;
  font-size: 1.1rem;
  font-weight: 800;
}

.form-grid,
.filter-fields,
.report-grid,
.summary-grid {
  gap: 12px !important;
}

.form-group input,
.form-group select,
.filter-group input,
.filter-group select {
  border-radius: var(--radius-input) !important;
  min-height: 44px;
  border: 1px solid var(--border) !important;
  background: var(--surface-soft) !important;
}

.btn {
  border-radius: 10px !important;
  min-height: 44px;
  font-size: var(--fs-1);
}

#btn-submit,
.fab-add {
  background: linear-gradient(120deg, var(--primary-500), var(--clr-cyan-700-v4)) !important;
}

.empty-block,
.empty-state,
.quick-add-empty,
.chart-empty,
.trend-empty,
.category-budget-empty,
.split-ledger-empty {
  border: 1px dashed var(--border);
  border-radius: 12px;
  padding: 14px;
  text-align: center;
  background: linear-gradient(180deg, var(--clr-white-50), var(--clr-teal-50-v3));
}

.empty-svg {
  width: 84px;
  height: 84px;
  margin: 0 auto 8px;
  color: var(--primary-500);
}

.empty-title {
  font-size: var(--fs-2);
  font-weight: 800;
}

.empty-text {
  color: var(--text-muted);
  font-size: var(--fs-1);
  margin: 6px 0 10px;
}

.quick-add-empty {
  display: block;
}

.conditional-group {
  display: flex !important;
  flex-direction: column;
  overflow: hidden;
  transition: max-height 0.28s ease, opacity 0.24s ease, transform 0.24s ease;
  transform-origin: top;
  max-height: 260px;
  opacity: 1;
  transform: translateY(0);
}

.conditional-group[data-collapsed="true"] {
  max-height: 0 !important;
  opacity: 0;
  transform: translateY(-8px);
  pointer-events: none;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
}

.table-wrapper {
  overflow-x: auto;
}

#expense-table tbody tr.row-new {
  animation: rowNew 2.4s ease;
}

@keyframes rowNew {
  0% {
    background: var(--clr-teal-700-a22);
  }
  100% {
    background: transparent;
  }
}

.recent-card-list {
  display: grid;
  gap: 10px;
}

.recent-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
  background: var(--surface-soft);
}

.recent-row-main {
  min-width: 0;
}

.recent-row-title {
  font-weight: 700;
}

.recent-row-meta {
  font-size: var(--fs-1);
  color: var(--text-muted);
}

.recent-row-amount {
  font-weight: 800;
}

.bottom-nav {
  position: fixed;
  z-index: 45;
  left: 0;
  right: 0;
  bottom: 0;
  display: none;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 2px;
  border-top: 1px solid var(--border);
  background: var(--clr-white-50-a96);
  backdrop-filter: blur(8px);
  padding: 6px 6px 8px;
}

.bottom-link {
  min-height: 56px;
  border: 0;
  border-radius: 10px;
  background: transparent;
  font-size: 0.74rem;
  display: grid;
  place-items: center;
  gap: 4px;
  color: var(--text-muted);
  font-weight: 700;
}

.bottom-link i {
  font-size: 1.18rem;
}

.bottom-link.is-active {
  background: var(--primary-50);
  color: var(--primary-600);
}

.fab-add {
  position: fixed;
  right: 16px;
  bottom: 78px;
  width: 58px;
  height: 58px;
  border-radius: 999px;
  border: 0;
  display: none;
  align-items: center;
  justify-content: center;
  color: var(--clr-white-50-v2);
  font-size: 1.45rem;
  box-shadow: 0 14px 28px var(--clr-cyan-800-a30);
  z-index: 48;
}

button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
a:focus-visible {
  outline: 3px solid var(--clr-sky-600-v2) !important;
  outline-offset: 2px;
}

@media (max-width: 1024px) {
  .app-shell {
    grid-template-columns: 1fr;
    padding: 12px;
  }

  .side-nav {
    display: none;
  }

  .bottom-nav,
  .fab-add {
    display: grid;
  }

  .fab-add {
    display: inline-flex;
  }

  .container {
    padding-bottom: 110px !important;
  }

  .dashboard-monthly-stats {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 760px) {
  .header-inner {
    gap: 10px;
  }

  .header h1 {
    font-size: 1.2rem !important;
  }

  #expense-table thead,
  #split-ledger-table thead {
    display: none;
  }

  #expense-table,
  #split-ledger-table,
  #expense-table tbody,
  #split-ledger-table tbody,
  #expense-table tr,
  #split-ledger-table tr,
  #expense-table td,
  #split-ledger-table td {
    display: block;
    width: 100%;
  }

  #expense-table tbody tr,
  #split-ledger-table tbody tr {
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 10px;
    padding: 8px;
    background: var(--surface-soft);
  }

  #expense-table td,
  #split-ledger-table td {
    border: 0 !important;
    padding: 7px 4px;
    text-align: left !important;
  }

  #expense-table td::before,
  #split-ledger-table td::before {
    content: attr(data-label);
    display: block;
    font-size: 0.72rem;
    color: var(--text-muted);
    margin-bottom: 3px;
  }

  .action-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: flex-start;
  }

  .footer {
    display: none;
  }
}

@media (max-width: 390px) {
  :root {
    --fs-1: 0.8125rem;
    --fs-2: 0.9375rem;
    --fs-3: 1.22rem;
  }

  body {
    font-size: var(--fs-1);
    overflow-x: hidden;
  }

  .header {
    padding: 10px 12px !important;
  }

  .header-subtitle {
    display: none;
  }

  .app-shell {
    padding: 8px;
    gap: 10px;
  }

  .container {
    gap: 10px;
    padding-bottom: 116px !important;
  }

  .card {
    padding: 12px !important;
    border-radius: 10px !important;
  }

  .card-title {
    font-size: 0.96rem !important;
    margin-bottom: 8px;
  }

  .hero-card {
    min-height: 0;
    padding: 14px 12px !important;
  }

  .hero-value {
    font-size: clamp(1.55rem, 9vw, 2.1rem) !important;
    line-height: 1.1;
  }

  .wallet-balances {
    gap: 6px;
    margin-top: 8px;
  }

  .wallet-pill {
    width: 100%;
    justify-content: space-between;
    padding: 8px 10px !important;
  }

  .budget-container {
    margin-top: 10px !important;
    padding: 10px !important;
  }

  .dashboard-stat {
    padding: 9px;
  }

  .dashboard-stat-value {
    font-size: 1rem;
  }

  .summary-grid,
  .report-grid {
    grid-template-columns: 1fr !important;
  }

  .form-grid {
    gap: 10px !important;
  }

  .form-group label,
  .filter-group label {
    font-size: 0.73rem !important;
    letter-spacing: 0.02em;
    text-transform: none;
  }

  .form-group input,
  .form-group select,
  .filter-group input,
  .filter-group select,
  .wallet-add-row input,
  .wallet-add-row select,
  .split-person-row input,
  .category-budget-input,
  #input-budget-limit {
    font-size: 16px;
    padding: 10px 11px;
  }

  .segmented-control {
    height: auto;
  }

  .segmented-control label {
    font-size: 0.69rem !important;
    letter-spacing: 0;
    min-height: 44px;
    padding: 0 6px;
    gap: 4px;
  }

  .segmented-control label i {
    font-size: 0.9rem;
  }

  .recent-row {
    flex-direction: column;
    align-items: flex-start;
  }

  .recent-row-amount {
    align-self: flex-end;
  }

  .empty-svg {
    width: 68px;
    height: 68px;
  }

  .form-actions,
  .filter-actions,
  .modal-actions,
  .split-form-actions {
    gap: 8px;
  }

  .form-actions .btn,
  .filter-actions .btn,
  .modal-actions .btn,
  .split-form-actions .btn,
  .goal-action-group .btn {
    width: 100% !important;
    justify-content: center;
  }

  .goal-action-group {
    width: 100%;
  }

  .goal-action-group .btn-del-goal {
    min-width: 44px;
  }

  .quick-add-strip {
    gap: 8px;
  }

  .calendar-grid {
    padding: 6px;
    gap: 4px;
  }

  .cal-day {
    min-height: 72px;
    padding: 4px;
  }

  .cal-num {
    font-size: 0.72rem;
  }

  .trend-legend {
    gap: 6px;
    flex-wrap: wrap;
  }

  .table-wrapper {
    margin: 0;
    padding: 0;
  }

  #expense-table tbody tr,
  #split-ledger-table tbody tr {
    padding: 10px 8px;
  }

  #expense-table td,
  #split-ledger-table td {
    padding: 6px 2px;
  }

  #expense-table td::before,
  #split-ledger-table td::before {
    font-size: 0.68rem;
  }

  .bottom-nav {
    padding: 4px 4px 8px;
  }

  .bottom-link {
    min-height: 52px;
    font-size: 0.66rem;
  }

  .bottom-link i {
    font-size: 1.08rem;
  }

  .fab-add {
    width: 54px;
    height: 54px;
    right: 12px;
    bottom: 76px;
  }

  .modal-overlay {
    padding: 10px;
  }

  .modal {
    padding: 12px !important;
    max-height: calc(100vh - 24px);
  }

  .split-result-item {
    flex-direction: column;
    align-items: flex-start;
  }

  .person-result {
    justify-items: start;
  }
}

@media (max-width: 360px) {
  .header h1 {
    font-size: 1.08rem !important;
  }

  .hero-value {
    font-size: 1.45rem !important;
  }

  .btn {
    font-size: 0.78rem;
  }

  .bottom-link span {
    font-size: 0.63rem;
  }
}

/* ===========================
   Theme System Override
   Dark Default + Light Override
   =========================== */
:root {
  color-scheme: dark;

  --bg-primary: #0b1220;
  --bg-secondary: #131b2d;
  --surface: #101a2d;
  --surface-secondary: #17233a;
  --surface-tertiary: #1e2b47;
  --surface-glass: rgba(16, 26, 45, 0.8);
  --surface-elevated: #1a2742;
  --border: rgba(255, 255, 255, 0.12);
  --border-strong: rgba(255, 255, 255, 0.2);
  --text-primary: #e2e8f0;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --primary: #60a5fa;
  --primary-dim: rgba(96, 165, 250, 0.16);
  --primary-glow: rgba(96, 165, 250, 0.28);
  --accent: #a78bfa;
  --income: #34d399;
  --expense: #f87171;
  --success: #34d399;
  --warning: #f59e0b;
  --danger: #f87171;
  --danger-dim: rgba(248, 113, 113, 0.18);
  --overlay: rgba(2, 6, 23, 0.62);
  --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.32);
  --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.5);
  --transparent: rgba(0, 0, 0, 0);

  --hero-grad-start: #172b4d;
  --hero-grad-mid: #1d3459;
  --hero-grad-end: #232f4c;
  --hero-grad: linear-gradient(
    135deg,
    var(--hero-grad-start),
    var(--hero-grad-mid) 56%,
    var(--hero-grad-end)
  );
  --hero-glow: var(--primary-glow);

  --header-bg: rgba(11, 18, 32, 0.9);
  --card-bg: var(--surface);
  --card-bg-soft: var(--surface-secondary);
  --card-bg-tertiary: var(--surface-tertiary);
  --glass-bg: var(--surface-glass);
  --input-bg: var(--surface-secondary);
  --input-bg-hover: var(--surface-tertiary);
  --input-border: var(--border);
  --input-placeholder: var(--text-muted);
  --focus-ring: var(--primary-dim);
  --focus-border: var(--primary);
  --segmented-bg: var(--surface-secondary);
  --segmented-active-bg: var(--surface);
  --segmented-active-text: var(--text-primary);
  --btn-ghost-bg: rgba(255, 255, 255, 0.04);
  --btn-ghost-bg-hover: rgba(255, 255, 255, 0.1);
  --btn-ghost-border: var(--border);
  --btn-ghost-text: var(--text-primary);
  --btn-primary-bg: var(--primary);
  --btn-primary-bg-hover: #3b82f6;
  --btn-primary-text: #eff6ff;
  --btn-accent-bg: var(--accent);
  --btn-accent-bg-hover: #8b5cf6;
  --btn-accent-text: #f5f3ff;
  --table-head-bg: var(--surface-secondary);
  --table-row-bg: var(--surface);
  --table-row-alt: var(--surface-secondary);
  --table-row-hover: var(--primary-dim);
  --modal-bg: var(--surface-elevated);
  --budget-track: var(--surface-secondary);
  --budget-fill: var(--primary);
  --calendar-head-bg: var(--surface-secondary);
  --calendar-cell-bg: var(--surface);
  --calendar-cell-hover: var(--primary-dim);
  --calendar-today-bg: var(--primary-dim);
  --toast-bg: var(--surface-elevated);
  --toast-text: var(--text-primary);
  --scroll-track: var(--surface-secondary);
  --scroll-thumb: var(--text-muted);

  --clr-teal-700: #00aa5b;
  --clr-teal-800: #008f4c;
  --clr-teal-700-v2: #10b981;
  --clr-red-500: #ef4444;
  --clr-red-600: #dc2626;
  --clr-white-50: #ffffff;
  --clr-sky-50: #fafbfc;
  --clr-sky-50-v2: #f4f6f8;
  --clr-sky-100: #e2e8f0;
  --clr-sky-200: #cbd5e1;
  --clr-sky-600: #64748b;
  --clr-sky-800: #334155;
  --clr-blue-950: #0f172a;
  --clr-ink-950-a04: rgba(0, 0, 0, 0.04);
  --clr-ink-950-a06: rgba(0, 0, 0, 0.06);
  --clr-slate-100: #edeef0;
  --clr-sky-50-v3: #f8f9fa;
  --clr-green-100: #e6f6ec;
  --clr-red-100: #fee2e2;
  --clr-sky-700: #0284c7;
  --clr-sky-700-v2: #0369a1;
  --clr-amber-600: #f59e0b;
  --clr-ink-950-a08: rgba(0, 0, 0, 0.08);
  --clr-teal-700-a15: rgba(0, 170, 91, 0.15);
  --clr-sky-950: #07101d;
  --clr-blue-950-a86: rgba(11, 18, 32, 0.86);
  --clr-sky-950-v2: #0a1323;
  --clr-sky-900: #142238;
  --clr-sky-400-a22: rgba(148, 163, 184, 0.22);
  --clr-sky-400-a12: rgba(148, 163, 184, 0.12);
  --clr-sky-400: #94a3b8;
  --clr-sky-600-a26: rgba(14, 165, 233, 0.26);
  --clr-red-500-a18: rgba(239, 68, 68, 0.18);
  --clr-sky-950-a95: rgba(10, 19, 35, 0.95);
  --clr-sky-950-a82: rgba(10, 19, 35, 0.82);
  --clr-sky-950-a72: rgba(10, 19, 35, 0.72);
  --clr-blue-950-a78: rgba(15, 23, 42, 0.78);
  --clr-sky-50-v4: #f8fafc;
  --clr-sky-950-a92: rgba(10, 19, 35, 0.92);
  --clr-sky-500: #38bdf8;
  --clr-sky-500-a30: rgba(56, 189, 248, 0.3);
  --clr-blue-950-a60: rgba(15, 17, 23, 0.6);
  --clr-sky-950-a86: rgba(10, 19, 35, 0.86);
  --clr-white-50-a72: rgba(255, 255, 255, 0.72);
  --clr-blue-950-a20: rgba(15, 23, 42, 0.2);
  --clr-white-50-a80: rgba(255, 255, 255, 0.8);
  --clr-teal-700-a20: rgba(0, 170, 91, 0.2);
  --clr-white-50-a90: rgba(255, 255, 255, 0.9);
  --clr-cyan-800: #0f766e;
  --clr-white-50-a75: rgba(255, 255, 255, 0.75);
  --clr-white-50-v2: #fff;
  --clr-white-50-a35: rgba(255, 255, 255, 0.35);
  --clr-teal-700-a25: rgba(0, 170, 91, 0.25);
  --clr-red-500-a22: rgba(239, 68, 68, 0.22);
  --clr-red-500-a30: rgba(239, 68, 68, 0.3);
  --clr-sky-700-a20: rgba(2, 132, 199, 0.2);
  --clr-sky-700-a25: rgba(2, 132, 199, 0.25);
  --clr-blue-950-v2: #0b1220;
  --clr-sky-600-a10: rgba(14, 165, 233, 0.1);
  --clr-sky-50-a86: rgba(241, 245, 249, 0.86);
  --clr-blue-950-a08: rgba(15, 23, 42, 0.08);
  --clr-sky-50-a82: rgba(248, 250, 252, 0.82);
  --clr-teal-700-a15-v2: rgba(16, 185, 129, 0.15);
  --clr-red-500-a14: rgba(239, 68, 68, 0.14);
  --clr-sky-400-a20: rgba(148, 163, 184, 0.2);
  --clr-teal-700-a18: rgba(16, 185, 129, 0.18);
  --clr-sky-700-a12: rgba(2, 132, 199, 0.12);
  --clr-ink-950-a50: rgba(0, 0, 0, 0.5);
  --clr-teal-700-a00: rgba(16, 185, 129, 0);
  --clr-teal-700-a10: rgba(0, 170, 91, 0.1);
  --clr-teal-700-a45: rgba(16, 185, 129, 0.45);
  --clr-teal-700-a13: rgba(16, 185, 129, 0.13);
  --clr-white-50-a14: rgba(255, 255, 255, 0.14);
  --clr-white-50-a18: rgba(255, 255, 255, 0.18);
  --clr-white-50-a12: rgba(255, 255, 255, 0.12);
  --clr-white-50-a20: rgba(255, 255, 255, 0.2);
  --clr-white-50-a34: rgba(255, 255, 255, 0.34);
  --clr-white-50-a24: rgba(255, 255, 255, 0.24);
  --clr-ink-950-a14: rgba(0, 0, 0, 0.14);
  --clr-white-50-a22: rgba(255, 255, 255, 0.22);
  --clr-sky-700-a08: rgba(2, 132, 199, 0.08);
  --clr-sky-700-a45: rgba(2, 132, 199, 0.45);
  --clr-sky-700-a10: rgba(2, 132, 199, 0.1);
  --clr-sky-950-a38: rgba(10, 19, 35, 0.38);
  --clr-sky-400-a25: rgba(148, 163, 184, 0.25);
  --clr-sky-950-a44: rgba(10, 19, 35, 0.44);
  --clr-sky-400-a30: rgba(148, 163, 184, 0.3);
  --clr-sky-900-a72: rgba(30, 41, 59, 0.72);
  --clr-sky-600-a15: rgba(14, 165, 233, 0.15);
  --clr-sky-600-v2: #0ea5e9;
  --clr-blue-950-a14: rgba(15, 23, 42, 0.14);
  --clr-sky-600-a20: rgba(14, 165, 233, 0.2);
  --clr-sky-50-v5: #f7fbff;
  --clr-green-50: #f8fbf8;
  --clr-blue-50: #f6f8fc;
  --clr-teal-700-a24: rgba(16, 185, 129, 0.24);
  --clr-sky-600-a22: rgba(14, 165, 233, 0.22);
  --clr-amber-600-a16: rgba(245, 158, 11, 0.16);
  --clr-white-50-a63: rgba(255, 255, 255, 0.63);
  --clr-blue-950-a12: rgba(15, 23, 42, 0.12);
  --clr-teal-700-a20-v2: rgba(16, 185, 129, 0.2);
  --clr-sky-600-a14: rgba(14, 165, 233, 0.14);
  --clr-teal-800-v2: #059669;
  --clr-sky-700-a36: rgba(2, 132, 199, 0.36);
  --clr-sky-400-a35: rgba(148, 163, 184, 0.35);
  --clr-blue-950-a10: rgba(15, 23, 42, 0.1);
  --clr-white-50-a88: rgba(255, 255, 255, 0.88);
  --clr-white-50-a70: rgba(255, 255, 255, 0.7);
  --clr-sky-400-a32: rgba(148, 163, 184, 0.32);
  --clr-teal-700-a92: rgba(16, 185, 129, 0.92);
  --clr-sky-600-a85: rgba(14, 165, 233, 0.85);
  --clr-amber-600-a82: rgba(245, 158, 11, 0.82);
  --clr-teal-700-a35: rgba(16, 185, 129, 0.35);
  --clr-white-50-a74: rgba(255, 255, 255, 0.74);
  --clr-blue-950-a12-v2: rgba(2, 6, 23, 0.12);
  --clr-teal-800-v3: #047857;
  --clr-teal-900-a35: rgba(6, 95, 70, 0.35);
  --clr-white-50-a00: rgba(255, 255, 255, 0);
  --clr-white-50-a25: rgba(255, 255, 255, 0.25);
  --clr-white-50-a32: rgba(255, 255, 255, 0.32);
  --clr-blue-950-a32: rgba(2, 6, 23, 0.32);
  --clr-white-50-a28: rgba(255, 255, 255, 0.28);
  --clr-white-50-a16: rgba(255, 255, 255, 0.16);
  --clr-white-50-a06: rgba(255, 255, 255, 0.06);
  --clr-white-50-a30: rgba(255, 255, 255, 0.3);
  --clr-white-50-a55: rgba(255, 255, 255, 0.55);
  --clr-white-50-a95: rgba(255, 255, 255, 0.95);
  --clr-white-50-a02: rgba(255, 255, 255, 0.02);
  --clr-sky-500-a42: rgba(56, 189, 248, 0.42);
  --clr-sky-500-a06: rgba(56, 189, 248, 0.06);
  --clr-white-50-a26: rgba(255, 255, 255, 0.26);
  --clr-white-50-a45: rgba(255, 255, 255, 0.45);
  --clr-sky-600-a24: rgba(14, 165, 233, 0.24);
  --clr-white-50-a60: rgba(255, 255, 255, 0.6);
  --clr-white-50-a78: rgba(255, 255, 255, 0.78);
  --clr-sky-400-a23: rgba(148, 163, 184, 0.23);
  --clr-white-50-a62: rgba(255, 255, 255, 0.62);
  --clr-sky-600-a35: rgba(14, 165, 233, 0.35);
  --clr-blue-950-a18: rgba(15, 23, 42, 0.18);
  --clr-sky-600-a08: rgba(14, 165, 233, 0.08);
  --clr-white-50-a86: rgba(255, 255, 255, 0.86);
  --clr-sky-600-a28: rgba(14, 165, 233, 0.28);
  --clr-sky-600-a36: rgba(14, 165, 233, 0.36);
  --clr-white-50-a44: rgba(255, 255, 255, 0.44);
  --clr-sky-400-a28: rgba(148, 163, 184, 0.28);
  --clr-white-50-a82: rgba(255, 255, 255, 0.82);
  --clr-white-50-a65: rgba(255, 255, 255, 0.65);
  --clr-sky-600-a18: rgba(14, 165, 233, 0.18);
  --clr-sky-600-a40: rgba(14, 165, 233, 0.4);
  --clr-red-500-a25: rgba(239, 68, 68, 0.25);
  --clr-blue-950-a46: rgba(2, 6, 23, 0.46);
  --clr-teal-700-a16: rgba(16, 185, 129, 0.16);
  --clr-sky-950-v3: #040911;
  --clr-sky-950-v4: #07121f;
  --clr-sky-950-v5: #060d18;
  --clr-teal-700-a22: rgba(16, 185, 129, 0.22);
  --clr-amber-600-a14: rgba(245, 158, 11, 0.14);
  --clr-sky-950-a72-v2: rgba(7, 16, 29, 0.72);
  --clr-blue-950-a50: rgba(2, 6, 23, 0.5);
  --clr-sky-950-a52: rgba(7, 16, 29, 0.52);
  --clr-sky-400-a34: rgba(148, 163, 184, 0.34);
  --clr-sky-950-a62: rgba(7, 16, 29, 0.62);
  --clr-sky-400-a26: rgba(148, 163, 184, 0.26);
  --clr-sky-950-a80: rgba(7, 16, 29, 0.8);
  --clr-sky-950-a36: rgba(7, 16, 29, 0.36);
  --clr-sky-950-a40: rgba(7, 16, 29, 0.4);
  --clr-sky-950-a24: rgba(7, 16, 29, 0.24);
  --clr-sky-50-v6: #f3f6fb;
  --clr-blue-950-a07: rgba(15, 23, 42, 0.07);
  --clr-sky-600-a11: rgba(14, 165, 233, 0.11);
  --clr-teal-700-a10-v2: rgba(16, 185, 129, 0.1);
  --clr-blue-50-v2: #f6f9ff;
  --clr-sky-50-v7: #f2f6fc;
  --clr-sky-50-v8: #eff4fb;
  --clr-white-50-a76: rgba(255, 255, 255, 0.76);
  --clr-cyan-800-v2: #066f6b;
  --clr-teal-700-v3: #0f9b7b;
  --clr-sky-600-v3: #0f88c8;
  --clr-teal-900-a28: rgba(6, 95, 70, 0.28);
  --clr-white-50-a33: rgba(255, 255, 255, 0.33);
  --clr-blue-950-a04: rgba(15, 23, 42, 0.04);
  --clr-sky-400-a24: rgba(148, 163, 184, 0.24);
  --clr-teal-700-a17: rgba(16, 185, 129, 0.17);
  --clr-sky-100-a58: rgba(226, 232, 240, 0.58);
  --clr-sky-950-v6: #060f1d;
  --clr-sky-950-v7: #0a1628;
  --clr-sky-400-a18: rgba(148, 163, 184, 0.18);
  --clr-sky-950-v8: #050d19;
  --clr-sky-950-v9: #071224;
  --clr-sky-950-v10: #06101d;
  --clr-sky-950-a78: rgba(8, 20, 37, 0.78);
  --clr-sky-950-a90: rgba(10, 22, 40, 0.9);
  --clr-sky-950-a74: rgba(10, 22, 40, 0.74);
  --clr-sky-950-a74-v2: rgba(7, 16, 29, 0.74);
  --clr-sky-400-a36: rgba(148, 163, 184, 0.36);
  --clr-sky-600-a12: rgba(14, 165, 233, 0.12);
  --clr-white-50-a58: rgba(255, 255, 255, 0.58);
  --clr-white-50-a48: rgba(255, 255, 255, 0.48);
  --clr-white-50-a50: rgba(255, 255, 255, 0.5);
  --clr-teal-600: #34d399;
  --clr-amber-500: #fbbf24;
  --clr-red-400: #f87171;
  --clr-sky-950-a90-v2: rgba(7, 16, 29, 0.9);
  --clr-sky-950-a55: rgba(7, 16, 29, 0.55);
  --clr-sky-950-a50: rgba(7, 16, 29, 0.5);
  --clr-white-50-a15: rgba(255, 255, 255, 0.15);
  --clr-red-500-a10: rgba(239, 68, 68, 0.1);
  --clr-red-500-v2: #f43f5e;
  --clr-blue-950-a95: rgba(15, 23, 42, 0.95);
  --clr-ink-950-a20: rgba(0, 0, 0, 0.2);
  --clr-teal-700-a05: rgba(0, 170, 91, 0.05);
  --clr-sky-950-v11: #05080d;
  --clr-sky-950-a88: rgba(10, 15, 22, 0.88);
  --clr-sky-950-v12: #0b1119;
  --clr-sky-950-v13: #111a24;
  --clr-white-50-a08: rgba(255, 255, 255, 0.08);
  --clr-sky-50-v9: #f2f6fb;
  --clr-sky-50-a65: rgba(235, 244, 255, 0.65);
  --clr-cyan-700: #1fa8a4;
  --clr-cyan-600: #26bfba;
  --clr-cyan-700-a24: rgba(31, 168, 164, 0.24);
  --clr-red-600-v2: #cf4030;
  --clr-red-500-v3: #e3523f;
  --clr-red-600-a18: rgba(207, 64, 48, 0.18);
  --clr-cyan-300: #9bf2f5;
  --clr-cyan-200: #c6fbfc;
  --clr-orange-500: #f78d3b;
  --clr-teal-600-v2: #39c17d;
  --clr-sky-950-a32: rgba(1, 5, 12, 0.32);
  --clr-sky-950-a48: rgba(1, 5, 12, 0.48);
  --clr-sky-950-a56: rgba(1, 5, 12, 0.56);
  --clr-sky-950-v14: #0a121b;
  --clr-sky-950-a88-v2: rgba(14, 22, 31, 0.88);
  --clr-sky-950-v15: #111b27;
  --clr-sky-900-v2: #162131;
  --clr-white-50-a17: rgba(255, 255, 255, 0.17);
  --clr-white-50-a10: rgba(255, 255, 255, 0.1);
  --clr-sky-50-a68: rgba(236, 244, 254, 0.68);
  --clr-blue-400-a16: rgba(66, 116, 255, 0.16);
  --clr-cyan-700-a13: rgba(31, 168, 164, 0.13);
  --clr-cyan-300-a10: rgba(155, 242, 245, 0.1);
  --clr-sky-950-a78-v2: rgba(5, 8, 13, 0.78);
  --clr-white-50-a04: rgba(255, 255, 255, 0.04);
  --clr-cyan-700-a60: rgba(31, 168, 164, 0.6);
  --clr-white-50-a05: rgba(255, 255, 255, 0.045);
  --clr-white-50-a01: rgba(255, 255, 255, 0.01);
  --clr-cyan-700-a56: rgba(31, 168, 164, 0.56);
  --clr-cyan-700-a42: rgba(31, 168, 164, 0.42);
  --clr-sky-950-a92-v2: rgba(8, 15, 22, 0.92);
  --clr-sky-950-a95-v2: rgba(8, 12, 18, 0.95);
  --clr-sky-950-a58: rgba(1, 7, 14, 0.58);
  --clr-cyan-300-a17: rgba(155, 242, 245, 0.17);
  --clr-cyan-300-a00: rgba(155, 242, 245, 0);
  --clr-ink-950-a28: rgba(0, 0, 0, 0.28);
  --clr-sky-950-a42: rgba(2, 6, 12, 0.42);
  --clr-cyan-700-a46: rgba(31, 168, 164, 0.46);
  --clr-cyan-700-a00: rgba(31, 168, 164, 0);
  --clr-cyan-300-a14: rgba(155, 242, 245, 0.14);
  --clr-white-50-a07: rgba(255, 255, 255, 0.07);
  --clr-sky-100-a44: rgba(227, 241, 255, 0.44);
  --clr-cyan-700-a75: rgba(31, 168, 164, 0.75);
  --clr-cyan-700-a18: rgba(31, 168, 164, 0.18);
  --clr-white-50-a07-v2: rgba(255, 255, 255, 0.065);
  --clr-white-50-a03: rgba(255, 255, 255, 0.03);
  --clr-sky-950-v16: #051219;
  --clr-cyan-700-a70: rgba(31, 168, 164, 0.7);
  --clr-sky-950-v17: #05090f;
  --clr-cyan-950: #031013;
  --clr-cyan-700-a20: rgba(31, 168, 164, 0.2);
  --clr-red-600-a16: rgba(207, 64, 48, 0.16);
  --clr-red-600-a50: rgba(207, 64, 48, 0.5);
  --clr-red-200: #ffc5be;
  --clr-red-600-a75: rgba(207, 64, 48, 0.75);
  --clr-red-600-a24: rgba(207, 64, 48, 0.24);
  --clr-cyan-300-a45: rgba(155, 242, 245, 0.45);
  --clr-cyan-100: #dbfeff;
  --clr-cyan-700-a14: rgba(31, 168, 164, 0.14);
  --clr-cyan-300-v2: #abf5f2;
  --clr-cyan-950-v2: #062122;
  --clr-sky-950-a22: rgba(5, 9, 15, 0.22);
  --clr-sky-950-a86-v2: rgba(5, 9, 15, 0.86);
  --clr-teal-400: #71f0b7;
  --clr-red-300: #ff9d8d;
  --clr-cyan-200-v2: #cbeceb;
  --clr-cyan-700-a62: rgba(31, 168, 164, 0.62);
  --clr-cyan-700-a10: rgba(31, 168, 164, 0.1);
  --clr-cyan-100-v2: #d9fefe;
  --clr-red-600-a44: rgba(207, 64, 48, 0.44);
  --clr-red-600-a14: rgba(207, 64, 48, 0.14);
  --clr-red-200-v2: #ffc4bd;
  --clr-white-50-a13: rgba(255, 255, 255, 0.13);
  --clr-ink-950-a27: rgba(0, 0, 0, 0.27);
  --clr-sky-950-v18: #0b141f;
  --clr-ink-950-a45: rgba(0, 0, 0, 0.45);
  --clr-white-50-a02-v2: rgba(255, 255, 255, 0.015);
  --clr-cyan-700-a55: rgba(31, 168, 164, 0.55);
  --clr-cyan-700-a12: rgba(31, 168, 164, 0.12);
  --clr-cyan-700-a80: rgba(31, 168, 164, 0.8);
  --clr-sky-950-v19: #09111b;
  --clr-white-50-a06-v2: rgba(255, 255, 255, 0.055);
  --clr-cyan-700-a09: rgba(31, 168, 164, 0.09);
  --clr-teal-300: #98efc0;
  --clr-teal-600-a45: rgba(57, 193, 125, 0.45);
  --clr-red-200-v3: #ffb3a7;
  --clr-red-600-a45: rgba(207, 64, 48, 0.45);
  --clr-cyan-300-a42: rgba(155, 242, 245, 0.42);
  --clr-teal-300-v2: #9ef0c6;
  --clr-orange-200: #ffd6b3;
  --clr-orange-500-a45: rgba(247, 141, 59, 0.45);
  --clr-cyan-700-a72: rgba(31, 168, 164, 0.72);
  --clr-cyan-100-v3: #d0ffff;
  --clr-red-600-a55: rgba(207, 64, 48, 0.55);
  --clr-red-200-v4: #ffc2bb;
  --clr-teal-300-v3: #9df1c5;
  --clr-teal-600-a40: rgba(57, 193, 125, 0.4);
  --clr-red-200-v5: #ffbaa9;
  --clr-cyan-100-v4: #d8fdfe;
  --clr-cyan-100-v5: #d7fefe;
  --clr-cyan-100-v6: #ceffff;
  --clr-cyan-100-v7: #d2ffff;
  --clr-blue-950-a74: rgba(1, 4, 10, 0.74);
  --clr-sky-950-v20: #0a1119;
  --clr-sky-950-a92-v3: rgba(9, 15, 23, 0.92);
  --clr-ink-950-a38: rgba(0, 0, 0, 0.38);
  --clr-teal-600-a48: rgba(57, 193, 125, 0.48);
  --clr-red-600-a48: rgba(207, 64, 48, 0.48);
  --clr-cyan-300-a16: rgba(155, 242, 245, 0.16);
  --clr-cyan-100-v8: #dcfeff;
  --clr-cyan-700-v2: #2a9d8f;
  --clr-cyan-700-v3: #22857a;
  --clr-cyan-700-a24-v2: rgba(42, 157, 143, 0.24);
  --clr-red-500-v4: #e76f51;
  --clr-red-500-v5: #d45d40;
  --clr-red-600-v3: #bb4f37;
  --clr-red-500-a20: rgba(231, 111, 81, 0.2);
  --clr-sky-50-v10: #f4f7fb;
  --clr-sky-50-a80: rgba(244, 247, 251, 0.8);
  --clr-sky-200-a28: rgba(203, 215, 224, 0.28);
  --clr-sky-200-a18: rgba(203, 215, 224, 0.18);
  --clr-sky-50-v11: #f2f6f8;
  --clr-white-50-a92: rgba(255, 255, 255, 0.92);
  --clr-sky-50-v12: #f2f7f9;
  --clr-sky-950-v21: #132028;
  --clr-sky-700-v3: #4e626e;
  --clr-sky-950-a14: rgba(19, 32, 40, 0.14);
  --clr-sky-950-a08: rgba(19, 32, 40, 0.08);
  --clr-cyan-700-a17: rgba(42, 157, 143, 0.17);
  --clr-red-500-a12: rgba(231, 111, 81, 0.12);
  --clr-cyan-50: #f2fffd;
  --clr-red-50: #fff4f1;
  --clr-red-500-a18-v2: rgba(231, 111, 81, 0.18);
  --clr-red-500-a62: rgba(231, 111, 81, 0.62);
  --clr-red-100-v2: #ffd9cf;
  --clr-red-500-a82: rgba(231, 111, 81, 0.82);
  --clr-red-500-a28: rgba(231, 111, 81, 0.28);
  --clr-red-500-a22-v2: rgba(231, 111, 81, 0.22);
  --clr-red-200-v6: #ffb4a5;
  --clr-red-600-v4: #b5452e;
  --clr-sky-950-a96: rgba(9, 15, 22, 0.96);
  --clr-cyan-300-a90: rgba(139, 232, 219, 0.9);
  --clr-cyan-900: #0b5e57;
  --clr-cyan-100-v9: #e8f7f5;
  --clr-teal-50: #f3fbf9;
  --clr-teal-50-v2: #f6fffd;
  --clr-teal-200: #d6ede8;
  --clr-slate-700: #4b5563;
  --clr-teal-700-v4: #0f9f6e;
  --clr-red-600-v5: #e11d48;
  --clr-cyan-800-a09: rgba(15, 118, 110, 0.09);
  --clr-cyan-800-a10: rgba(15, 118, 110, 0.1);
  --clr-teal-50-a88: rgba(243, 251, 249, 0.88);
  --clr-cyan-700-v4: #14b8a6;
  --clr-teal-50-v3: #f3fffc;
  --clr-white-50-a96: rgba(255, 255, 255, 0.96);
  --clr-cyan-800-a30: rgba(15, 118, 110, 0.3);
}

[data-theme="light"] {
  color-scheme: light;

  --bg-primary: #f4f6fb;
  --bg-secondary: #eef1f8;
  --surface: #ffffff;
  --surface-secondary: #f8faff;
  --surface-tertiary: #eef2ff;
  --surface-glass: rgba(255, 255, 255, 0.86);
  --surface-elevated: #ffffff;
  --border: rgba(0, 0, 0, 0.08);
  --border-strong: rgba(0, 0, 0, 0.15);
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #94a3b8;
  --primary: #2563eb;
  --primary-dim: rgba(37, 99, 235, 0.12);
  --primary-glow: rgba(37, 99, 235, 0.25);
  --accent: #7c3aed;
  --income: #059669;
  --expense: #dc2626;
  --success: #059669;
  --warning: #d97706;
  --danger: #dc2626;
  --danger-dim: rgba(220, 38, 38, 0.12);
  --overlay: rgba(15, 23, 42, 0.42);
  --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.12);
  --transparent: rgba(0, 0, 0, 0);

  --hero-grad-start: #e7efff;
  --hero-grad-mid: #f3f6ff;
  --hero-grad-end: #eef2ff;
  --hero-grad: linear-gradient(
    135deg,
    var(--hero-grad-start),
    var(--hero-grad-mid) 56%,
    var(--hero-grad-end)
  );
  --hero-glow: var(--primary-dim);

  --header-bg: rgba(248, 250, 255, 0.88);
  --card-bg: var(--surface);
  --card-bg-soft: var(--surface-secondary);
  --card-bg-tertiary: var(--surface-tertiary);
  --glass-bg: var(--surface-glass);
  --input-bg: var(--surface);
  --input-bg-hover: var(--surface-secondary);
  --input-border: var(--border);
  --input-placeholder: var(--text-muted);
  --focus-ring: var(--primary-dim);
  --focus-border: var(--primary);
  --segmented-bg: var(--bg-secondary);
  --segmented-active-bg: var(--surface);
  --segmented-active-text: var(--text-primary);
  --btn-ghost-bg: var(--surface-secondary);
  --btn-ghost-bg-hover: var(--surface-tertiary);
  --btn-ghost-border: var(--border-strong);
  --btn-ghost-text: var(--text-primary);
  --btn-primary-bg: var(--primary);
  --btn-primary-bg-hover: #1d4ed8;
  --btn-primary-text: #eff6ff;
  --btn-accent-bg: var(--accent);
  --btn-accent-bg-hover: #6d28d9;
  --btn-accent-text: #faf5ff;
  --table-head-bg: var(--bg-secondary);
  --table-row-bg: var(--surface);
  --table-row-alt: var(--surface-secondary);
  --table-row-hover: var(--primary-dim);
  --modal-bg: var(--surface);
  --budget-track: var(--bg-secondary);
  --budget-fill: var(--primary);
  --calendar-head-bg: var(--bg-secondary);
  --calendar-cell-bg: var(--surface);
  --calendar-cell-hover: var(--surface-tertiary);
  --calendar-today-bg: var(--primary-dim);
  --toast-bg: var(--surface);
  --toast-text: var(--text-primary);
  --scroll-track: var(--bg-secondary);
  --scroll-thumb: #94a3b8;

  --clr-teal-700: #00aa5b;
  --clr-teal-800: #008f4c;
  --clr-teal-700-v2: #10b981;
  --clr-red-500: #ef4444;
  --clr-red-600: #dc2626;
  --clr-white-50: #ffffff;
  --clr-sky-50: #fafbfc;
  --clr-sky-50-v2: #f4f6f8;
  --clr-sky-100: #e2e8f0;
  --clr-sky-200: #cbd5e1;
  --clr-sky-600: #64748b;
  --clr-sky-800: #334155;
  --clr-blue-950: #0f172a;
  --clr-ink-950-a04: rgba(0, 0, 0, 0.04);
  --clr-ink-950-a06: rgba(0, 0, 0, 0.06);
  --clr-slate-100: #edeef0;
  --clr-sky-50-v3: #f8f9fa;
  --clr-green-100: #e6f6ec;
  --clr-red-100: #fee2e2;
  --clr-sky-700: #0284c7;
  --clr-sky-700-v2: #0369a1;
  --clr-amber-600: #f59e0b;
  --clr-ink-950-a08: rgba(0, 0, 0, 0.08);
  --clr-teal-700-a15: rgba(0, 170, 91, 0.15);
  --clr-sky-950: #07101d;
  --clr-blue-950-a86: rgba(11, 18, 32, 0.86);
  --clr-sky-950-v2: #0a1323;
  --clr-sky-900: #142238;
  --clr-sky-400-a22: rgba(148, 163, 184, 0.22);
  --clr-sky-400-a12: rgba(148, 163, 184, 0.12);
  --clr-sky-400: #94a3b8;
  --clr-sky-600-a26: rgba(14, 165, 233, 0.26);
  --clr-red-500-a18: rgba(239, 68, 68, 0.18);
  --clr-sky-950-a95: rgba(10, 19, 35, 0.95);
  --clr-sky-950-a82: rgba(10, 19, 35, 0.82);
  --clr-sky-950-a72: rgba(10, 19, 35, 0.72);
  --clr-blue-950-a78: rgba(15, 23, 42, 0.78);
  --clr-sky-50-v4: #f8fafc;
  --clr-sky-950-a92: rgba(10, 19, 35, 0.92);
  --clr-sky-500: #38bdf8;
  --clr-sky-500-a30: rgba(56, 189, 248, 0.3);
  --clr-blue-950-a60: rgba(15, 17, 23, 0.6);
  --clr-sky-950-a86: rgba(10, 19, 35, 0.86);
  --clr-white-50-a72: rgba(255, 255, 255, 0.72);
  --clr-blue-950-a20: rgba(15, 23, 42, 0.2);
  --clr-white-50-a80: rgba(255, 255, 255, 0.8);
  --clr-teal-700-a20: rgba(0, 170, 91, 0.2);
  --clr-white-50-a90: rgba(255, 255, 255, 0.9);
  --clr-cyan-800: #0f766e;
  --clr-white-50-a75: rgba(255, 255, 255, 0.75);
  --clr-white-50-v2: #fff;
  --clr-white-50-a35: rgba(255, 255, 255, 0.35);
  --clr-teal-700-a25: rgba(0, 170, 91, 0.25);
  --clr-red-500-a22: rgba(239, 68, 68, 0.22);
  --clr-red-500-a30: rgba(239, 68, 68, 0.3);
  --clr-sky-700-a20: rgba(2, 132, 199, 0.2);
  --clr-sky-700-a25: rgba(2, 132, 199, 0.25);
  --clr-blue-950-v2: #0b1220;
  --clr-sky-600-a10: rgba(14, 165, 233, 0.1);
  --clr-sky-50-a86: rgba(241, 245, 249, 0.86);
  --clr-blue-950-a08: rgba(15, 23, 42, 0.08);
  --clr-sky-50-a82: rgba(248, 250, 252, 0.82);
  --clr-teal-700-a15-v2: rgba(16, 185, 129, 0.15);
  --clr-red-500-a14: rgba(239, 68, 68, 0.14);
  --clr-sky-400-a20: rgba(148, 163, 184, 0.2);
  --clr-teal-700-a18: rgba(16, 185, 129, 0.18);
  --clr-sky-700-a12: rgba(2, 132, 199, 0.12);
  --clr-ink-950-a50: rgba(0, 0, 0, 0.5);
  --clr-teal-700-a00: rgba(16, 185, 129, 0);
  --clr-teal-700-a10: rgba(0, 170, 91, 0.1);
  --clr-teal-700-a45: rgba(16, 185, 129, 0.45);
  --clr-teal-700-a13: rgba(16, 185, 129, 0.13);
  --clr-white-50-a14: rgba(255, 255, 255, 0.14);
  --clr-white-50-a18: rgba(255, 255, 255, 0.18);
  --clr-white-50-a12: rgba(255, 255, 255, 0.12);
  --clr-white-50-a20: rgba(255, 255, 255, 0.2);
  --clr-white-50-a34: rgba(255, 255, 255, 0.34);
  --clr-white-50-a24: rgba(255, 255, 255, 0.24);
  --clr-ink-950-a14: rgba(0, 0, 0, 0.14);
  --clr-white-50-a22: rgba(255, 255, 255, 0.22);
  --clr-sky-700-a08: rgba(2, 132, 199, 0.08);
  --clr-sky-700-a45: rgba(2, 132, 199, 0.45);
  --clr-sky-700-a10: rgba(2, 132, 199, 0.1);
  --clr-sky-950-a38: rgba(10, 19, 35, 0.38);
  --clr-sky-400-a25: rgba(148, 163, 184, 0.25);
  --clr-sky-950-a44: rgba(10, 19, 35, 0.44);
  --clr-sky-400-a30: rgba(148, 163, 184, 0.3);
  --clr-sky-900-a72: rgba(30, 41, 59, 0.72);
  --clr-sky-600-a15: rgba(14, 165, 233, 0.15);
  --clr-sky-600-v2: #0ea5e9;
  --clr-blue-950-a14: rgba(15, 23, 42, 0.14);
  --clr-sky-600-a20: rgba(14, 165, 233, 0.2);
  --clr-sky-50-v5: #f7fbff;
  --clr-green-50: #f8fbf8;
  --clr-blue-50: #f6f8fc;
  --clr-teal-700-a24: rgba(16, 185, 129, 0.24);
  --clr-sky-600-a22: rgba(14, 165, 233, 0.22);
  --clr-amber-600-a16: rgba(245, 158, 11, 0.16);
  --clr-white-50-a63: rgba(255, 255, 255, 0.63);
  --clr-blue-950-a12: rgba(15, 23, 42, 0.12);
  --clr-teal-700-a20-v2: rgba(16, 185, 129, 0.2);
  --clr-sky-600-a14: rgba(14, 165, 233, 0.14);
  --clr-teal-800-v2: #059669;
  --clr-sky-700-a36: rgba(2, 132, 199, 0.36);
  --clr-sky-400-a35: rgba(148, 163, 184, 0.35);
  --clr-blue-950-a10: rgba(15, 23, 42, 0.1);
  --clr-white-50-a88: rgba(255, 255, 255, 0.88);
  --clr-white-50-a70: rgba(255, 255, 255, 0.7);
  --clr-sky-400-a32: rgba(148, 163, 184, 0.32);
  --clr-teal-700-a92: rgba(16, 185, 129, 0.92);
  --clr-sky-600-a85: rgba(14, 165, 233, 0.85);
  --clr-amber-600-a82: rgba(245, 158, 11, 0.82);
  --clr-teal-700-a35: rgba(16, 185, 129, 0.35);
  --clr-white-50-a74: rgba(255, 255, 255, 0.74);
  --clr-blue-950-a12-v2: rgba(2, 6, 23, 0.12);
  --clr-teal-800-v3: #047857;
  --clr-teal-900-a35: rgba(6, 95, 70, 0.35);
  --clr-white-50-a00: rgba(255, 255, 255, 0);
  --clr-white-50-a25: rgba(255, 255, 255, 0.25);
  --clr-white-50-a32: rgba(255, 255, 255, 0.32);
  --clr-blue-950-a32: rgba(2, 6, 23, 0.32);
  --clr-white-50-a28: rgba(255, 255, 255, 0.28);
  --clr-white-50-a16: rgba(255, 255, 255, 0.16);
  --clr-white-50-a06: rgba(255, 255, 255, 0.06);
  --clr-white-50-a30: rgba(255, 255, 255, 0.3);
  --clr-white-50-a55: rgba(255, 255, 255, 0.55);
  --clr-white-50-a95: rgba(255, 255, 255, 0.95);
  --clr-white-50-a02: rgba(255, 255, 255, 0.02);
  --clr-sky-500-a42: rgba(56, 189, 248, 0.42);
  --clr-sky-500-a06: rgba(56, 189, 248, 0.06);
  --clr-white-50-a26: rgba(255, 255, 255, 0.26);
  --clr-white-50-a45: rgba(255, 255, 255, 0.45);
  --clr-sky-600-a24: rgba(14, 165, 233, 0.24);
  --clr-white-50-a60: rgba(255, 255, 255, 0.6);
  --clr-white-50-a78: rgba(255, 255, 255, 0.78);
  --clr-sky-400-a23: rgba(148, 163, 184, 0.23);
  --clr-white-50-a62: rgba(255, 255, 255, 0.62);
  --clr-sky-600-a35: rgba(14, 165, 233, 0.35);
  --clr-blue-950-a18: rgba(15, 23, 42, 0.18);
  --clr-sky-600-a08: rgba(14, 165, 233, 0.08);
  --clr-white-50-a86: rgba(255, 255, 255, 0.86);
  --clr-sky-600-a28: rgba(14, 165, 233, 0.28);
  --clr-sky-600-a36: rgba(14, 165, 233, 0.36);
  --clr-white-50-a44: rgba(255, 255, 255, 0.44);
  --clr-sky-400-a28: rgba(148, 163, 184, 0.28);
  --clr-white-50-a82: rgba(255, 255, 255, 0.82);
  --clr-white-50-a65: rgba(255, 255, 255, 0.65);
  --clr-sky-600-a18: rgba(14, 165, 233, 0.18);
  --clr-sky-600-a40: rgba(14, 165, 233, 0.4);
  --clr-red-500-a25: rgba(239, 68, 68, 0.25);
  --clr-blue-950-a46: rgba(2, 6, 23, 0.46);
  --clr-teal-700-a16: rgba(16, 185, 129, 0.16);
  --clr-sky-950-v3: #040911;
  --clr-sky-950-v4: #07121f;
  --clr-sky-950-v5: #060d18;
  --clr-teal-700-a22: rgba(16, 185, 129, 0.22);
  --clr-amber-600-a14: rgba(245, 158, 11, 0.14);
  --clr-sky-950-a72-v2: rgba(7, 16, 29, 0.72);
  --clr-blue-950-a50: rgba(2, 6, 23, 0.5);
  --clr-sky-950-a52: rgba(7, 16, 29, 0.52);
  --clr-sky-400-a34: rgba(148, 163, 184, 0.34);
  --clr-sky-950-a62: rgba(7, 16, 29, 0.62);
  --clr-sky-400-a26: rgba(148, 163, 184, 0.26);
  --clr-sky-950-a80: rgba(7, 16, 29, 0.8);
  --clr-sky-950-a36: rgba(7, 16, 29, 0.36);
  --clr-sky-950-a40: rgba(7, 16, 29, 0.4);
  --clr-sky-950-a24: rgba(7, 16, 29, 0.24);
  --clr-sky-50-v6: #f3f6fb;
  --clr-blue-950-a07: rgba(15, 23, 42, 0.07);
  --clr-sky-600-a11: rgba(14, 165, 233, 0.11);
  --clr-teal-700-a10-v2: rgba(16, 185, 129, 0.1);
  --clr-blue-50-v2: #f6f9ff;
  --clr-sky-50-v7: #f2f6fc;
  --clr-sky-50-v8: #eff4fb;
  --clr-white-50-a76: rgba(255, 255, 255, 0.76);
  --clr-cyan-800-v2: #066f6b;
  --clr-teal-700-v3: #0f9b7b;
  --clr-sky-600-v3: #0f88c8;
  --clr-teal-900-a28: rgba(6, 95, 70, 0.28);
  --clr-white-50-a33: rgba(255, 255, 255, 0.33);
  --clr-blue-950-a04: rgba(15, 23, 42, 0.04);
  --clr-sky-400-a24: rgba(148, 163, 184, 0.24);
  --clr-teal-700-a17: rgba(16, 185, 129, 0.17);
  --clr-sky-100-a58: rgba(226, 232, 240, 0.58);
  --clr-sky-950-v6: #060f1d;
  --clr-sky-950-v7: #0a1628;
  --clr-sky-400-a18: rgba(148, 163, 184, 0.18);
  --clr-sky-950-v8: #050d19;
  --clr-sky-950-v9: #071224;
  --clr-sky-950-v10: #06101d;
  --clr-sky-950-a78: rgba(8, 20, 37, 0.78);
  --clr-sky-950-a90: rgba(10, 22, 40, 0.9);
  --clr-sky-950-a74: rgba(10, 22, 40, 0.74);
  --clr-sky-950-a74-v2: rgba(7, 16, 29, 0.74);
  --clr-sky-400-a36: rgba(148, 163, 184, 0.36);
  --clr-sky-600-a12: rgba(14, 165, 233, 0.12);
  --clr-white-50-a58: rgba(255, 255, 255, 0.58);
  --clr-white-50-a48: rgba(255, 255, 255, 0.48);
  --clr-white-50-a50: rgba(255, 255, 255, 0.5);
  --clr-teal-600: #34d399;
  --clr-amber-500: #fbbf24;
  --clr-red-400: #f87171;
  --clr-sky-950-a90-v2: rgba(7, 16, 29, 0.9);
  --clr-sky-950-a55: rgba(7, 16, 29, 0.55);
  --clr-sky-950-a50: rgba(7, 16, 29, 0.5);
  --clr-white-50-a15: rgba(255, 255, 255, 0.15);
  --clr-red-500-a10: rgba(239, 68, 68, 0.1);
  --clr-red-500-v2: #f43f5e;
  --clr-blue-950-a95: rgba(15, 23, 42, 0.95);
  --clr-ink-950-a20: rgba(0, 0, 0, 0.2);
  --clr-teal-700-a05: rgba(0, 170, 91, 0.05);
  --clr-sky-950-v11: #05080d;
  --clr-sky-950-a88: rgba(10, 15, 22, 0.88);
  --clr-sky-950-v12: #0b1119;
  --clr-sky-950-v13: #111a24;
  --clr-white-50-a08: rgba(255, 255, 255, 0.08);
  --clr-sky-50-v9: #f2f6fb;
  --clr-sky-50-a65: rgba(235, 244, 255, 0.65);
  --clr-cyan-700: #1fa8a4;
  --clr-cyan-600: #26bfba;
  --clr-cyan-700-a24: rgba(31, 168, 164, 0.24);
  --clr-red-600-v2: #cf4030;
  --clr-red-500-v3: #e3523f;
  --clr-red-600-a18: rgba(207, 64, 48, 0.18);
  --clr-cyan-300: #9bf2f5;
  --clr-cyan-200: #c6fbfc;
  --clr-orange-500: #f78d3b;
  --clr-teal-600-v2: #39c17d;
  --clr-sky-950-a32: rgba(1, 5, 12, 0.32);
  --clr-sky-950-a48: rgba(1, 5, 12, 0.48);
  --clr-sky-950-a56: rgba(1, 5, 12, 0.56);
  --clr-sky-950-v14: #0a121b;
  --clr-sky-950-a88-v2: rgba(14, 22, 31, 0.88);
  --clr-sky-950-v15: #111b27;
  --clr-sky-900-v2: #162131;
  --clr-white-50-a17: rgba(255, 255, 255, 0.17);
  --clr-white-50-a10: rgba(255, 255, 255, 0.1);
  --clr-sky-50-a68: rgba(236, 244, 254, 0.68);
  --clr-blue-400-a16: rgba(66, 116, 255, 0.16);
  --clr-cyan-700-a13: rgba(31, 168, 164, 0.13);
  --clr-cyan-300-a10: rgba(155, 242, 245, 0.1);
  --clr-sky-950-a78-v2: rgba(5, 8, 13, 0.78);
  --clr-white-50-a04: rgba(255, 255, 255, 0.04);
  --clr-cyan-700-a60: rgba(31, 168, 164, 0.6);
  --clr-white-50-a05: rgba(255, 255, 255, 0.045);
  --clr-white-50-a01: rgba(255, 255, 255, 0.01);
  --clr-cyan-700-a56: rgba(31, 168, 164, 0.56);
  --clr-cyan-700-a42: rgba(31, 168, 164, 0.42);
  --clr-sky-950-a92-v2: rgba(8, 15, 22, 0.92);
  --clr-sky-950-a95-v2: rgba(8, 12, 18, 0.95);
  --clr-sky-950-a58: rgba(1, 7, 14, 0.58);
  --clr-cyan-300-a17: rgba(155, 242, 245, 0.17);
  --clr-cyan-300-a00: rgba(155, 242, 245, 0);
  --clr-ink-950-a28: rgba(0, 0, 0, 0.28);
  --clr-sky-950-a42: rgba(2, 6, 12, 0.42);
  --clr-cyan-700-a46: rgba(31, 168, 164, 0.46);
  --clr-cyan-700-a00: rgba(31, 168, 164, 0);
  --clr-cyan-300-a14: rgba(155, 242, 245, 0.14);
  --clr-white-50-a07: rgba(255, 255, 255, 0.07);
  --clr-sky-100-a44: rgba(227, 241, 255, 0.44);
  --clr-cyan-700-a75: rgba(31, 168, 164, 0.75);
  --clr-cyan-700-a18: rgba(31, 168, 164, 0.18);
  --clr-white-50-a07-v2: rgba(255, 255, 255, 0.065);
  --clr-white-50-a03: rgba(255, 255, 255, 0.03);
  --clr-sky-950-v16: #051219;
  --clr-cyan-700-a70: rgba(31, 168, 164, 0.7);
  --clr-sky-950-v17: #05090f;
  --clr-cyan-950: #031013;
  --clr-cyan-700-a20: rgba(31, 168, 164, 0.2);
  --clr-red-600-a16: rgba(207, 64, 48, 0.16);
  --clr-red-600-a50: rgba(207, 64, 48, 0.5);
  --clr-red-200: #ffc5be;
  --clr-red-600-a75: rgba(207, 64, 48, 0.75);
  --clr-red-600-a24: rgba(207, 64, 48, 0.24);
  --clr-cyan-300-a45: rgba(155, 242, 245, 0.45);
  --clr-cyan-100: #dbfeff;
  --clr-cyan-700-a14: rgba(31, 168, 164, 0.14);
  --clr-cyan-300-v2: #abf5f2;
  --clr-cyan-950-v2: #062122;
  --clr-sky-950-a22: rgba(5, 9, 15, 0.22);
  --clr-sky-950-a86-v2: rgba(5, 9, 15, 0.86);
  --clr-teal-400: #71f0b7;
  --clr-red-300: #ff9d8d;
  --clr-cyan-200-v2: #cbeceb;
  --clr-cyan-700-a62: rgba(31, 168, 164, 0.62);
  --clr-cyan-700-a10: rgba(31, 168, 164, 0.1);
  --clr-cyan-100-v2: #d9fefe;
  --clr-red-600-a44: rgba(207, 64, 48, 0.44);
  --clr-red-600-a14: rgba(207, 64, 48, 0.14);
  --clr-red-200-v2: #ffc4bd;
  --clr-white-50-a13: rgba(255, 255, 255, 0.13);
  --clr-ink-950-a27: rgba(0, 0, 0, 0.27);
  --clr-sky-950-v18: #0b141f;
  --clr-ink-950-a45: rgba(0, 0, 0, 0.45);
  --clr-white-50-a02-v2: rgba(255, 255, 255, 0.015);
  --clr-cyan-700-a55: rgba(31, 168, 164, 0.55);
  --clr-cyan-700-a12: rgba(31, 168, 164, 0.12);
  --clr-cyan-700-a80: rgba(31, 168, 164, 0.8);
  --clr-sky-950-v19: #09111b;
  --clr-white-50-a06-v2: rgba(255, 255, 255, 0.055);
  --clr-cyan-700-a09: rgba(31, 168, 164, 0.09);
  --clr-teal-300: #98efc0;
  --clr-teal-600-a45: rgba(57, 193, 125, 0.45);
  --clr-red-200-v3: #ffb3a7;
  --clr-red-600-a45: rgba(207, 64, 48, 0.45);
  --clr-cyan-300-a42: rgba(155, 242, 245, 0.42);
  --clr-teal-300-v2: #9ef0c6;
  --clr-orange-200: #ffd6b3;
  --clr-orange-500-a45: rgba(247, 141, 59, 0.45);
  --clr-cyan-700-a72: rgba(31, 168, 164, 0.72);
  --clr-cyan-100-v3: #d0ffff;
  --clr-red-600-a55: rgba(207, 64, 48, 0.55);
  --clr-red-200-v4: #ffc2bb;
  --clr-teal-300-v3: #9df1c5;
  --clr-teal-600-a40: rgba(57, 193, 125, 0.4);
  --clr-red-200-v5: #ffbaa9;
  --clr-cyan-100-v4: #d8fdfe;
  --clr-cyan-100-v5: #d7fefe;
  --clr-cyan-100-v6: #ceffff;
  --clr-cyan-100-v7: #d2ffff;
  --clr-blue-950-a74: rgba(1, 4, 10, 0.74);
  --clr-sky-950-v20: #0a1119;
  --clr-sky-950-a92-v3: rgba(9, 15, 23, 0.92);
  --clr-ink-950-a38: rgba(0, 0, 0, 0.38);
  --clr-teal-600-a48: rgba(57, 193, 125, 0.48);
  --clr-red-600-a48: rgba(207, 64, 48, 0.48);
  --clr-cyan-300-a16: rgba(155, 242, 245, 0.16);
  --clr-cyan-100-v8: #dcfeff;
  --clr-cyan-700-v2: #2a9d8f;
  --clr-cyan-700-v3: #22857a;
  --clr-cyan-700-a24-v2: rgba(42, 157, 143, 0.24);
  --clr-red-500-v4: #e76f51;
  --clr-red-500-v5: #d45d40;
  --clr-red-600-v3: #bb4f37;
  --clr-red-500-a20: rgba(231, 111, 81, 0.2);
  --clr-sky-50-v10: #f4f7fb;
  --clr-sky-50-a80: rgba(244, 247, 251, 0.8);
  --clr-sky-200-a28: rgba(203, 215, 224, 0.28);
  --clr-sky-200-a18: rgba(203, 215, 224, 0.18);
  --clr-sky-50-v11: #f2f6f8;
  --clr-white-50-a92: rgba(255, 255, 255, 0.92);
  --clr-sky-50-v12: #f2f7f9;
  --clr-sky-950-v21: #132028;
  --clr-sky-700-v3: #4e626e;
  --clr-sky-950-a14: rgba(19, 32, 40, 0.14);
  --clr-sky-950-a08: rgba(19, 32, 40, 0.08);
  --clr-cyan-700-a17: rgba(42, 157, 143, 0.17);
  --clr-red-500-a12: rgba(231, 111, 81, 0.12);
  --clr-cyan-50: #f2fffd;
  --clr-red-50: #fff4f1;
  --clr-red-500-a18-v2: rgba(231, 111, 81, 0.18);
  --clr-red-500-a62: rgba(231, 111, 81, 0.62);
  --clr-red-100-v2: #ffd9cf;
  --clr-red-500-a82: rgba(231, 111, 81, 0.82);
  --clr-red-500-a28: rgba(231, 111, 81, 0.28);
  --clr-red-500-a22-v2: rgba(231, 111, 81, 0.22);
  --clr-red-200-v6: #ffb4a5;
  --clr-red-600-v4: #b5452e;
  --clr-sky-950-a96: rgba(9, 15, 22, 0.96);
  --clr-cyan-300-a90: rgba(139, 232, 219, 0.9);
  --clr-cyan-900: #0b5e57;
  --clr-cyan-100-v9: #e8f7f5;
  --clr-teal-50: #f3fbf9;
  --clr-teal-50-v2: #f6fffd;
  --clr-teal-200: #d6ede8;
  --clr-slate-700: #4b5563;
  --clr-teal-700-v4: #0f9f6e;
  --clr-red-600-v5: #e11d48;
  --clr-cyan-800-a09: rgba(15, 118, 110, 0.09);
  --clr-cyan-800-a10: rgba(15, 118, 110, 0.1);
  --clr-teal-50-a88: rgba(243, 251, 249, 0.88);
  --clr-cyan-700-v4: #14b8a6;
  --clr-teal-50-v3: #f3fffc;
  --clr-white-50-a96: rgba(255, 255, 255, 0.96);
  --clr-cyan-800-a30: rgba(15, 118, 110, 0.3);
}

*,
*::before,
*::after {
  transition:
    background-color 0.3s ease,
    border-color 0.3s ease,
    color 0.2s ease;
}

.btn,
.tab-btn,
input,
select {
  transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
}

html,
body {
  background-color: var(--bg-primary) !important;
  color: var(--text-primary) !important;
}

body {
  background:
    radial-gradient(circle at 0 0, var(--primary-dim), var(--transparent) 42%),
    radial-gradient(circle at 100% 0, var(--card-bg-tertiary), var(--transparent) 48%),
    var(--bg-primary) !important;
}

.header {
  background: var(--header-bg) !important;
  border-bottom: 1px solid var(--border) !important;
  color: var(--text-primary) !important;
}

.header h1,
.header-subtitle,
.theme-icon {
  color: var(--text-primary) !important;
}

.header-subtitle {
  color: var(--text-secondary) !important;
}

.hero-card {
  background: var(--hero-grad) !important;
  border-color: var(--border-strong) !important;
  box-shadow: var(--shadow-md) !important;
}

.hero-card::after,
.hero-orb,
.hero-orb-2 {
  background: radial-gradient(circle, var(--hero-glow), var(--transparent)) !important;
}

.hero-lines {
  border-color: var(--border) !important;
  background-color: var(--card-bg-soft) !important;
}

.card,
.summary-card,
.glass,
.filter-card,
.table-card,
.report-card,
.trend-card,
.goal-card,
.category-budget-card,
.calendar-card,
.split-ledger-card {
  background: var(--card-bg) !important;
  border-color: var(--border) !important;
  color: var(--text-primary) !important;
  box-shadow: var(--shadow-md) !important;
}

.glass {
  background: var(--glass-bg) !important;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.card-title,
.summary-value,
.report-value,
.goal-item-name,
.result-total,
.recent-row-title {
  color: var(--text-primary) !important;
}

.summary-label,
.report-label,
.report-line,
.report-advice,
.recent-row-meta,
.goal-item-amount,
.goal-progress-label,
.calendar-month-label,
.cal-num,
.cal-item-info span,
.wallet-item-usage,
.hist-meta {
  color: var(--text-secondary) !important;
}

.form-group input,
.form-group select,
.filter-group input,
.filter-group select,
.wallet-add-row input,
.wallet-add-row select,
.split-person-row input,
.category-budget-input,
#input-budget-limit,
textarea {
  background: var(--input-bg) !important;
  border-color: var(--input-border) !important;
  color: var(--text-primary) !important;
}

.form-group input:hover,
.form-group select:hover,
.filter-group input:hover,
.filter-group select:hover {
  background: var(--input-bg-hover) !important;
}

.form-group input::placeholder,
.filter-group input::placeholder,
.split-person-row input::placeholder,
.wallet-add-row input::placeholder {
  color: var(--input-placeholder) !important;
}

.form-group input:focus,
.form-group select:focus,
.filter-group input:focus,
.filter-group select:focus,
.wallet-add-row input:focus,
.wallet-add-row select:focus,
.split-person-row input:focus,
.category-budget-input:focus,
#input-budget-limit:focus,
textarea:focus {
  border-color: var(--focus-border) !important;
  box-shadow: 0 0 0 3px var(--focus-ring) !important;
}

select,
option {
  background-color: var(--input-bg);
  color: var(--text-primary);
}

.segmented-control {
  background: var(--segmented-bg) !important;
  border-color: var(--border) !important;
}

.segmented-bg {
  background: var(--segmented-active-bg) !important;
  box-shadow: var(--shadow-md);
}

.segmented-control label {
  color: var(--text-secondary) !important;
}

.segmented-control input[type="radio"]:checked + label {
  color: var(--segmented-active-text) !important;
}

.btn {
  border-color: var(--border) !important;
  color: var(--text-primary) !important;
}

.btn-ghost {
  background: var(--btn-ghost-bg) !important;
  border-color: var(--btn-ghost-border) !important;
  color: var(--btn-ghost-text) !important;
}

.btn-ghost:hover {
  background: var(--btn-ghost-bg-hover) !important;
}

.btn-primary {
  background: var(--btn-primary-bg) !important;
  border-color: var(--btn-primary-bg) !important;
  color: var(--btn-primary-text) !important;
}

.btn-primary:hover {
  background: var(--btn-primary-bg-hover) !important;
  border-color: var(--btn-primary-bg-hover) !important;
}

.btn-accent,
.btn-pin.active {
  background: var(--btn-accent-bg) !important;
  border-color: var(--btn-accent-bg) !important;
  color: var(--btn-accent-text) !important;
}

.btn-accent:hover,
.btn-pin.active:hover {
  background: var(--btn-accent-bg-hover) !important;
  border-color: var(--btn-accent-bg-hover) !important;
}

.btn-danger,
.btn-delete {
  color: var(--danger) !important;
  border-color: var(--danger) !important;
  background: var(--danger-dim) !important;
}

.summary-value-income,
.report-value-income,
.text-success {
  color: var(--income) !important;
}

.summary-value-expense,
.report-value-expense,
.text-danger {
  color: var(--expense) !important;
}

.text-accent {
  color: var(--accent) !important;
}

.table-wrapper {
  border-color: var(--border) !important;
  background: var(--card-bg-soft) !important;
}

#expense-table thead th,
#split-ledger-table thead th {
  background: var(--table-head-bg) !important;
  color: var(--text-secondary) !important;
  border-bottom: 1px solid var(--border) !important;
}

#expense-table tbody tr,
#split-ledger-table tbody tr {
  background: var(--table-row-bg) !important;
}

#expense-table tbody tr:nth-child(even),
#split-ledger-table tbody tr:nth-child(even) {
  background: var(--table-row-alt) !important;
}

#expense-table tbody tr:hover,
#split-ledger-table tbody tr:hover {
  background: var(--table-row-hover) !important;
}

#expense-table tbody td,
#split-ledger-table tbody td {
  border-bottom: 1px solid var(--border) !important;
  color: var(--text-primary) !important;
}

.badge,
.wallet-pill,
.split-ledger-status,
.split-ledger-sync,
.undo-inline,
.undo-indicator {
  background: var(--card-bg-soft) !important;
  border-color: var(--border) !important;
  color: var(--text-secondary) !important;
}

.modal-overlay,
#modal-overlay,
#import-overlay,
#import-summary-overlay,
#category-overlay,
#goal-add-overlay,
#goal-fund-overlay,
#wallet-overlay,
#split-overlay,
#budget-overlay,
#recurring-overlay,
#category-budget-overlay {
  background: var(--overlay) !important;
}

.modal,
.split-modal,
.wallet-modal,
.category-budget-modal {
  background: var(--modal-bg) !important;
  color: var(--text-primary) !important;
  border-color: var(--border) !important;
  box-shadow: var(--shadow-lg) !important;
}

.modal-subtext,
.radio-desc,
.import-summary-row,
.help-text {
  color: var(--text-secondary) !important;
}

.radio-option,
.import-summary,
.split-result-summary,
.split-result-item,
.split-history-item,
.wallet-item,
.category-budget-item,
.category-budget-edit-row,
.goal-item,
.calendar-day-detail {
  background: var(--card-bg-soft) !important;
  border-color: var(--border) !important;
}

.budget-bar {
  background: var(--budget-track) !important;
  border-color: var(--border) !important;
}

.budget-fill {
  background: var(--budget-fill) !important;
}

.calendar-grid {
  background: var(--card-bg-soft) !important;
  border-color: var(--border) !important;
}

.cal-day-header {
  color: var(--text-secondary) !important;
}

.cal-day {
  background: var(--calendar-cell-bg) !important;
  border-color: var(--border) !important;
}

.cal-day:hover {
  background: var(--calendar-cell-hover) !important;
  border-color: var(--primary) !important;
}

.cal-day.today {
  background: var(--calendar-today-bg) !important;
  border-color: var(--primary) !important;
}

.toast {
  background: var(--toast-bg) !important;
  color: var(--toast-text) !important;
  border-color: var(--border-strong) !important;
  box-shadow: var(--shadow-md) !important;
}

.toast-success {
  border-left: 4px solid var(--success) !important;
}

.toast-error {
  border-left: 4px solid var(--danger) !important;
}

.toast-info {
  border-left: 4px solid var(--primary) !important;
}

* {
  scrollbar-color: var(--scroll-thumb) var(--scroll-track);
}

::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--scroll-track);
}

::-webkit-scrollbar-thumb {
  background: var(--scroll-thumb);
  border-radius: 999px;
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
}
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-inner">
        <span class="header-icon"><i class="ph-fill ph-wallet"></i></span>
        <div>
          <h1>Expense Tracker</h1>
          <p class="header-subtitle">Kelola pengeluaran harianmu dengan lebih fokus</p>
        </div>
        <button
          class="btn-theme-toggle"
          id="btn-theme-toggle"
          title="Toggle dark mode"
          aria-label="Toggle dark mode"
        >
          <span class="theme-icon" id="theme-icon"><i class="ph-fill ph-moon"></i></span>
        </button>
      </div>
    </header>

    <div class="app-shell">
      <aside class="side-nav" aria-label="Navigasi utama">
        <p class="side-nav-title">Navigasi</p>
        <ul class="side-nav-list">
          <li><button class="nav-link" type="button" data-nav-view="dashboard"><i class="ph-bold ph-house"></i> Dashboard</button></li>
          <li><button class="nav-link" type="button" data-nav-view="add"><i class="ph-bold ph-plus-circle"></i> Tambah Transaksi</button></li>
          <li><button class="nav-link" type="button" data-nav-view="history"><i class="ph-bold ph-list-checks"></i> Riwayat</button></li>
          <li><button class="nav-link" type="button" data-nav-view="report"><i class="ph-bold ph-chart-line-up"></i> Laporan</button></li>
          <li><button class="nav-link" type="button" data-nav-view="tools"><i class="ph-bold ph-toolbox"></i> Tools</button></li>
        </ul>
      </aside>

      <main class="container">
        <section class="card hero-card" data-view="dashboard">
          <span class="card-illus" aria-hidden="true">✶</span>
          <div class="hero-content">
            <div class="hero-kicker">Ringkasan Keuangan</div>
            <h2 class="hero-title">Total Saldo Aktif</h2>
            <div class="hero-value" id="total-balance">Rp 0</div>
            <div class="wallet-balances" id="wallet-balances"></div>
            <button class="btn btn-ghost btn-manage-wallet" id="btn-manage-wallet" type="button" title="Kelola Dompet">
              <i class="ph-bold ph-gear"></i> Kelola Dompet
            </button>

            <div class="budget-container">
              <div class="budget-header">
                <span class="budget-header-label"><i class="ph-bold ph-target"></i> Anggaran Bulanan</span>
                <button class="btn btn-ghost btn-budget-edit" id="btn-edit-budget" type="button" title="Atur Batasan"><i class="ph-bold ph-pencil-simple"></i> Atur</button>
              </div>

              <div class="budget-stats">
                <div class="budget-text-used" id="budget-text-used">Rp 0</div>
                <div class="budget-text-limit" id="budget-text-limit">/ Tidak ada batas</div>
              </div>

              <div class="budget-bar">
                <div class="budget-fill" id="budget-fill"></div>
              </div>

              <div class="budget-footer">
                <p class="hero-note budget-note" id="budget-note">Atur untuk kontrol pengeluaran.</p>
                <div id="budget-pct" class="budget-pct">0%</div>
              </div>
            </div>
          </div>
          <div class="hero-graphic" aria-hidden="true">
            <div class="hero-orb"></div>
            <div class="hero-orb hero-orb-2"></div>
            <div class="hero-lines"></div>
          </div>
        </section>

        <section class="card summary-card" data-view="dashboard">
          <span class="card-illus" aria-hidden="true">◉</span>
          <div class="dashboard-monthly-stats">
            <article class="dashboard-stat">
              <p class="dashboard-stat-label">Pemasukan Bulan Ini</p>
              <p class="dashboard-stat-value summary-value-income" id="dashboard-income">Rp 0</p>
            </article>
            <article class="dashboard-stat">
              <p class="dashboard-stat-label">Pengeluaran Bulan Ini</p>
              <p class="dashboard-stat-value summary-value-expense" id="dashboard-expense">Rp 0</p>
            </article>
            <article class="dashboard-stat">
              <p class="dashboard-stat-label">Net Bulan Ini</p>
              <p class="dashboard-stat-value" id="dashboard-net">Rp 0</p>
            </article>
          </div>
          <div class="summary-grid" style="margin-top: 10px;">
            <div class="summary-item">
              <span class="summary-label">Total Pemasukan</span>
              <span class="summary-value summary-value-income" id="total-income">Rp 0</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Total Pengeluaran</span>
              <span class="summary-value summary-value-expense" id="total-expense">Rp 0</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Jumlah Transaksi</span>
              <span class="summary-value" id="total-count">0</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Kategori Teratas</span>
              <span class="summary-value summary-value-sm" id="top-category">—</span>
            </div>
          </div>
        </section>

        <section class="card glass quick-add-card" id="quick-add-section" data-view="dashboard">
          <span class="card-illus" aria-hidden="true">⚡</span>
          <div class="quick-add-header">
            <h3 class="card-title"><i class="ph-bold ph-lightning"></i> Quick Add</h3>
            <p class="quick-add-subtitle">Tap untuk langsung input transaksi dari template</p>
          </div>
          <div class="quick-add-strip" id="quick-add-strip"></div>
          <div class="quick-add-empty" id="quick-add-empty">
            <svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">
              <rect x="18" y="20" width="84" height="80" rx="14" stroke="currentColor" stroke-width="4"></rect>
              <path d="M36 48h48M36 64h30" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
              <circle cx="90" cy="86" r="10" fill="currentColor" opacity=".22"></circle>
            </svg>
            <p class="empty-title">Belum ada template Quick Add</p>
            <p class="empty-text">Pin transaksi dari riwayat agar input berikutnya lebih cepat.</p>
            <button class="btn btn-ghost" type="button" data-nav-target="history">Buka Riwayat</button>
          </div>
        </section>

        <section class="card glass chart-card" data-view="dashboard">
          <span class="card-illus" aria-hidden="true">◔</span>
          <h3 class="card-title">Grafik Pengeluaran per Kategori</h3>
          <div class="chart-container">
            <canvas id="category-chart" width="280" height="280" aria-label="Grafik pengeluaran per kategori"></canvas>
            <div class="chart-legend" id="chart-legend"></div>
            <div class="chart-tooltip" id="chart-tooltip"></div>
          </div>
          <div class="chart-empty" id="chart-empty">
            <svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">
              <circle cx="60" cy="60" r="36" stroke="currentColor" stroke-width="4"></circle>
              <path d="M60 24v36l22 18" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
            </svg>
            <p class="empty-title">Belum ada data pengeluaran</p>
            <p class="empty-text">Catat transaksi pertama untuk melihat pola kategori.</p>
            <button class="btn btn-primary" type="button" data-nav-target="add">Tambah Transaksi</button>
          </div>
        </section>

        <section class="card glass recent-card" id="recent-card" data-view="dashboard">
          <span class="card-illus" aria-hidden="true">◌</span>
          <h3 class="card-title">5 Transaksi Terakhir</h3>
          <div class="recent-card-list" id="recent-list"></div>
          <div class="empty-block" id="recent-empty" style="display:none;">
            <svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">
              <rect x="20" y="26" width="80" height="66" rx="12" stroke="currentColor" stroke-width="4"></rect>
              <path d="M36 54h48M36 68h34" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
            </svg>
            <p class="empty-title">Belum ada transaksi</p>
            <p class="empty-text">Yuk catat pengeluaran pertamamu 🎯</p>
            <button class="btn btn-primary" type="button" data-nav-target="add">Tambah Transaksi</button>
          </div>
        </section>

        <section class="card glass form-card" data-view="add">
          <span class="card-illus" aria-hidden="true">◈</span>
          <h3 class="card-title">Tambah Transaksi</h3>
          <form id="expense-form" novalidate>
            <div class="form-grid">
              <div class="form-group">
                <label>Jenis Transaksi</label>
                <div class="segmented-control">
                  <input type="radio" id="type-exp" name="input-type" value="expense" checked />
                  <label for="type-exp"><i class="ph-bold ph-arrow-up-right"></i> Pengeluaran</label>

                  <input type="radio" id="type-inc" name="input-type" value="income" />
                  <label for="type-inc"><i class="ph-bold ph-arrow-down-left"></i> Pemasukan</label>

                  <input type="radio" id="type-trf" name="input-type" value="transfer" />
                  <label for="type-trf"><i class="ph-bold ph-arrows-left-right"></i> Transfer</label>

                  <div class="segmented-bg"></div>
                </div>
              </div>
              <div class="form-group">
                <label for="input-wallet" id="label-wallet">Sumber Dana</label>
                <select id="input-wallet" aria-describedby="wallet-help" required>
                  <option value="Tunai">Tunai</option>
                  <option value="Rekening Bank">Rekening Bank</option>
                  <option value="E-Wallet">E-Wallet</option>
                </select>
                <small class="help-text" id="wallet-help" aria-live="polite"></small>
              </div>
              <div class="form-group conditional-group" id="group-wallet-to" data-collapsed="true">
                <label for="input-wallet-to">Tujuan Dana</label>
                <select id="input-wallet-to" aria-describedby="wallet-to-help">
                  <option value="Tunai">Tunai</option>
                  <option value="Rekening Bank">Rekening Bank</option>
                  <option value="E-Wallet">E-Wallet</option>
                </select>
                <small class="help-text" id="wallet-to-help" aria-live="polite"></small>
              </div>
              <div class="form-group">
                <label for="input-date">Tanggal</label>
                <input type="date" id="input-date" required />
                <small class="help-text" id="date-help" aria-live="polite"></small>
              </div>
              <div class="form-group">
                <label for="input-title">Nama Transaksi</label>
                <input
                  type="text"
                  id="input-title"
                  placeholder="cth: Makan siang"
                  list="title-suggestions"
                  aria-describedby="title-help"
                  required
                />
                <small class="help-text" id="title-help" aria-live="polite"></small>
                <datalist id="title-suggestions"></datalist>
              </div>
              <div class="form-group conditional-group" id="group-category" data-collapsed="false">
                <div class="field-header">
                  <label for="input-category">Kategori</label>
                  <button class="btn-ghost btn-add-category" id="btn-add-category" type="button">
                    + Custom
                  </button>
                </div>
                <select id="input-category" required>
                  <option value="" disabled selected>Pilih kategori</option>
                  <optgroup label="Pengeluaran" id="optgroup-expense">
                    <option value="Makanan">Makanan</option>
                    <option value="Transport">Transport</option>
                    <option value="Belanja">Belanja</option>
                    <option value="Hiburan">Hiburan</option>
                    <option value="Kesehatan">Kesehatan</option>
                    <option value="Pendidikan">Pendidikan</option>
                    <option value="Tagihan">Tagihan</option>
                    <option value="Lainnya">Lainnya (Keluar)</option>
                  </optgroup>
                  <optgroup label="Pemasukan" id="optgroup-income">
                    <option value="Gaji">Gaji</option>
                    <option value="Pemasukan Lain">Pemasukan Lain</option>
                  </optgroup>
                </select>
                <small class="help-text" id="category-help" aria-live="polite"></small>
              </div>
              <div class="form-group">
                <label for="input-amount">Nominal (Rp)</label>
                <input
                  type="text"
                  id="input-amount"
                  placeholder="cth: 250,000"
                  inputmode="numeric"
                  required
                />
                <small class="help-text" id="amount-help" aria-live="polite"></small>
              </div>
            </div>
            <div class="form-group checkbox-group">
              <input type="checkbox" id="input-recurring" />
              <label for="input-recurring">Tagihan berulang tiap bulan</label>
            </div>
            <div class="form-actions">
              <button type="submit" id="btn-submit" class="btn btn-primary">
                <i class="ph-bold ph-plus-circle btn-icon"></i> Simpan
              </button>
              <button
                type="button"
                id="btn-cancel"
                class="btn btn-ghost"
                style="display: none"
              >
                Batal
              </button>
            </div>
          </form>
        </section>

        <section class="card glass filter-card" data-view="history">
          <span class="card-illus" aria-hidden="true">◳</span>
          <h3 class="card-title">Filter Transaksi</h3>
          <div class="filter-layout">
            <div class="filter-fields">
              <div class="filter-group">
                <label for="filter-search">Cari Transaksi</label>
                <input
                  type="search"
                  id="filter-search"
                  placeholder="judul, kategori, dompet, nominal..."
                  autocomplete="off"
                />
              </div>
              <div class="filter-group">
                <label for="filter-category">Kategori</label>
                <select id="filter-category">
                  <option value="Semua">Semua</option>
                  <optgroup label="Pengeluaran">
                    <option value="Makanan">Makanan</option>
                    <option value="Transport">Transport</option>
                    <option value="Belanja">Belanja</option>
                    <option value="Hiburan">Hiburan</option>
                    <option value="Kesehatan">Kesehatan</option>
                    <option value="Pendidikan">Pendidikan</option>
                    <option value="Tagihan">Tagihan</option>
                    <option value="Lainnya">Lainnya (Keluar)</option>
                  </optgroup>
                  <optgroup label="Pemasukan">
                    <option value="Gaji">Gaji</option>
                    <option value="Pemasukan Lain">Pemasukan Lain</option>
                  </optgroup>
                </select>
              </div>
              <div class="filter-group">
                <label for="filter-month">Bulan</label>
                <input type="month" id="filter-month" />
              </div>
              <div class="filter-group">
                <label for="filter-sort">Urutkan</label>
                <select id="filter-sort">
                  <option value="date-desc">Tanggal terbaru</option>
                  <option value="date-asc">Tanggal terlama</option>
                  <option value="amount-desc">Nominal tertinggi</option>
                  <option value="amount-asc">Nominal terendah</option>
                </select>
              </div>
              <div class="filter-group filter-group-undo">
                <label>Riwayat</label>
                <div class="undo-inline">
                  <span class="undo-indicator" id="undo-indicator">Undo: 0</span>
                  <button class="btn btn-ghost btn-sm" id="btn-undo" type="button" disabled>
                    Undo
                  </button>
                </div>
              </div>
            </div>
            <div class="filter-actions">
              <button class="btn btn-ghost btn-sm" id="btn-reset-filter" type="button">
                Reset Filter
              </button>
              <button class="btn btn-accent btn-sm" id="btn-export-csv" type="button">
                <i class="ph-bold ph-download-simple btn-icon"></i> Export CSV
              </button>
              <button class="btn btn-ghost btn-sm" id="btn-export-json" type="button">
                <i class="ph-bold ph-export btn-icon"></i> Export JSON
              </button>
              <button class="btn btn-ghost btn-sm" id="btn-import-json" type="button">
                <i class="ph-bold ph-upload-simple btn-icon"></i> Import JSON
              </button>
              <input type="file" id="input-import-json" accept="application/json" hidden />
              <button class="btn btn-split btn-sm" id="btn-open-split" type="button">
                <i class="ph-bold ph-receipt btn-icon"></i> Split Bill
              </button>
            </div>
          </div>
        </section>

        <section class="card glass table-card" data-view="history">
          <span class="card-illus" aria-hidden="true">▦</span>
          <h3 class="card-title">Riwayat Transaksi</h3>
          <p class="render-state" id="render-state" aria-live="polite"></p>
          <div class="table-wrapper">
            <table id="expense-table">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Tipe & Nama</th>
                  <th>Kategori & Dompet</th>
                  <th class="text-right">Nominal</th>
                  <th class="text-center" style="min-width:140px">Aksi</th>
                </tr>
              </thead>
              <tbody id="expense-tbody"></tbody>
            </table>
          </div>
          <div class="empty-state" id="empty-state">
            <svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">
              <rect x="16" y="20" width="88" height="78" rx="14" stroke="currentColor" stroke-width="4"></rect>
              <path d="M36 48h48M36 66h38" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
            </svg>
            <p class="empty-title">Belum ada transaksi</p>
            <p class="empty-text">Yuk catat pengeluaran pertamamu 🎯</p>
            <button class="btn btn-primary" type="button" data-nav-target="add">Tambah Transaksi</button>
          </div>
        </section>

        <section class="card glass calendar-card" id="calendar-section" data-view="history">
          <span class="card-illus" aria-hidden="true">◫</span>
          <div class="calendar-header">
            <h3 class="card-title"><i class="ph-bold ph-calendar-dots"></i> Kalender Pengeluaran</h3>
            <div class="calendar-nav">
              <button class="btn btn-ghost btn-sm btn-cal-nav" id="btn-cal-prev" type="button" title="Bulan sebelumnya">
                <i class="ph-bold ph-caret-left"></i>
              </button>
              <span class="calendar-month-label" id="calendar-month-label">Februari 2026</span>
              <button class="btn btn-ghost btn-sm btn-cal-nav" id="btn-cal-next" type="button" title="Bulan berikutnya">
                <i class="ph-bold ph-caret-right"></i>
              </button>
            </div>
          </div>
          <div class="calendar-grid" id="calendar-grid">
            <div class="cal-day-header">Sen</div>
            <div class="cal-day-header">Sel</div>
            <div class="cal-day-header">Rab</div>
            <div class="cal-day-header">Kam</div>
            <div class="cal-day-header">Jum</div>
            <div class="cal-day-header">Sab</div>
            <div class="cal-day-header">Min</div>
          </div>
          <div class="calendar-day-detail" id="calendar-day-detail" style="display:none">
            <div class="cal-detail-header">
              <strong id="cal-detail-date"></strong>
              <button class="btn btn-ghost btn-sm" id="btn-cal-detail-close" type="button"><i class="ph-bold ph-x"></i></button>
            </div>
            <div class="cal-detail-summary" id="cal-detail-summary"></div>
            <div class="cal-detail-list" id="cal-detail-list"></div>
          </div>
        </section>

        <section class="card glass report-card" id="report-section" data-view="report">
          <span class="card-illus" aria-hidden="true">◍</span>
          <div class="report-header">
            <h3 class="card-title"><i class="ph-bold ph-chart-line-up"></i> Laporan Bulanan Otomatis</h3>
            <span class="report-month" id="report-month-label">Bulan Ini</span>
          </div>
          <div class="report-grid">
            <div class="report-item">
              <span class="report-label">Pemasukan</span>
              <strong class="report-value report-value-income" id="report-income">Rp 0</strong>
            </div>
            <div class="report-item">
              <span class="report-label">Pengeluaran</span>
              <strong class="report-value report-value-expense" id="report-expense">Rp 0</strong>
            </div>
            <div class="report-item">
              <span class="report-label">Net</span>
              <strong class="report-value" id="report-net">Rp 0</strong>
            </div>
            <div class="report-item">
              <span class="report-label">Transaksi</span>
              <strong class="report-value" id="report-count">0</strong>
            </div>
          </div>
          <div class="report-highlights">
            <p class="report-line" id="report-top-category">Kategori teratas: —</p>
            <p class="report-line" id="report-largest-expense">Pengeluaran terbesar: —</p>
            <p class="report-line" id="report-trend">Tren vs bulan lalu: —</p>
            <p class="report-advice" id="report-advice">Belum ada rekomendasi.</p>
          </div>
        </section>

        <section class="card glass trend-card" id="trend-section" data-view="report">
          <span class="card-illus" aria-hidden="true">◈</span>
          <div class="trend-header">
            <h3 class="card-title"><i class="ph-bold ph-chart-bar"></i> Tren 6 Bulan</h3>
            <div class="trend-legend">
              <span class="trend-legend-item trend-legend-income"><span class="trend-dot"></span> Pemasukan</span>
              <span class="trend-legend-item trend-legend-expense"><span class="trend-dot"></span> Pengeluaran</span>
            </div>
          </div>
          <div class="trend-chart-wrapper">
            <canvas id="trend-chart" width="600" height="260" aria-label="Grafik tren pemasukan dan pengeluaran 6 bulan"></canvas>
            <div class="trend-tooltip" id="trend-tooltip"></div>
          </div>
          <div class="trend-empty" id="trend-empty">
            <svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">
              <path d="M16 88h88" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
              <rect x="24" y="62" width="14" height="26" rx="3" fill="currentColor" opacity=".22"></rect>
              <rect x="50" y="48" width="14" height="40" rx="3" fill="currentColor" opacity=".32"></rect>
              <rect x="76" y="34" width="14" height="54" rx="3" fill="currentColor" opacity=".45"></rect>
            </svg>
            <p class="empty-title">Belum cukup data tren</p>
            <p class="empty-text">Tambahkan transaksi rutin supaya tren 6 bulan lebih akurat.</p>
            <button class="btn btn-primary" type="button" data-nav-target="add">Tambah Transaksi</button>
          </div>
        </section>

        <section class="card glass goal-card" id="goal-section" data-view="tools">
          <span class="card-illus goal-illus" aria-hidden="true">★</span>
          <div class="goal-header">
            <h3 class="card-title goal-title"><i class="ph-bold ph-target"></i> Tabungan Impian</h3>
            <button class="btn btn-sm btn-ghost btn-add-goal" id="btn-add-goal" type="button">
              <i class="ph-bold ph-plus"></i> <span class="goal-btn-label">Goal Baru</span>
            </button>
          </div>
          <div class="goal-list" id="goal-list"></div>
        </section>

        <section class="card glass category-budget-card" id="category-budget-section" data-view="tools">
          <span class="card-illus" aria-hidden="true">◎</span>
          <div class="category-budget-header">
            <h3 class="card-title"><i class="ph-bold ph-target"></i> Budget per Kategori</h3>
            <button class="btn btn-ghost btn-sm" id="btn-edit-category-budget" type="button">
              <i class="ph-bold ph-sliders-horizontal"></i> Atur
            </button>
          </div>
          <p class="category-budget-meta" id="category-budget-meta">Belum ada budget kategori aktif.</p>
          <div class="category-budget-list" id="category-budget-list"></div>
          <div class="category-budget-empty" id="category-budget-empty">
            <svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">
              <circle cx="60" cy="60" r="34" stroke="currentColor" stroke-width="4"></circle>
              <path d="M60 42v20M60 72h.01" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
            </svg>
            <p class="empty-title">Belum ada budget kategori</p>
            <p class="empty-text">Tambahkan batas per kategori agar pengeluaran lebih terkontrol.</p>
            <button class="btn btn-ghost" id="btn-edit-category-budget-empty" type="button">Atur Budget</button>
          </div>
        </section>

        <section class="card glass split-ledger-card" id="split-ledger-section" data-view="tools">
          <span class="card-illus" aria-hidden="true">◫</span>
          <div class="split-ledger-header">
            <h3 class="card-title"><i class="ph-bold ph-handshake"></i> Ledger Split Bill</h3>
            <p class="split-ledger-subtitle">Tracking split bill terpisah dari pengeluaran utama.</p>
          </div>
          <div class="table-wrapper split-ledger-wrapper">
            <table id="split-ledger-table">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Bill</th>
                  <th class="text-right">Total</th>
                  <th class="text-right">Porsi Saya</th>
                  <th>Status Saya</th>
                  <th>Sync</th>
                  <th class="text-center">Aksi</th>
                </tr>
              </thead>
              <tbody id="split-ledger-tbody"></tbody>
            </table>
          </div>
          <div class="empty-state split-ledger-empty" id="split-ledger-empty">
            <svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">
              <rect x="20" y="24" width="80" height="74" rx="12" stroke="currentColor" stroke-width="4"></rect>
              <path d="M36 48h48M36 66h42" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
            </svg>
            <p class="empty-title">Belum ada data split bill</p>
            <p class="empty-text">Hitung siapa hutang/piutang lalu simpan ke ledger split.</p>
            <button class="btn btn-primary" id="btn-open-split-empty" type="button">Mulai Split Bill</button>
          </div>
        </section>
      </main>
    </div>

    <nav class="bottom-nav" aria-label="Navigasi mobile">
      <button class="bottom-link" type="button" data-nav-view="dashboard"><i class="ph-bold ph-house"></i><span>Dashboard</span></button>
      <button class="bottom-link" type="button" data-nav-view="add"><i class="ph-bold ph-plus-circle"></i><span>Tambah</span></button>
      <button class="bottom-link" type="button" data-nav-view="history"><i class="ph-bold ph-list-checks"></i><span>Riwayat</span></button>
      <button class="bottom-link" type="button" data-nav-view="report"><i class="ph-bold ph-chart-line-up"></i><span>Laporan</span></button>
      <button class="bottom-link" type="button" data-nav-view="tools"><i class="ph-bold ph-toolbox"></i><span>Lainnya</span></button>
    </nav>
    <button class="fab-add" id="fab-add" type="button" aria-label="Tambah transaksi">
      <i class="ph-bold ph-plus"></i>
    </button>

    <div class="modal-overlay" id="modal-overlay">
      <div class="modal glass" role="dialog" aria-modal="true" aria-labelledby="modal-delete-title">
        <div class="modal-icon"><i class="ph-fill ph-warning-circle" style="color: var(--clr-warning);"></i></div>
        <p class="modal-text" id="modal-delete-title">Yakin ingin menghapus pengeluaran ini?</p>
        <div class="modal-actions">
          <button class="btn btn-danger" id="btn-confirm-delete" type="button">Hapus</button>
          <button class="btn btn-ghost" id="btn-cancel-delete" type="button">Batal</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="budget-overlay">
      <div class="modal glass" role="dialog" aria-modal="true" aria-labelledby="modal-budget-title">
        <div class="modal-icon"><i class="ph-fill ph-target" style="color: var(--clr-primary);"></i></div>
        <h2 class="modal-text" id="modal-budget-title">Atur Batas Bulanan</h2>
        <p class="modal-subtext">Peringatan akan muncul jika Pengeluaran bulan ini melebihi nominal ini. Ketik 0 untuk menonaktifkan.</p>
        <div class="form-group" style="margin-bottom: 1.5rem;">
          <input type="text" id="input-budget-limit" placeholder="cth: 3,000,000" inputmode="numeric" />
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-save-budget" type="button">Simpan Batas</button>
          <button class="btn btn-ghost" id="btn-cancel-budget" type="button">Batal</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="category-budget-overlay">
      <div class="modal glass category-budget-modal" role="dialog" aria-modal="true" aria-labelledby="modal-category-budget-title">
        <div class="modal-icon"><i class="ph-fill ph-target" style="color: var(--clr-accent);"></i></div>
        <h2 class="modal-text" id="modal-category-budget-title">Atur Budget per Kategori</h2>
        <p class="modal-subtext">Isi nominal untuk kategori yang ingin dibatasi. Isi 0 untuk menonaktifkan.</p>
        <div class="category-budget-editor" id="category-budget-editor"></div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-save-category-budget" type="button">Simpan Budget</button>
          <button class="btn btn-ghost" id="btn-cancel-category-budget" type="button">Batal</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="split-overlay">
      <div class="modal glass split-modal" role="dialog" aria-modal="true" aria-labelledby="split-title">
        <div class="split-header">
          <h2 id="split-title"><i class="ph-bold ph-receipt"></i> Split Bill</h2>
          <button class="btn-close" id="btn-close-split" aria-label="Close" type="button">&times;</button>
        </div>

        <div class="split-body" id="split-form-view">
          <div class="split-form-grid">
            <div class="form-group">
              <label for="split-bill-name">Nama Bill</label>
              <input type="text" id="split-bill-name" placeholder="cth: Makan bersama" />
            </div>
            <div class="form-group">
              <label for="split-total">Total Tagihan (Rp)</label>
              <input type="text" id="split-total" placeholder="cth: 250,000" inputmode="numeric" />
            </div>
          </div>

          <div class="form-group split-owner-group">
            <label for="split-owner-name">Nama Saya (untuk tracking)</label>
            <input type="text" id="split-owner-name" placeholder="cth: Asya" />
            <small class="help-text">Nama ini harus ada di daftar peserta agar status piutang/hutang bisa dihitung.</small>
          </div>

          <div class="split-mode-toggle">
            <button class="split-mode-btn active" data-mode="equal" id="mode-equal" type="button"><i class="ph-bold ph-scales"></i> Bagi Rata</button>
            <button class="split-mode-btn" data-mode="custom" id="mode-custom" type="button"><i class="ph-bold ph-pencil-simple"></i> Custom</button>
          </div>

          <div class="split-participants">
            <div class="split-participants-header">
              <label>Peserta</label>
              <button class="btn btn-sm btn-primary" id="btn-add-person" type="button"><i class="ph-bold ph-plus-circle"></i> Tambah</button>
            </div>
            <div class="split-person-list" id="split-person-list"></div>
          </div>

          <div class="form-group split-payer-group">
            <label for="split-payer">Dibayar oleh</label>
            <select id="split-payer"></select>
            <small class="help-text">Dipakai untuk hitung siapa harus bayar dan siapa harus terima.</small>
          </div>

          <div class="split-form-actions">
            <button class="btn btn-primary" id="btn-calculate-split" type="button"><i class="ph-bold ph-calculator"></i> Hitung Split</button>
          </div>
        </div>

        <div class="split-body split-results" id="split-results-view" style="display:none">
          <div class="split-result-summary" id="split-result-summary"></div>
          <div class="split-result-list" id="split-result-list"></div>
          <div class="split-form-actions">
            <button class="btn btn-primary" id="btn-save-split" type="button"><i class="ph-bold ph-floppy-disk"></i> Simpan ke Ledger Split</button>
            <button class="btn btn-ghost" id="btn-back-split" type="button"><i class="ph-bold ph-arrow-left"></i> Kembali</button>
          </div>
        </div>

        <div class="split-history" id="split-history">
          <h3 class="split-history-title"><i class="ph-bold ph-clipboard-text"></i> Riwayat Split</h3>
          <div id="split-history-list" class="split-history-list"></div>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="category-overlay">
      <div class="modal glass" role="dialog" aria-modal="true" aria-labelledby="modal-category-title">
        <div class="modal-icon"><i class="ph-fill ph-circles-four" style="color: var(--clr-primary);"></i></div>
        <h2 class="modal-text" id="modal-category-title">Tambah Kategori Custom</h2>

        <div class="form-group" style="margin-bottom: 1rem;">
          <label for="input-custom-cat-name">Nama Kategori</label>
          <input type="text" id="input-custom-cat-name" placeholder="cth: Kucing, Investasi..." />
        </div>

        <div class="form-group" style="margin-bottom: 1rem;">
          <label for="input-custom-cat-type">Jenis</label>
          <select id="input-custom-cat-type">
            <option value="expense">Pengeluaran</option>
            <option value="income">Pemasukan</option>
          </select>
        </div>

        <div class="form-group" style="margin-bottom: 1.5rem;">
          <label>Pilih Ikon</label>
          <div class="icon-selector" id="icon-selector"></div>
          <input type="hidden" id="input-custom-cat-icon" />
        </div>

        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-save-category" type="button">Tambah Kategori</button>
          <button class="btn btn-ghost" id="btn-cancel-category" type="button">Batal</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="goal-add-overlay">
      <div class="modal glass" role="dialog" aria-modal="true" aria-labelledby="modal-goal-add-title">
        <div class="modal-icon"><i class="ph-fill ph-star" style="color: var(--clr-accent);"></i></div>
        <h2 class="modal-text" id="modal-goal-add-title">Tambah Tabungan Impian</h2>

        <div class="form-group" style="margin-bottom: 1rem;">
          <label for="input-goal-name">Nama Tabungan</label>
          <input type="text" id="input-goal-name" placeholder="cth: Beli Laptop Baru" />
        </div>

        <div class="form-group" style="margin-bottom: 1.5rem;">
          <label for="input-goal-target">Target Dana (Rp)</label>
          <input type="text" id="input-goal-target" placeholder="cth: 15,000,000" inputmode="numeric" />
        </div>

        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-save-goal" type="button" style="background:var(--clr-accent)">Simpan Goal</button>
          <button class="btn btn-ghost" id="btn-cancel-goal" type="button">Batal</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="goal-fund-overlay">
      <div class="modal glass" role="dialog" aria-modal="true" aria-labelledby="modal-goal-fund-title">
        <div class="modal-icon"><i class="ph-fill ph-piggy-bank" style="color: var(--clr-success);"></i></div>
        <h2 class="modal-text" id="modal-goal-fund-title" style="margin-bottom:0.2rem;">Alokasi Dana Tabungan</h2>
        <p style="font-size:0.85rem; color:var(--clr-text-secondary); text-align:center; margin-bottom:1rem;" id="goal-fund-subtitle"></p>

        <input type="hidden" id="input-goal-fund-id" />

        <div class="form-group" style="margin-bottom: 1rem;">
          <label for="input-goal-fund-source">Sumber Dana (Dompet)</label>
          <select id="input-goal-fund-source">
            <option value="Tunai">Tunai</option>
            <option value="Rekening Bank">Rekening Bank</option>
            <option value="E-Wallet">E-Wallet</option>
          </select>
        </div>

        <div class="form-group" style="margin-bottom: 1.5rem;">
          <label for="input-goal-fund-amount">Nominal Masuk (Rp)</label>
          <input type="text" id="input-goal-fund-amount" placeholder="cth: 500,000" inputmode="numeric" />
        </div>

        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-save-goal-fund" type="button" style="background:var(--clr-success)">Simpan Dana</button>
          <button class="btn btn-ghost" id="btn-cancel-goal-fund" type="button">Batal</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="import-overlay">
      <div class="modal glass import-modal" role="dialog" aria-modal="true" aria-labelledby="import-title">
        <div class="modal-icon"><i class="ph-fill ph-upload-simple" style="color: var(--clr-primary);"></i></div>
        <h2 class="modal-text" id="import-title">Impor JSON</h2>
        <p class="modal-subtext">Pilih mode impor untuk data JSON.</p>
        <div class="import-options">
          <label class="radio-option">
            <input type="radio" name="import-mode" value="replace" checked />
            <span class="radio-label">Ganti semua data</span>
            <span class="radio-desc">Hapus data lama, gunakan data dari file.</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="import-mode" value="merge-id" />
            <span class="radio-label">Gabung (berdasarkan ID)</span>
            <span class="radio-desc">Tambahkan item baru yang ID‑nya belum ada.</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="import-mode" value="merge-content" />
            <span class="radio-label">Gabung (berdasarkan konten)</span>
            <span class="radio-desc">Cegah duplikat berdasarkan tanggal+judul+kategori+nominal.</span>
          </label>
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-confirm-import" type="button">Impor</button>
          <button class="btn btn-ghost" id="btn-cancel-import" type="button">Batal</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="import-summary-overlay">
      <div class="modal glass import-summary-modal" role="dialog" aria-modal="true" aria-labelledby="import-summary-title">
        <div class="modal-icon"><i class="ph-fill ph-check-circle" style="color: var(--clr-success);"></i></div>
        <h2 class="modal-text" id="import-summary-title">Ringkasan Impor</h2>
        <div class="import-summary">
          <div class="import-summary-row">
            <span>Mode</span>
            <span id="import-summary-mode">—</span>
          </div>
          <div class="import-summary-row">
            <span>Ditambahkan</span>
            <span id="import-summary-added">0</span>
          </div>
          <div class="import-summary-row">
            <span>Dilewati</span>
            <span id="import-summary-skipped">0</span>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-close-import-summary" type="button">OK</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="recurring-overlay">
      <div class="modal glass" role="dialog" aria-modal="true" aria-labelledby="recurring-title">
        <div class="modal-icon"><i class="ph-fill ph-calendar-check" style="color: var(--clr-primary);"></i></div>
        <h2 class="modal-text" id="recurring-title">Tagihan Berulang</h2>
        <p class="modal-subtext" id="recurring-desc">Ada tagihan rutin yang sudah jatuh tempo. Tambahkan ke pengeluaran bulan ini?</p>
        <div id="recurring-list" style="max-height: 200px; overflow-y: auto; text-align: left; margin-bottom: 1rem; background: rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.1); padding: 0.5rem; border-radius: 8px;"></div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="btn-confirm-recurring" type="button">Catat Semua</button>
          <button class="btn btn-ghost" id="btn-cancel-recurring" type="button">Lewati</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="wallet-overlay">
      <div class="modal glass wallet-modal" role="dialog" aria-modal="true" aria-labelledby="wallet-modal-title">
        <div class="modal-icon"><i class="ph-fill ph-wallet" style="color: var(--clr-primary);"></i></div>
        <h2 class="modal-text" id="wallet-modal-title">Kelola Dompet</h2>
        <p class="modal-subtext">Tambahkan dompet custom atau hapus yang tidak digunakan.</p>
        <div class="wallet-add-row">
          <input type="text" id="input-wallet-name" placeholder="Nama dompet baru" maxlength="30" />
          <select id="input-wallet-icon">
            <option value="ph-wallet">💳 Wallet</option>
            <option value="ph-bank">🏦 Bank</option>
            <option value="ph-device-mobile">📱 Mobile</option>
            <option value="ph-credit-card">💳 Kartu</option>
            <option value="ph-money">💵 Uang</option>
            <option value="ph-coin">🪙 Koin</option>
            <option value="ph-piggy-bank">🐷 Celengan</option>
            <option value="ph-storefront">🏪 Toko</option>
          </select>
          <button class="btn btn-primary btn-sm" id="btn-add-wallet" type="button"><i class="ph-bold ph-plus"></i> Tambah</button>
        </div>
        <div class="wallet-list" id="wallet-list"></div>
        <div class="modal-actions">
          <button class="btn btn-ghost" id="btn-close-wallet" type="button">Tutup</button>
        </div>
      </div>
    </div>

    <div class="toast-container" id="toast-container" aria-live="polite" aria-atomic="true"></div>

    <footer class="footer">
      <p>&copy; 2026 Expense Tracker — Data disimpan di browser (localStorage)</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
      try {
        if (!localStorage.getItem('expense_tracker_theme')) {
          localStorage.setItem('expense_tracker_theme', 'light');
        }
      } catch (e) {
        // ignore
      }
    </script>
    <script>
/* ===========================
   Expense Tracker — script.js
   Enhanced with: dark mode, chart, toasts,
   CSV export, month filter, enhanced summary
   =========================== */

(function () {
  'use strict';

  // ─── Constants ────────────────────────────
  var STORAGE_KEY = 'expense_tracker_data';
  var THEME_KEY = 'expense_tracker_theme';
  var FILTER_KEY = 'expense_tracker_filters';
  var BUDGET_KEY = 'expense_tracker_budget';
  var CATEGORY_BUDGET_KEY = 'expense_tracker_category_budget';
  var SPLIT_LEDGER_KEY = 'expense_tracker_splits';
  var PROFILE_KEY = 'expense_tracker_profile';
  var CUSTOM_CAT_KEY = 'expense_tracker_custom_cat';
  var RECURRING_KEY = 'expense_tracker_recurring';
  var GOALS_KEY = 'expense_tracker_goals';
  var WALLETS_KEY = 'expense_tracker_wallets';
  var TEMPLATES_KEY = 'expense_tracker_templates';
  var CALENDAR_KEY = 'expense_tracker_calendar';
  


  var CATEGORY_COLORS = {
    Makanan: '#f97316',
    Transport: '#0ea5e9',
    Belanja: '#16a34a',
    Hiburan: '#f43f5e',
    Kesehatan: '#14b8a6',
    Pendidikan: '#eab308',
    Tagihan: '#2563eb',
    'Lainnya (Keluar)': '#64748b',
    Gaji: '#0ea5e9',
    'Pemasukan Lain': '#10b981',
  };

  var CATEGORY_ICONS = {
    Makanan: '<i class="ph-fill ph-hamburger"></i>',
    Transport: '<i class="ph-fill ph-car-profile"></i>',
    Belanja: '<i class="ph-fill ph-shopping-cart"></i>',
    Hiburan: '<i class="ph-fill ph-popcorn"></i>',
    Kesehatan: '<i class="ph-fill ph-pill"></i>',
    Pendidikan: '<i class="ph-fill ph-book-open"></i>',
    Tagihan: '<i class="ph-fill ph-receipt"></i>',
    'Lainnya (Keluar)': '<i class="ph-fill ph-package"></i>',
    Gaji: '<i class="ph-fill ph-money"></i>',
    'Pemasukan Lain': '<i class="ph-fill ph-piggy-bank"></i>',
  };

  // ─── DOM References ───────────────────────
  var form = document.getElementById('expense-form');
  var inputDate = document.getElementById('input-date');
  var inputTitle = document.getElementById('input-title');
  var titleSuggestions = document.getElementById('title-suggestions');
  var inputCategory = document.getElementById('input-category');
  var inputAmount = document.getElementById('input-amount');
  var inputTypeRadios = document.getElementsByName('input-type');
  var inputWallet = document.getElementById('input-wallet');
  var inputWalletTo = document.getElementById('input-wallet-to');
  var groupWalletTo = document.getElementById('group-wallet-to');
  var groupCategory = document.getElementById('group-category');
  var labelWallet = document.getElementById('label-wallet');
  var btnSubmit = document.getElementById('btn-submit');
  var btnCancel = document.getElementById('btn-cancel');
  var tbody = document.getElementById('expense-tbody');
  var totalIncomeEl = document.getElementById('total-income');
  var totalExpenseEl = document.getElementById('total-expense');
  var totalCountEl = document.getElementById('total-count');
  var topCategoryEl = document.getElementById('top-category');
  
  var totalBalanceEl = document.getElementById('total-balance');
  var walletBalancesEl = document.getElementById('wallet-balances');
  var budgetTextUsed = document.getElementById('budget-text-used');
  var budgetTextLimit = document.getElementById('budget-text-limit');
  var budgetPct = document.getElementById('budget-pct');
  var budgetFill = document.getElementById('budget-fill');
  var budgetNote = document.getElementById('budget-note');
  var emptyState = document.getElementById('empty-state');
  var dateHelp = document.getElementById('date-help');
  var titleHelp = document.getElementById('title-help');
  var walletHelp = document.getElementById('wallet-help');
  var walletToHelp = document.getElementById('wallet-to-help');
  var categoryHelp = document.getElementById('category-help');
  var amountHelp = document.getElementById('amount-help');
  var filterCategory = document.getElementById('filter-category');
  var filterSearch = document.getElementById('filter-search');
  var filterMonth = document.getElementById('filter-month');
  var filterSort = document.getElementById('filter-sort');
  var btnResetFilter = document.getElementById('btn-reset-filter');
  var btnExportCsv = document.getElementById('btn-export-csv');
  var btnExportJson = document.getElementById('btn-export-json');
  var btnImportJson = document.getElementById('btn-import-json');
  var inputImportJson = document.getElementById('input-import-json');
  var undoIndicator = document.getElementById('undo-indicator');
  var btnUndo = document.getElementById('btn-undo');
  var modalOverlay = document.getElementById('modal-overlay');
  var btnConfirmDelete = document.getElementById('btn-confirm-delete');
  var btnCancelDelete = document.getElementById('btn-cancel-delete');

  var btnAddCategory = document.getElementById('btn-add-category');
  var categoryOverlay = document.getElementById('category-overlay');
  var inputCustomCatName = document.getElementById('input-custom-cat-name');
  var inputCustomCatType = document.getElementById('input-custom-cat-type');
  var inputCustomCatIcon = document.getElementById('input-custom-cat-icon');
  var iconSelector = document.getElementById('icon-selector');
  var btnSaveCategory = document.getElementById('btn-save-category');
  var btnCancelCategory = document.getElementById('btn-cancel-category');
  var btnThemeToggle = document.getElementById('btn-theme-toggle');
  var themeIcon = document.getElementById('theme-icon');
  var chartCanvas = document.getElementById('category-chart');
  var chartLegend = document.getElementById('chart-legend');
  var chartEmpty = document.getElementById('chart-empty');
  var chartTooltip = document.getElementById('chart-tooltip');
  var toastContainer = document.getElementById('toast-container');
  var renderStateEl = document.getElementById('render-state');
  var importOverlay = document.getElementById('import-overlay');
  var btnConfirmImport = document.getElementById('btn-confirm-import');
  var btnCancelImport = document.getElementById('btn-cancel-import');
  var importSummaryOverlay = document.getElementById('import-summary-overlay');
  var importSummaryMode = document.getElementById('import-summary-mode');
  var importSummaryAdded = document.getElementById('import-summary-added');
  var importSummarySkipped = document.getElementById('import-summary-skipped');
  var btnCloseImportSummary = document.getElementById('btn-close-import-summary');

  var btnEditBudget = document.getElementById('btn-edit-budget');
  var budgetOverlay = document.getElementById('budget-overlay');
  var inputBudgetLimit = document.getElementById('input-budget-limit');
  var btnSaveBudget = document.getElementById('btn-save-budget');
  var btnCancelBudget = document.getElementById('btn-cancel-budget');
  var btnEditCategoryBudget = document.getElementById('btn-edit-category-budget');
  var categoryBudgetMeta = document.getElementById('category-budget-meta');
  var categoryBudgetList = document.getElementById('category-budget-list');
  var categoryBudgetEmpty = document.getElementById('category-budget-empty');
  var categoryBudgetOverlay = document.getElementById('category-budget-overlay');
  var categoryBudgetEditor = document.getElementById('category-budget-editor');
  var btnSaveCategoryBudget = document.getElementById('btn-save-category-budget');
  var btnCancelCategoryBudget = document.getElementById('btn-cancel-category-budget');
  var reportMonthLabel = document.getElementById('report-month-label');
  var reportIncomeEl = document.getElementById('report-income');
  var reportExpenseEl = document.getElementById('report-expense');
  var reportNetEl = document.getElementById('report-net');
  var reportCountEl = document.getElementById('report-count');
  var reportTopCategoryEl = document.getElementById('report-top-category');
  var reportLargestExpenseEl = document.getElementById('report-largest-expense');
  var reportTrendEl = document.getElementById('report-trend');
  var reportAdviceEl = document.getElementById('report-advice');

  var inputRecurring = document.getElementById('input-recurring');

  var goalListEl = document.getElementById('goal-list');
  var btnAddGoal = document.getElementById('btn-add-goal');
  var goalAddOverlay = document.getElementById('goal-add-overlay');
  var inputGoalName = document.getElementById('input-goal-name');
  var inputGoalTarget = document.getElementById('input-goal-target');
  var btnSaveGoal = document.getElementById('btn-save-goal');
  var btnCancelGoal = document.getElementById('btn-cancel-goal');

  var goalFundOverlay = document.getElementById('goal-fund-overlay');
  var inputGoalFundId = document.getElementById('input-goal-fund-id');
  var inputGoalFundSource = document.getElementById('input-goal-fund-source');
  var inputGoalFundAmount = document.getElementById('input-goal-fund-amount');
  var btnSaveGoalFund = document.getElementById('btn-save-goal-fund');
  var btnCancelGoalFund = document.getElementById('btn-cancel-goal-fund');
  var goalFundSubtitle = document.getElementById('goal-fund-subtitle');
  var goalSection = document.getElementById('goal-section');
  var splitLedgerTbody = document.getElementById('split-ledger-tbody');
  var splitLedgerEmpty = document.getElementById('split-ledger-empty');

  // New Feature DOM References
  var btnManageWallet = document.getElementById('btn-manage-wallet');
  var walletOverlay = document.getElementById('wallet-overlay');
  var walletList = document.getElementById('wallet-list');
  var btnAddWallet = document.getElementById('btn-add-wallet');
  var inputWalletName = document.getElementById('input-wallet-name');
  var inputWalletIcon = document.getElementById('input-wallet-icon');
  var btnCloseWallet = document.getElementById('btn-close-wallet');
  var quickAddStrip = document.getElementById('quick-add-strip');
  var quickAddSection = document.getElementById('quick-add-section');
  var quickAddEmpty = document.getElementById('quick-add-empty');
  var trendChartCanvas = document.getElementById('trend-chart');
  var trendTooltip = document.getElementById('trend-tooltip');
  var trendEmpty = document.getElementById('trend-empty');
  var calendarGrid = document.getElementById('calendar-grid');
  var calendarMonthLabel = document.getElementById('calendar-month-label');
  var btnCalPrev = document.getElementById('btn-cal-prev');
  var btnCalNext = document.getElementById('btn-cal-next');
  var calendarDayDetail = document.getElementById('calendar-day-detail');
  var calDetailDate = document.getElementById('cal-detail-date');
  var btnCalDetailClose = document.getElementById('btn-cal-detail-close');
  var calDetailSummary = document.getElementById('cal-detail-summary');
  var calDetailList = document.getElementById('cal-detail-list');
  

  // ─── State ────────────────────────────────
  var expenses = [];
  var customCategories = [];
  var recurringExpenses = [];
  var goals = [];
  var userProfile = { name: '' };
  var editingId = null;
  var deleteTargetId = null;
  var lastDeleted = null;
  var undoTimer = null;
  var undoStack = [];
  var pendingImportData = null;
  var MAX_UNDO = 10;
  var chartSlices = [];
  var chartGeom = null;
  var renderTimer = null;
  var isPerfLite = false;
  var chartHoverRaf = null;
  var chartHoverEvent = null;
  var categoryChartInstance = null;
  var hasChartJs = typeof window.Chart === 'function';
  var categoryBudgets = {};
  var wallets = [];
  var templates = [];
  var calendarViewDate = new Date();
  
  var AVAILABLE_ICONS = ['ph-star', 'ph-heart', 'ph-airplane-tilt', 'ph-bag', 'ph-game-controller', 'ph-cat', 'ph-dog', 'ph-car', 'ph-house', 'ph-monitor', 'ph-music-note', 'ph-camera', 'ph-coffee', 'ph-bicycle', 'ph-barbell', 'ph-books', 'ph-graduation-cap', 'ph-bandaids', 'ph-bed', 'ph-plug'];
  var AVAILABLE_COLORS = ['#f43f5e', '#ec4899', '#d946ef', '#a855f7', '#8b5cf6', '#6366f1', '#3b82f6', '#0ea5e9', '#06b6d4', '#14b8a6', '#10b981', '#22c55e', '#84cc16', '#eab308', '#f59e0b', '#f97316', '#ef4444'];
  var DEFAULT_WALLETS = [
    { id: 'w1', name: 'Tunai', icon: 'ph-money' },
    { id: 'w2', name: 'Rekening Bank', icon: 'ph-bank' },
    { id: 'w3', name: 'E-Wallet', icon: 'ph-device-mobile' }
  ];

  // ─── UUID Generator ───────────────────────
  function generateId() {
    return Date.now().toString(36) + '-' + Math.random().toString(36).slice(2, 9);
  }

  function normalizeWalletName(value) {
    return String(value || '').replace(/\s+/g, ' ').trim();
  }

  // ─── Storage Functions ────────────────────
  function getFromStorage() {
    try {
      var raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : [];
    } catch (e) {
      return [];
    }
  }

  function saveToStorage() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
  }

  function saveRecurringToStorage() {
    localStorage.setItem(RECURRING_KEY, JSON.stringify(recurringExpenses));
  }

  function loadRecurringFromStorage() {
    try {
      var raw = localStorage.getItem(RECURRING_KEY);
      recurringExpenses = raw ? JSON.parse(raw) : [];
    } catch (e) {
      recurringExpenses = [];
    }
  }

  function saveCustomCategories() {
    localStorage.setItem(CUSTOM_CAT_KEY, JSON.stringify(customCategories));
  }

  function loadGoalsFromStorage() {
    try {
      var raw = localStorage.getItem(GOALS_KEY);
      goals = raw ? JSON.parse(raw) : [];
    } catch (e) {
      goals = [];
    }
  }

  function saveGoalsToStorage() {
    localStorage.setItem(GOALS_KEY, JSON.stringify(goals));
  }

  function loadProfileFromStorage() {
    try {
      var raw = localStorage.getItem(PROFILE_KEY);
      var parsed = raw ? JSON.parse(raw) : null;
      if (parsed && typeof parsed.name === 'string') {
        userProfile.name = parsed.name.trim();
      } else {
        userProfile.name = '';
      }
    } catch (e) {
      userProfile.name = '';
    }
  }

  function saveProfileToStorage() {
    localStorage.setItem(PROFILE_KEY, JSON.stringify({
      name: (userProfile.name || '').trim(),
    }));
  }

  // ─── Wallet Functions ─────────────────────
  function loadWallets() {
    try {
      var raw = localStorage.getItem(WALLETS_KEY);
      var parsed = raw ? JSON.parse(raw) : DEFAULT_WALLETS;
      wallets = Array.isArray(parsed) ? parsed.filter(function (wallet) {
        return wallet && typeof wallet.name === 'string' && wallet.name.trim();
      }).map(function (wallet) {
        return {
          id: wallet.id || generateId(),
          name: normalizeWalletName(wallet.name),
          icon: wallet.icon || 'ph-wallet'
        };
      }) : [];
    } catch (e) {
      wallets = [];
    }

    if (!wallets.length) {
      wallets = DEFAULT_WALLETS.map(function (wallet) {
        return { id: wallet.id, name: wallet.name, icon: wallet.icon };
      });
    }
  }

  function saveWallets() {
    localStorage.setItem(WALLETS_KEY, JSON.stringify(wallets));
    renderWalletDropdowns();
  }

  function renderWalletList() {
    if (!walletList) return;
    walletList.innerHTML = '';
    
    wallets.forEach(function(wallet) {
      var item = document.createElement('div');
      item.className = 'wallet-item';
      var usageCount = expenses.filter(function (entry) {
        return entry.wallet === wallet.name || entry.walletTo === wallet.name;
      }).length;
      var deleteDisabled = usageCount > 0 || wallets.length <= 1;
      var deleteTitle = usageCount > 0
        ? 'Tidak dapat dihapus karena masih digunakan dalam transaksi'
        : (wallets.length <= 1 ? 'Setidaknya harus ada satu dompet aktif' : 'Hapus dompet');
      item.innerHTML = 
        '<div class="wallet-item-icon"><i class="ph-fill ' + wallet.icon + '"></i></div>' +
        '<div class="wallet-item-meta">' +
          '<div class="wallet-item-name">' + escapeHtml(wallet.name) + '</div>' +
          '<div class="wallet-item-usage">Dipakai di ' + usageCount + ' transaksi</div>' +
        '</div>' +
        '<button class="btn btn-ghost btn-sm btn-del-wallet" data-id="' + wallet.id + '" title="' + deleteTitle + '" ' + (deleteDisabled ? 'disabled aria-disabled="true"' : '') + '><i class="ph-bold ph-trash"></i></button>';
      
      var btnDel = item.querySelector('.btn-del-wallet');
      btnDel.addEventListener('click', function() {
        if (deleteDisabled) return;
        var id = this.dataset.id;
        var inUse = expenses.some(function(e) { return e.wallet === wallet.name || e.walletTo === wallet.name; });
        if (inUse) {
          showToast('Dompet masih digunakan dalam transaksi. Tidak bisa dihapus.', 'error');
          return;
        }
        if (wallets.length <= 1) {
          showToast('Minimal harus ada 1 dompet aktif.', 'error');
          return;
        }
        wallets = wallets.filter(function(w) { return w.id !== id; });
        saveWallets();
        renderWalletList();
        renderTable();
        showToast('Dompet berhasil dihapus', 'success');
      });
      
      walletList.appendChild(item);
    });
  }

  function renderWalletDropdowns() {
    var walletSelects = [inputWallet, inputWalletTo, inputGoalFundSource];
    
    walletSelects.forEach(function(sel) {
      if (!sel) return;
      var currentVal = sel.value;
      sel.innerHTML = '';
      
      wallets.forEach(function(w) {
        var opt = document.createElement('option');
        opt.value = w.name;
        opt.textContent = w.name;
        sel.appendChild(opt);
      });
      if (currentVal && wallets.some(function (wallet) { return wallet.name === currentVal; })) {
        sel.value = currentVal;
      } else if (wallets.length > 0) {
        sel.value = wallets[0].name;
      }
    });
  }

  // ─── Template Functions ───────────────────
  function loadTemplates() {
    try {
      var raw = localStorage.getItem(TEMPLATES_KEY);
      templates = raw ? JSON.parse(raw) : [];
    } catch (e) {
      templates = [];
    }
  }

  function saveTemplates() {
    localStorage.setItem(TEMPLATES_KEY, JSON.stringify(templates));
    renderTemplateStrip();
  }

  function renderTemplateStrip() {
    if (!quickAddStrip) return;
    quickAddStrip.innerHTML = '';
    
    if (templates.length === 0) {
      if (quickAddEmpty) quickAddEmpty.style.display = 'block';
      quickAddStrip.style.display = 'none';
      if (quickAddSection) quickAddSection.style.display = 'none';
      return;
    }
    
    if (quickAddEmpty) quickAddEmpty.style.display = 'none';
    quickAddStrip.style.display = 'flex';
    if (quickAddSection) quickAddSection.style.display = 'block';
    
    templates.forEach(function(tpl) {
      var card = document.createElement('div');
      card.className = 'template-card';
      var iconHtml = CATEGORY_ICONS[tpl.category] || '<i class="ph-fill ph-tag"></i>';
      
      card.innerHTML = 
        '<div class="template-icon">' + iconHtml + '</div>' + 
        '<div class="template-name">' + escapeHtml(tpl.title) + '</div>' +
        '<div class="template-amount">' + formatRupiah(tpl.amount) + '</div>' +
        '<button class="btn-del-template" data-id="' + tpl.id + '"><i class="ph-bold ph-x"></i></button>';
      
      card.addEventListener('click', function(e) {
        if (e.target.closest('.btn-del-template')) return;
        
        // Directly create the expense from template
        var newExpense = {
          id: generateId(),
          type: tpl.type,
          wallet: tpl.wallet || 'Tunai',
          date: getTodayString(),
          title: tpl.title,
          category: tpl.category,
          amount: tpl.amount
        };

        var walletExists = wallets.some(function (wallet) { return wallet.name === newExpense.wallet; });
        if (!walletExists && wallets.length > 0) {
          newExpense.wallet = wallets[0].name;
          showToast('Dompet template tidak ditemukan. Transaksi dialihkan ke dompet ' + wallets[0].name + '.', 'info');
        }
        
        expenses.push(newExpense);
        saveToStorage();
        renderTable();
        showToast('Template "' + tpl.title + '" ditambahkan', 'success');
      });
      
      var btnDel = card.querySelector('.btn-del-template');
      btnDel.addEventListener('click', function() {
        var id = this.dataset.id;
        templates = templates.filter(function(t) { return t.id !== id; });
        saveTemplates();
      });
      
      quickAddStrip.appendChild(card);
    });
  }

  // ─── Theme (Dark Mode) ───────────────────
  function getTheme() {
    return localStorage.getItem(THEME_KEY) || 'dark';
  }

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem(THEME_KEY, theme);
    themeIcon.innerHTML = theme === 'dark' ? '<i class="ph-fill ph-sun"></i>' : '<i class="ph-fill ph-moon"></i>';
    
    // Refresh chart to apply theme-specific colors (e.g., center text)
    if (typeof renderTable === 'function') {
      renderTable();
    }
  }

  function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme') || 'light';
    setTheme(current === 'dark' ? 'light' : 'dark');
  }

  // ─── Toast Notifications ─────────────────
  function showToast(message, type) {
    type = type || 'success';
    var icons = { success: '<i class="ph-fill ph-check-circle" style="color: var(--clr-success);"></i>', error: '<i class="ph-fill ph-warning-circle" style="color: var(--clr-danger);"></i>', info: '<i class="ph-fill ph-info" style="color: var(--clr-accent);"></i>' };
    var toast = document.createElement('div');
    toast.className = 'toast toast-' + type;
    toast.innerHTML =
      '<span class="toast-icon">' + (icons[type] || '<i class="ph-fill ph-check-circle"></i>') + '</span>' +
      '<span>' + escapeHtml(message) + '</span>';
    toastContainer.appendChild(toast);

    setTimeout(function () {
      toast.classList.add('toast-out');
      setTimeout(function () {
        if (toast.parentNode) toast.parentNode.removeChild(toast);
      }, 300);
    }, 2500);
  }

  function showUndoToast(message, onUndo) {
    var toast = document.createElement('div');
    toast.className = 'toast toast-info';
    toast.innerHTML =
      '<span class="toast-icon"><i class="ph-bold ph-arrow-u-up-left" style="color: var(--clr-accent);"></i></span>' +
      '<span>' + escapeHtml(message) + '</span>' +
      '<button class="toast-action" type="button">Undo</button>';

    var btn = toast.querySelector('.toast-action');
    btn.addEventListener('click', function () {
      if (onUndo) onUndo();
      toast.classList.add('toast-out');
      setTimeout(function () {
        if (toast.parentNode) toast.parentNode.removeChild(toast);
      }, 200);
    });

    toastContainer.appendChild(toast);

    setTimeout(function () {
      toast.classList.add('toast-out');
      setTimeout(function () {
        if (toast.parentNode) toast.parentNode.removeChild(toast);
      }, 300);
    }, 5000);
  }

  function showUndoStackToast() {
    if (!undoStack.length) return;
    showUndoToast('Perubahan dibatalkan', function () {
      var prev = undoStack.pop();
      if (!prev) return;
      expenses = prev;
      saveToStorage();
      renderTable();
      updateUndoIndicator();
      showToast('Undo berhasil', 'success');
    });
  }

  function pushUndo(state) {
    undoStack.push(state.slice());
    if (undoStack.length > MAX_UNDO) {
      undoStack.shift();
    }
    updateUndoIndicator();
  }

  function updateUndoIndicator() {
    undoIndicator.textContent = 'Undo: ' + undoStack.length;
    btnUndo.disabled = undoStack.length === 0;
  }

  function undoLast() {
    if (!undoStack.length) {
      showToast('Tidak ada undo tersedia', 'info');
      return;
    }
    var prev = undoStack.pop();
    if (!prev) return;
    expenses = prev;
    saveToStorage();
    renderTable();
    updateUndoIndicator();
    showToast('Undo berhasil', 'success');
  }

  // ─── Format Helpers ───────────────────────
  function formatRupiah(num) {
    return 'Rp ' + Number(num).toLocaleString('id-ID');
  }

  function formatDate(dateStr) {
    var d = new Date(dateStr + 'T00:00:00');
    return d.toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
    });
  }

  function normalizePersonName(name) {
    return String(name || '').trim().replace(/\s+/g, ' ').toLowerCase();
  }

  function getCurrentMonthKey() {
    var now = new Date();
    return now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0');
  }

  function getMonthLabel(monthKey) {
    if (!monthKey || monthKey.length !== 7) return 'Bulan Ini';
    var monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    var parts = monthKey.split('-');
    var year = Number(parts[0]);
    var monthIndex = Number(parts[1]) - 1;
    if (monthIndex < 0 || monthIndex > 11 || !year) return 'Bulan Ini';
    return monthNames[monthIndex] + ' ' + year;
  }

  function getPreviousMonthKey(monthKey) {
    var parts = (monthKey || getCurrentMonthKey()).split('-');
    var year = Number(parts[0]);
    var month = Number(parts[1]);
    if (!year || !month) return getCurrentMonthKey();
    month -= 1;
    if (month === 0) {
      month = 12;
      year -= 1;
    }
    return year + '-' + String(month).padStart(2, '0');
  }

  // ─── Calculate Total ─────────────────────
  function calculateTotal(data) {
    return data.reduce(function (res, item) {
      if (item.type === 'income') {
        res.income += item.amount;
      } else if (item.type === 'expense') {
        res.expense += item.amount;
      }
      res.balance = res.income - res.expense;
      return res;
    }, { income: 0, expense: 0, balance: 0 });
  }

  function updateSummary(filteredData) {
    var totals = calculateTotal(filteredData);
    totalIncomeEl.textContent = formatRupiah(totals.income);
    totalExpenseEl.textContent = formatRupiah(totals.expense);
    totalCountEl.textContent = filteredData.length;

    // Pulse animation
    [totalIncomeEl, totalExpenseEl, totalCountEl, topCategoryEl].forEach(function (el) {
      el.classList.remove('pulse');
      void el.offsetWidth; // reflow
      el.classList.add('pulse');
    });

    // Remove Avg per day calculation

    if (filteredData.length > 0) {
      var catTotals = {};
      filteredData.forEach(function (item) {
        if (item.type !== 'income') {
          catTotals[item.category] = (catTotals[item.category] || 0) + item.amount;
        }
      });
      var topCat = '';
      var topVal = 0;
      Object.keys(catTotals).forEach(function (cat) {
        if (catTotals[cat] > topVal) {
          topVal = catTotals[cat];
          topCat = cat;
        }
      });
      topCategoryEl.innerHTML = (CATEGORY_ICONS[topCat] || '') + ' ' + topCat;
    } else {
      topCategoryEl.textContent = '—';
    }
  }

  function getReportMonthKey() {
    if (filterMonth && filterMonth.value) return filterMonth.value;
    return getCurrentMonthKey();
  }

  function renderMonthlyReport() {
    if (!reportMonthLabel) return;

    var monthKey = getReportMonthKey();
    var previousMonthKey = getPreviousMonthKey(monthKey);
    var monthData = expenses.filter(function (item) {
      return item.date && item.date.substring(0, 7) === monthKey;
    });

    var monthIncome = 0;
    var monthExpense = 0;
    var categoryTotals = {};
    var largestExpense = null;

    monthData.forEach(function (item) {
      if (item.type === 'income') {
        monthIncome += item.amount;
      } else if (item.type !== 'transfer') {
        monthExpense += item.amount;
        categoryTotals[item.category] = (categoryTotals[item.category] || 0) + item.amount;
        if (!largestExpense || item.amount > largestExpense.amount) {
          largestExpense = item;
        }
      }
    });

    var topCategory = '—';
    var topCategoryAmount = 0;
    Object.keys(categoryTotals).forEach(function (cat) {
      if (categoryTotals[cat] > topCategoryAmount) {
        topCategoryAmount = categoryTotals[cat];
        topCategory = cat;
      }
    });

    var prevExpense = expenses.reduce(function (sum, item) {
      if (item.type !== 'income' && item.type !== 'transfer' && item.date && item.date.substring(0, 7) === previousMonthKey) {
        return sum + item.amount;
      }
      return sum;
    }, 0);

    var net = monthIncome - monthExpense;
    var trendText = 'Stabil terhadap bulan lalu.';
    if (prevExpense === 0 && monthExpense > 0) {
      trendText = 'Ada pengeluaran baru dibanding bulan lalu.';
    } else if (prevExpense > 0) {
      var diff = monthExpense - prevExpense;
      var pct = Math.abs((diff / prevExpense) * 100);
      if (diff > 0) {
        trendText = 'Naik ' + pct.toFixed(1) + '% dibanding bulan lalu.';
      } else if (diff < 0) {
        trendText = 'Turun ' + pct.toFixed(1) + '% dibanding bulan lalu.';
      }
    }

    var advice = 'Belum ada rekomendasi.';
    if (monthExpense === 0) {
      advice = 'Belum ada pengeluaran tercatat di bulan ini. Jaga konsistensi pencatatan.';
    } else if (net < 0) {
      advice = 'Pengeluaran melebihi pemasukan. Prioritaskan biaya wajib dan kurangi pos non-esensial.';
    } else if (topCategoryAmount > 0 && (topCategoryAmount / monthExpense) >= 0.45) {
      advice = 'Kategori ' + topCategory + ' mendominasi pengeluaran. Pertimbangkan set budget lebih ketat di kategori ini.';
    } else if (monthIncome > 0 && (monthExpense / monthIncome) >= 0.8) {
      advice = 'Pengeluaran sudah mendekati pemasukan. Sisakan buffer minimal 20% untuk tabungan/darurat.';
    } else {
      advice = 'Arus kas bulan ini cukup sehat. Pertahankan ritme dan tingkatkan porsi tabungan.';
    }

    reportMonthLabel.textContent = getMonthLabel(monthKey);
    reportIncomeEl.textContent = formatRupiah(monthIncome);
    reportExpenseEl.textContent = formatRupiah(monthExpense);
    reportNetEl.textContent = formatRupiah(net);
    reportNetEl.classList.remove('report-value-positive', 'report-value-negative');
    reportNetEl.classList.add(net >= 0 ? 'report-value-positive' : 'report-value-negative');
    reportCountEl.textContent = String(monthData.length);
    reportTopCategoryEl.textContent = 'Kategori teratas: ' + (topCategory === '—' ? '—' : (topCategory + ' (' + formatRupiah(topCategoryAmount) + ')'));
    reportLargestExpenseEl.textContent = largestExpense ? ('Pengeluaran terbesar: ' + largestExpense.title + ' (' + formatRupiah(largestExpense.amount) + ')') : 'Pengeluaran terbesar: —';
    reportTrendEl.textContent = 'Tren vs bulan lalu: ' + trendText;
    reportAdviceEl.textContent = advice;
    
    // Trigger trend chart update if report changes
    renderTrendChart();
  }

  // ─── Trend Chart (6 Months) ─────────────
  function renderTrendChart() {
    if (!trendChartCanvas) return;
    var ctx = trendChartCanvas.getContext('2d');
    var dpr = window.devicePixelRatio || 1;
    var parentW = trendChartCanvas.parentElement ? trendChartCanvas.parentElement.clientWidth : 580;
    var canvasWidth = Math.max(parentW, 400);
    var canvasHeight = 260;
    trendChartCanvas.width = canvasWidth * dpr;
    trendChartCanvas.height = canvasHeight * dpr;
    trendChartCanvas.style.width = canvasWidth + 'px';
    trendChartCanvas.style.height = canvasHeight + 'px';
    ctx.scale(dpr, dpr);

    // Get last 6 months labels and keys
    var months = [];
    var current = getCurrentMonthKey();
    for (var i = 0; i < 6; i++) {
      months.unshift(current);
      current = getPreviousMonthKey(current);
    }

    var data = months.map(function(m) {
      var inc = 0, exp = 0;
      expenses.forEach(function(e) {
        if (e.date.startsWith(m)) {
          if (e.type === 'income') inc += e.amount;
          else if (e.type === 'expense') exp += e.amount;
        }
      });
      return { month: m, income: inc, expense: exp };
    });

    var maxVal = Math.max.apply(Math, data.map(function(d) { return Math.max(d.income, d.expense); })) || 100000;
    if (maxVal >= 1000000) {
      maxVal = Math.ceil(maxVal / 1000000) * 1000000;
    } else if (maxVal >= 100000) {
      maxVal = Math.ceil(maxVal / 100000) * 100000;
    } else {
      maxVal = Math.ceil(maxVal / 10000) * 10000;
    }
    maxVal = Math.max(maxVal, 10000);

    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
    
    if (expenses.length === 0) {
      if (trendEmpty) trendEmpty.style.display = 'block';
      trendChartCanvas.style.display = 'none';
      return;
    }
    if (trendEmpty) trendEmpty.style.display = 'none';
    trendChartCanvas.style.display = 'block';

    var padding = { top: 20, right: 20, bottom: 40, left: 60 };
    var chartW = canvasWidth - padding.left - padding.right;
    var chartH = canvasHeight - padding.top - padding.bottom;
    var barGap = 20;
    var barWidth = (chartW / 6) - barGap;

    // Draw Y Axis labels
    ctx.fillStyle = getTheme() === 'dark' ? '#94a3b8' : '#64748b';
    ctx.font = '10px Manrope';
    ctx.textAlign = 'right';
    for (var j = 0; j <= 4; j++) {
      var y = padding.top + chartH - (j * (chartH / 4));
      var labelVal = (maxVal / 4) * j;
      ctx.fillText(labelVal >= 1000000 ? (labelVal / 1000000).toFixed(1) + 'M' : (labelVal / 1000).toFixed(0) + 'K', padding.left - 10, y + 4);
      
      // Grid lines
      ctx.beginPath();
      ctx.strokeStyle = getTheme() === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';
      ctx.moveTo(padding.left, y);
      ctx.lineTo(padding.left + chartW, y);
      ctx.stroke();
    }

    // Draw Bars
    data.forEach(function(d, idx) {
      var xBase = padding.left + (idx * (chartW / 6)) + (barGap / 2);
      var incH = (d.income / maxVal) * chartH;
      var expH = (d.expense / maxVal) * chartH;
      
      // Income Bar
      ctx.fillStyle = '#10b981';
      ctx.beginPath();
      ctx.roundRect(xBase, padding.top + chartH - incH, barWidth / 2 - 2, incH, [4, 4, 0, 0]);
      ctx.fill();
      
      // Expense Bar
      ctx.fillStyle = '#f43f5e';
      ctx.beginPath();
      ctx.roundRect(xBase + barWidth / 2 + 2, padding.top + chartH - expH, barWidth / 2 - 2, expH, [4, 4, 0, 0]);
      ctx.fill();
      
      // X Label
      var label = d.month.split('-')[1] + '/' + d.month.split('-')[0].substring(2);
      ctx.fillStyle = getTheme() === 'dark' ? '#94a3b8' : '#64748b';
      ctx.textAlign = 'center';
      ctx.fillText(label, xBase + barWidth / 2, padding.top + chartH + 20);
    });
  }

  // ─── Calendar Functions ───────────────────
  function updateCalendarHeader() {
    if (!calendarMonthLabel) return;
    var months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    calendarMonthLabel.textContent = months[calendarViewDate.getMonth()] + ' ' + calendarViewDate.getFullYear();
  }

  function renderCalendar() {
    if (!calendarGrid) return;
    updateCalendarHeader();
    
    // Clear existing cells but keep headers (first 7 children)
    while (calendarGrid.children.length > 7) {
      calendarGrid.removeChild(calendarGrid.lastChild);
    }

    var year = calendarViewDate.getFullYear();
    var month = calendarViewDate.getMonth();
    var firstDay = new Date(year, month, 1).getDay(); // 0(Sun) to 6(Sat)
    // Convert to 0(Mon) to 6(Sun)
    var startOffset = firstDay === 0 ? 6 : firstDay - 1;
    
    var daysInMonth = new Date(year, month + 1, 0).getDate();
    var today = getTodayString();

    // Padding for start
    for (var i = 0; i < startOffset; i++) {
      var empty = document.createElement('div');
      empty.className = 'cal-day empty';
      calendarGrid.appendChild(empty);
    }

    // Days
    for (var d = 1; d <= daysInMonth; d++) {
      var dateKey = year + '-' + String(month + 1).padStart(2, '0') + '-' + String(d).padStart(2, '0');
      var dayExpenses = expenses.filter(function(e) { return e.date === dateKey; });
      
      var cell = document.createElement('div');
      cell.className = 'cal-day' + (dateKey === today ? ' today' : '');
      cell.dataset.date = dateKey;
      
      var innerHtml = '<span class="cal-num">' + d + '</span>';
      
      if (dayExpenses.length > 0) {
        var dayInc = 0, dayExp = 0;
        dayExpenses.forEach(function(e) {
          if (e.type === 'income') dayInc += e.amount;
          else if (e.type === 'expense') dayExp += e.amount;
        });
        
        innerHtml += '<div class="cal-spending">';
        if (dayExp > 0) innerHtml += '<span class="cal-amount cal-amount-exp">-' + (dayExp / 1000).toFixed(0) + 'k</span>';
        if (dayInc > 0) innerHtml += '<span class="cal-amount cal-amount-inc">+' + (dayInc / 1000).toFixed(0) + 'k</span>';
        
        innerHtml += '<div class="cal-dots">';
        if (dayExp > 0) innerHtml += '<span class="cal-dot" style="background:#f43f5e"></span>';
        if (dayInc > 0) innerHtml += '<span class="cal-dot" style="background:#10b981"></span>';
        innerHtml += '</div></div>';
      }
      
      cell.innerHTML = innerHtml;
      cell.addEventListener('click', function() {
        renderDayDetail(this.dataset.date);
      });
      
      calendarGrid.appendChild(cell);
    }
  }

  function renderDayDetail(dateStr) {
    if (!calendarDayDetail) return;
    var dayData = expenses.filter(function(e) { return e.date === dateStr; });
    
    calDetailDate.textContent = formatDate(dateStr);
    calDetailList.innerHTML = '';
    
    var totalInc = 0, totalExp = 0;
    dayData.forEach(function(item) {
      if (item.type === 'income') totalInc += item.amount;
      else if (item.type === 'expense') totalExp += item.amount;
      
      var itemDiv = document.createElement('div');
      itemDiv.className = 'cal-item';
      var isInc = item.type === 'income';
      
      itemDiv.innerHTML = 
        '<div class="cal-item-left">' +
          '<div class="category-icon">' + (CATEGORY_ICONS[item.category] || '') + '</div>' +
          '<div class="cal-item-info">' +
            '<strong>' + escapeHtml(item.title) + '</strong>' +
            '<span>' + escapeHtml(item.category) + ' • ' + escapeHtml(item.wallet) + '</span>' +
          '</div>' +
        '</div>' +
        '<div class="cal-item-right ' + (isInc ? 'text-success' : 'text-danger') + '">' +
          (isInc ? '+' : '-') + formatRupiah(item.amount) +
        '</div>';
      calDetailList.appendChild(itemDiv);
    });
    
    calDetailSummary.innerHTML = 
      '<div><small>Pemasukan</small><br><strong class="text-success">' + formatRupiah(totalInc) + '</strong></div>' +
      '<div><small>Pengeluaran</small><br><strong class="text-danger">' + formatRupiah(totalExp) + '</strong></div>' +
      '<div><small>Selisih</small><br><strong>' + formatRupiah(totalInc - totalExp) + '</strong></div>';
    
    calendarDayDetail.style.display = 'flex';
  }

  // ─── Budget Logic ──────────────────────────
  function getBudgetLimit() {
    return Number(localStorage.getItem(BUDGET_KEY)) || 0;
  }
  
  function saveBudgetLimit(val) {
    localStorage.setItem(BUDGET_KEY, val);
  }

  function loadCategoryBudgets() {
    try {
      var raw = localStorage.getItem(CATEGORY_BUDGET_KEY);
      var parsed = raw ? JSON.parse(raw) : {};
      categoryBudgets = {};
      if (parsed && typeof parsed === 'object') {
        Object.keys(parsed).forEach(function (cat) {
          var val = Number(parsed[cat]);
          if (cat && val > 0) categoryBudgets[cat] = val;
        });
      }
    } catch (e) {
      categoryBudgets = {};
    }
  }

  function saveCategoryBudgets() {
    localStorage.setItem(CATEGORY_BUDGET_KEY, JSON.stringify(categoryBudgets));
  }

  function getExpenseCategories() {
    var seen = {};
    var out = [];
    var expenseGroup = document.getElementById('optgroup-expense');

    if (expenseGroup) {
      var options = expenseGroup.querySelectorAll('option');
      options.forEach(function (opt) {
        var value = (opt.value || '').trim();
        if (!value || seen[value]) return;
        seen[value] = true;
        out.push(value);
      });
    }

    expenses.forEach(function (item) {
      if (item.type === 'income' || item.type === 'transfer') return;
      var cat = (item.category || '').trim();
      if (!cat || seen[cat]) return;
      seen[cat] = true;
      out.push(cat);
    });

    return out.sort(function (a, b) {
      return a.localeCompare(b, 'id');
    });
  }

  // ─── Calculate Individual Wallets ────────
  function calculateWalletBalances(data) {
    var walletsResult = {};
    wallets.forEach(function(w) {
      walletsResult[w.name] = 0;
    });
    
    data.forEach(function(item) {
      var w = item.wallet || 'Tunai';
      if (typeof walletsResult[w] === 'undefined') walletsResult[w] = 0;
      
      if (item.type === 'income') {
        walletsResult[w] += item.amount;
      } else if (item.type === 'expense') {
        walletsResult[w] -= item.amount;
      } else if (item.type === 'transfer') {
        var wTo = item.walletTo || 'Tunai';
        if (typeof walletsResult[wTo] === 'undefined') walletsResult[wTo] = 0;
        
        walletsResult[w] -= item.amount;
        walletsResult[wTo] += item.amount;
      }
    });
    
    return walletsResult;
  }

  // ─── Update Hero (Balance & Budget) ──────
  function updateHero() {
    var totals = calculateTotal(expenses);
    totalBalanceEl.textContent = formatRupiah(totals.balance);

    if (walletBalancesEl) {
      var wals = calculateWalletBalances(expenses);
      walletBalancesEl.innerHTML = '';
      Object.keys(wals).forEach(function(w) {
        var bal = wals[w];
        var walletObj = wallets.find(function(obj) { return obj.name === w; });
        var icon = walletObj ? ('<i class="ph-bold ' + walletObj.icon + '"></i>') : '<i class="ph-bold ph-wallet"></i>';
        
        var wDiv = document.createElement('div');
        wDiv.className = 'wallet-pill';
        wDiv.innerHTML =
          '<span class="wallet-pill-label">' + icon + ' ' + escapeHtml(w) + '</span>' +
          '<strong class="wallet-pill-value">' + formatRupiah(bal) + '</strong>';
        walletBalancesEl.appendChild(wDiv);
      });
    }

    // Calculate this month's expense
    var currentMonth = getCurrentMonthKey();
    
    var monthExpenses = expenses.filter(function(item) {
      return (item.type !== 'income') && item.date.startsWith(currentMonth);
    });
    
    var monthExpenseTotal = monthExpenses.reduce(function(sum, item) { return sum + item.amount; }, 0);
    var budget = getBudgetLimit();
    
    if (budget > 0) {
      budgetTextUsed.textContent = formatRupiah(monthExpenseTotal);
      budgetTextLimit.textContent = '/ ' + formatRupiah(budget);
      var pct = Math.min((monthExpenseTotal / budget) * 100, 100);
      budgetPct.textContent = Math.round(pct) + '%';
      budgetPct.style.display = 'block';
      budgetFill.style.width = pct + '%';
      
      if (pct >= 90) {
        budgetFill.style.background = 'var(--clr-danger)';
        budgetPct.style.background = 'var(--clr-danger)';
        budgetPct.style.color = '#fff';
        budgetNote.textContent = 'Hati-hati! Pengeluaran Anda hampir melewati batas.';
      } else if (pct >= 70) {
        budgetFill.style.background = 'var(--clr-warning)';
        budgetPct.style.background = 'var(--clr-warning)';
        budgetPct.style.color = '#000';
        budgetNote.textContent = 'Pengeluaran bulan ini sudah cukup tinggi.';
      } else {
        budgetFill.style.background = '#ffffff';
        budgetPct.style.background = 'rgba(255,255,255,0.2)';
        budgetPct.style.color = '#fff';
        budgetNote.textContent = 'Pengeluaran Anda masih aman terkontrol.';
      }
    } else {
      budgetTextUsed.textContent = formatRupiah(monthExpenseTotal);
      budgetTextLimit.textContent = '/ Tidak ada batas';
      budgetPct.style.display = 'none';
      budgetFill.style.width = '0%';
      budgetFill.style.background = '#ffffff';
      budgetNote.textContent = 'Atur batas bulanan agar lebih terkontrol.';
    }
  }

  function getMonthlyExpenseByCategory(monthKey) {
    var totals = {};
    expenses.forEach(function (item) {
      if (item.type === 'income' || item.type === 'transfer') return;
      if (!item.date || item.date.substring(0, 7) !== monthKey) return;
      var cat = item.category || 'Lainnya (Keluar)';
      totals[cat] = (totals[cat] || 0) + item.amount;
    });
    return totals;
  }

  function renderCategoryBudgetSummary() {
    if (!categoryBudgetList || !categoryBudgetMeta || !categoryBudgetEmpty) return;

    var monthKey = getReportMonthKey();
    var monthCategoryExpense = getMonthlyExpenseByCategory(monthKey);
    var categories = Object.keys(categoryBudgets).filter(function (cat) {
      return Number(categoryBudgets[cat]) > 0;
    });

    categoryBudgetList.innerHTML = '';
    if (!categories.length) {
      categoryBudgetMeta.textContent = 'Belum ada budget kategori aktif.';
      categoryBudgetEmpty.classList.add('visible');
      return;
    }

    categoryBudgetEmpty.classList.remove('visible');
    categoryBudgetMeta.textContent = getMonthLabel(monthKey) + ' • ' + categories.length + ' kategori dipantau';

    categories.sort(function (a, b) {
      var aLimit = Number(categoryBudgets[a]) || 1;
      var bLimit = Number(categoryBudgets[b]) || 1;
      var aPct = ((monthCategoryExpense[a] || 0) / aLimit);
      var bPct = ((monthCategoryExpense[b] || 0) / bLimit);
      return bPct - aPct;
    });

    categories.forEach(function (cat) {
      var limit = Number(categoryBudgets[cat]) || 0;
      var spent = Number(monthCategoryExpense[cat]) || 0;
      var pct = limit > 0 ? Math.min((spent / limit) * 100, 100) : 0;
      var statusClass = pct >= 100 ? 'is-over' : (pct >= 75 ? 'is-warn' : 'is-safe');

      var item = document.createElement('div');
      item.className = 'category-budget-item';
      item.innerHTML =
        '<div class="category-budget-row">' +
          '<div class="category-budget-name">' + (CATEGORY_ICONS[cat] || '<i class="ph-fill ph-tag"></i>') + ' ' + escapeHtml(cat) + '</div>' +
          '<div class="category-budget-amount">' + formatRupiah(spent) + ' / ' + formatRupiah(limit) + ' (' + Math.round(pct) + '%)</div>' +
        '</div>' +
        '<div class="category-budget-track">' +
          '<div class="category-budget-fill ' + statusClass + '" style="width:' + pct.toFixed(2) + '%;"></div>' +
        '</div>';
      categoryBudgetList.appendChild(item);
    });
  }

  function renderCategoryBudgetEditor() {
    if (!categoryBudgetEditor) return;
    var categories = getExpenseCategories();
    if (!categories.length) {
      categoryBudgetEditor.innerHTML = '<p class="category-budget-empty visible">Belum ada kategori pengeluaran yang tersedia.</p>';
      return;
    }

    categoryBudgetEditor.innerHTML = '';
    categories.forEach(function (cat) {
      var val = Number(categoryBudgets[cat]) || 0;
      var row = document.createElement('div');
      row.className = 'category-budget-edit-row';
      var label = document.createElement('label');
      label.className = 'category-budget-edit-label';
      label.innerHTML = (CATEGORY_ICONS[cat] || '<i class="ph-fill ph-tag"></i>') + ' ' + escapeHtml(cat);

      var input = document.createElement('input');
      input.type = 'text';
      input.className = 'category-budget-input';
      input.setAttribute('inputmode', 'numeric');
      input.setAttribute('placeholder', '0 = nonaktif');
      input.dataset.category = cat;
      input.value = val > 0 ? val.toLocaleString('en-US') : '';

      row.appendChild(label);
      row.appendChild(input);
      categoryBudgetEditor.appendChild(row);
    });

    var inputs = categoryBudgetEditor.querySelectorAll('.category-budget-input');
    inputs.forEach(function (input) {
      input.addEventListener('input', formatInputCurrency);
    });
  }

  function openCategoryBudgetModal() {
    if (!categoryBudgetOverlay) return;
    renderCategoryBudgetEditor();
    categoryBudgetOverlay.classList.add('active');
  }

  function closeCategoryBudgetModal() {
    if (!categoryBudgetOverlay) return;
    categoryBudgetOverlay.classList.remove('active');
  }

  function saveCategoryBudgetFromEditor() {
    if (!categoryBudgetEditor) return;
    var inputs = categoryBudgetEditor.querySelectorAll('.category-budget-input');
    var next = {};
    inputs.forEach(function (input) {
      var cat = input.dataset.category;
      var val = Number((input.value || '').replace(/,/g, ''));
      if (cat && val > 0) {
        next[cat] = val;
      }
    });
    categoryBudgets = next;
    saveCategoryBudgets();
    renderCategoryBudgetSummary();
    closeCategoryBudgetModal();
    showToast('Budget per kategori berhasil disimpan', 'success');
  }

  // ─── Get Filtered Data ───────────────────
  function getFilteredData() {
    var selectedSearch = (filterSearch && filterSearch.value ? filterSearch.value : '').trim().toLowerCase();
    var selectedCat = filterCategory.value;
    var selectedMonth = filterMonth.value; // YYYY-MM or ""
    var selectedSort = filterSort.value || 'date-desc';

    var filtered = expenses.filter(function (e) {
      var haystack = [
        e.date || '',
        e.title || '',
        e.category || '',
        e.wallet || '',
        e.walletTo || '',
        e.type || '',
        String(e.amount || ''),
        Number(e.amount || 0).toLocaleString('en-US'),
        Number(e.amount || 0).toLocaleString('id-ID'),
      ].join(' ').toLowerCase();
      var searchMatch = !selectedSearch || haystack.indexOf(selectedSearch) !== -1;
      var catMatch = selectedCat === 'Semua' || e.category === selectedCat;
      var monthMatch = !selectedMonth || e.date.substring(0, 7) === selectedMonth;
      return searchMatch && catMatch && monthMatch;
    });

    filtered.sort(function (a, b) {
      if (selectedSort === 'date-asc') return a.date.localeCompare(b.date);
      if (selectedSort === 'amount-desc') return b.amount - a.amount || b.date.localeCompare(a.date);
      if (selectedSort === 'amount-asc') return a.amount - b.amount || b.date.localeCompare(a.date);
      return b.date.localeCompare(a.date);
    });

    return filtered;
  }

  function setRenderState(message) {
    if (!renderStateEl) return;
    renderStateEl.textContent = message || '';
    renderStateEl.classList.toggle('visible', Boolean(message));
  }

  // ─── Render Table ─────────────────────────
  function renderTableNow() {
    var data = getFilteredData();

    tbody.innerHTML = '';
    updateHero();
    updateTitleSuggestions();
    renderMonthlyReport();
    renderCategoryBudgetSummary();

    if (data.length === 0) {
      emptyState.classList.add('visible');
      updateSummary(data);
      renderChart(data);
      return;
    }

    emptyState.classList.remove('visible');
    var fragment = document.createDocumentFragment();

    data.forEach(function (item, index) {
      var tr = document.createElement('tr');
      if (!isPerfLite) {
        tr.classList.add('row-animate');
        tr.style.animationDelay = (index * 0.04) + 's';
      }
      tr.dataset.id = item.id;

      var isIncome = item.type === 'income';
      var isTransfer = item.type === 'transfer';
      var indicatorHtml = isIncome ? '<span style="color:var(--clr-success)"><i class="ph-bold ph-arrow-down-left"></i> Pemasukan</span>' : 
                          (isTransfer ? '<span style="color:var(--clr-accent)"><i class="ph-bold ph-arrows-left-right"></i> Transfer</span>' :
                          '<span style="color:var(--clr-danger)"><i class="ph-bold ph-arrow-up-right"></i> Pengeluaran</span>');
      
      var walletText = isTransfer ? (escapeHtml(item.wallet || 'Tunai') + ' <i class="ph-bold ph-arrow-right"></i> ' + escapeHtml(item.walletTo || 'Tunai')) : escapeHtml(item.wallet || 'Tunai');
      var categoryContent = isTransfer ? '<i class="ph-fill ph-arrows-left-right"></i> Transfer Dompet' : ((CATEGORY_ICONS[item.category] || '') + ' ' + escapeHtml(item.category));

      tr.innerHTML =
        '<td data-label="Tanggal">' + formatDate(item.date) + '</td>' +
        '<td data-label="Tipe & Nama"><div style="font-weight:600">' + escapeHtml(item.title) + '</div><div style="font-size:0.75rem">' + indicatorHtml + '</div></td>' +
        '<td data-label="Kategori & Dompet"><span class="badge">' + categoryContent + '</span><div style="font-size:0.75rem; margin-top:4px; opacity:0.7;"><i class="ph-fill ph-wallet"></i> ' + walletText + '</div></td>' +
        '<td class="text-right" data-label="Nominal"><span class="amount ' + (isIncome ? 'text-success' : (isTransfer ? 'text-accent' : '')) + '" style="font-weight:600">' + (isIncome ? '+' : (isTransfer ? '' : '-')) + formatRupiah(item.amount) + '</span></td>' +
        '<td class="text-center" data-label="Aksi">' +
          '<div class="action-group">' +
            '<button class="btn btn-sm btn-pin" data-action="pin" data-id="' + item.id + '" title="Pin ke Quick Add"><i class="ph-bold ph-push-pin"></i></button>' +
            '<button class="btn btn-sm btn-edit" data-action="edit" data-id="' + item.id + '" title="Edit"><i class="ph-bold ph-pencil-simple"></i> Edit</button>' +
            '<button class="btn btn-sm btn-delete" data-action="delete" data-id="' + item.id + '" title="Hapus"><i class="ph-bold ph-trash"></i> Hapus</button>' +
          '</div>' +
        '</td>';

      fragment.appendChild(tr);
    });

    tbody.appendChild(fragment);
    updateSummary(data);
    renderChart(data);
    renderTemplateStrip();
    renderCalendar();
  }

  function renderTable() {
    if (renderTimer) {
      clearTimeout(renderTimer);
    }
    setRenderState('Memuat transaksi...');
    renderTimer = setTimeout(function () {
      renderTimer = null;
      renderTableNow();
      setRenderState('');
    }, 0);
  }

  // ─── Title Suggestions (Autocomplete) ─────
  function updateTitleSuggestions() {
    if (!titleSuggestions) return;
    var uniqueTitles = {};
    expenses.forEach(function(e) {
      if (!uniqueTitles[e.title]) {
        uniqueTitles[e.title] = e;
      }
    });
    titleSuggestions.innerHTML = '';
    Object.keys(uniqueTitles).forEach(function(title) {
      var option = document.createElement('option');
      option.value = title;
      titleSuggestions.appendChild(option);
    });
  }

  // ─── Escape HTML ──────────────────────────
  function escapeHtml(str) {
    var div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  // ─── Doughnut Chart ──────────────────────
  function renderChart(data) {
    chartLegend.innerHTML = '';
    chartSlices = [];
    chartGeom = null;
    chartTooltip.classList.remove('visible');

    var hasExpense = data && data.some(function(item) { return item.type === 'expense'; });
    if (!hasExpense) {
      if (categoryChartInstance) {
        categoryChartInstance.destroy();
        categoryChartInstance = null;
      }
      chartEmpty.classList.add('visible');
      chartCanvas.style.display = 'none';
      chartLegend.style.display = 'none';
      return;
    }

    var catTotals = {};
    var total = 0;
    data.forEach(function (item) {
      if (item.type === 'expense') {
        catTotals[item.category] = (catTotals[item.category] || 0) + item.amount;
        total += item.amount;
      }
    });

    var categories = Object.keys(catTotals).sort(function (a, b) {
      return catTotals[b] - catTotals[a];
    });
    var values = categories.map(function (cat) { return catTotals[cat]; });
    var colors = categories.map(function (cat) { return CATEGORY_COLORS[cat] || '#94a3b8'; });

    if (hasChartJs) {
      chartEmpty.classList.remove('visible');
      chartCanvas.style.display = 'block';
      chartLegend.style.display = 'flex';

      categories.forEach(function (cat) {
        var pct = ((catTotals[cat] / total) * 100).toFixed(1);
        var legendItem = document.createElement('div');
        legendItem.className = 'legend-item';
        legendItem.innerHTML =
          '<span class="legend-color" style="background:' + (CATEGORY_COLORS[cat] || '#94a3b8') + '"></span>' +
          '<span class="legend-label">' + (CATEGORY_ICONS[cat] || '') + ' ' + cat + '</span>' +
          '<span class="legend-value">' + pct + '%</span>';
        chartLegend.appendChild(legendItem);
      });

      if (categoryChartInstance) {
        categoryChartInstance.data.labels = categories;
        categoryChartInstance.data.datasets[0].data = values;
        categoryChartInstance.data.datasets[0].backgroundColor = colors;
        categoryChartInstance.update();
        return;
      }

      categoryChartInstance = new window.Chart(chartCanvas, {
        type: 'doughnut',
        data: {
          labels: categories,
          datasets: [{
            data: values,
            backgroundColor: colors,
            borderColor: 'rgba(255,255,255,0.18)',
            borderWidth: 1.5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          cutout: '58%',
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function (ctx) {
                  var amount = Number(ctx.raw || 0);
                  var pct = total > 0 ? ((amount / total) * 100).toFixed(1) : '0.0';
                  return (ctx.label || '-') + ': ' + formatRupiah(amount) + ' (' + pct + '%)';
                }
              }
            }
          }
        }
      });
      return;
    }

    var ctx = chartCanvas.getContext('2d');
    var dpr = window.devicePixelRatio || 1;
    var size = chartCanvas.width / dpr;
    var center = size / 2;
    var outerRadius = center - 10;
    var innerRadius = outerRadius * 0.58;

    ctx.clearRect(0, 0, size, size);
    chartGeom = { center: size / 2, innerRadius: innerRadius, outerRadius: outerRadius };
    chartEmpty.classList.remove('visible');
    chartCanvas.style.display = 'block';
    chartLegend.style.display = 'flex';

    var startAngle = -Math.PI / 2;
    var normalizedStart = 0;
    var gapAngle = 0.03;

    categories.forEach(function (cat) {
      var sliceAngle = (catTotals[cat] / total) * (2 * Math.PI);
      var color = CATEGORY_COLORS[cat] || '#94a3b8';
      var actualGap = categories.length > 1 ? gapAngle : 0;
      var drawStart = startAngle + actualGap / 2;
      var drawEnd = startAngle + sliceAngle - actualGap / 2;

      if (drawEnd > drawStart) {
        ctx.beginPath();
        ctx.arc(center, center, outerRadius, drawStart, drawEnd);
        ctx.arc(center, center, innerRadius, drawEnd, drawStart, true);
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
      }

      startAngle += sliceAngle;
      chartSlices.push({
        category: cat,
        amount: catTotals[cat],
        percent: ((catTotals[cat] / total) * 100),
        start: normalizedStart,
        end: normalizedStart + sliceAngle,
      });
      normalizedStart += sliceAngle;

      var pct = ((catTotals[cat] / total) * 100).toFixed(1);
      var legendItem = document.createElement('div');
      legendItem.className = 'legend-item';
      legendItem.innerHTML =
        '<span class="legend-color" style="background:' + color + '"></span>' +
        '<span class="legend-label">' + (CATEGORY_ICONS[cat] || '') + ' ' + cat + '</span>' +
        '<span class="legend-value">' + pct + '%</span>';
      chartLegend.appendChild(legendItem);
    });

    var theme = getTheme();
    var textColor = theme === 'dark' ? '#e2e8f0' : '#0f172a';
    var textSecondaryColor = theme === 'dark' ? '#94a3b8' : '#64748b';

    ctx.fillStyle = textColor;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = '700 1rem "Plus Jakarta Sans", system-ui, -apple-system, sans-serif';
    ctx.fillText(formatRupiah(total), center, center - 8);

    ctx.font = '500 0.7rem "Plus Jakarta Sans", system-ui, -apple-system, sans-serif';
    ctx.fillStyle = textSecondaryColor;
    ctx.fillText('Total', center, center + 14);
  }

  function hideChartTooltip() {
    chartTooltip.classList.remove('visible');
  }

  function handleChartHoverQueued(e) {
    if (isPerfLite) {
      hideChartTooltip();
      return;
    }
    chartHoverEvent = e;
    if (chartHoverRaf) return;
    chartHoverRaf = requestAnimationFrame(function () {
      chartHoverRaf = null;
      if (!chartHoverEvent) return;
      handleChartHover(chartHoverEvent);
      chartHoverEvent = null;
    });
  }

  function handleChartHover(e) {
    if (!chartSlices.length || !chartGeom) {
      hideChartTooltip();
      return;
    }

    var rect = chartCanvas.getBoundingClientRect();
    var x = (e.clientX - rect.left);
    var y = (e.clientY - rect.top);

    var dx = x - chartGeom.center;
    var dy = y - chartGeom.center;
    var dist = Math.sqrt(dx * dx + dy * dy);

    if (dist < chartGeom.innerRadius || dist > chartGeom.outerRadius) {
      hideChartTooltip();
      return;
    }

    var angle = Math.atan2(dy, dx);
    var normalized = angle + Math.PI / 2;
    if (normalized < 0) normalized += Math.PI * 2;

    var match = null;
    chartSlices.forEach(function (slice) {
      if (normalized >= slice.start && normalized < slice.end) {
        match = slice;
      }
    });

    if (!match) {
      hideChartTooltip();
      return;
    }

    var icon = CATEGORY_ICONS[match.category] || '';
    var pct = match.percent.toFixed(1);
    chartTooltip.innerHTML =
      icon + ' ' + match.category + ' — ' + formatRupiah(match.amount) + ' (' + pct + '%)';

    var containerRect = chartCanvas.parentElement.getBoundingClientRect();
    chartTooltip.style.left = (e.clientX - containerRect.left + 12) + 'px';
    chartTooltip.style.top = (e.clientY - containerRect.top + 12) + 'px';
    chartTooltip.classList.add('visible');
  }

  // ─── Form Validation ─────────────────────
  function validateForm() {
    var valid = true;
    var fields = [inputDate, inputTitle, inputCategory, inputAmount, inputWallet, inputWalletTo];

    fields.forEach(function (field) {
      if (field) field.classList.remove('invalid');
    });

    if (!inputDate.value) {
      inputDate.classList.add('invalid');
      dateHelp.textContent = 'Tanggal wajib diisi';
      valid = false;
    }
    if (inputDate.value && inputDate.value > getTodayString()) {
      inputDate.classList.add('invalid');
      dateHelp.textContent = 'Tanggal tidak boleh di masa depan';
      valid = false;
    }
    if (inputDate.value && inputDate.value <= getTodayString()) {
      dateHelp.textContent = '';
    }
    if (!inputTitle.value.trim()) {
      inputTitle.classList.add('invalid');
      if (titleHelp) titleHelp.textContent = 'Nama transaksi wajib diisi';
      valid = false;
    } else if (inputTitle.value.trim().length < 3) {
      inputTitle.classList.add('invalid');
      if (titleHelp) titleHelp.textContent = 'Minimal 3 karakter';
      valid = false;
    } else if (titleHelp) {
      titleHelp.textContent = '';
    }
    
    var isTransfer = document.querySelector('input[name="input-type"]:checked').value === 'transfer';
    if (!inputWallet.value) {
      inputWallet.classList.add('invalid');
      if (walletHelp) walletHelp.textContent = 'Pilih sumber dana';
      valid = false;
    } else if (walletHelp) {
      walletHelp.textContent = '';
    }

    if (!isTransfer && !inputCategory.value) {
      inputCategory.classList.add('invalid');
      categoryHelp.textContent = 'Kategori wajib diisi';
      valid = false;
    } else {
      categoryHelp.textContent = '';
    }
    
    if (isTransfer) {
      if (!inputWalletTo.value) {
        inputWalletTo.classList.add('invalid');
        if (walletToHelp) walletToHelp.textContent = 'Pilih tujuan dana';
        valid = false;
      } else if (walletToHelp) {
        walletToHelp.textContent = '';
      }
      if (inputWallet.value === inputWalletTo.value) {
        inputWallet.classList.add('invalid');
        inputWalletTo.classList.add('invalid');
        if (walletToHelp) walletToHelp.textContent = 'Dompet asal dan tujuan tidak boleh sama';
        showToast('Dompet asal dan tujuan tidak boleh sama', 'error');
        valid = false;
      }
    } else if (walletToHelp) {
      walletToHelp.textContent = '';
    }
    var rawAmount = inputAmount.value.replace(/,/g, '');
    if (!rawAmount || Number(rawAmount) <= 0) {
      inputAmount.classList.add('invalid');
      amountHelp.textContent = 'Nominal harus lebih dari 0';
      valid = false;
    } else {
      amountHelp.textContent = '';
    }

    return valid;
  }

  // ─── Reset Form ───────────────────────────
  function resetForm() {
    form.reset();
    inputDate.value = getTodayString();
    inputDate.max = getTodayString();
    dateHelp.textContent = '';
    if (titleHelp) titleHelp.textContent = '';
    if (walletHelp) walletHelp.textContent = '';
    if (walletToHelp) walletToHelp.textContent = '';
    categoryHelp.textContent = '';
    amountHelp.textContent = '';
    editingId = null;
    
    // reset type to expense and background to Tunai
    document.querySelector('input[name="input-type"][value="expense"]').checked = true;
    inputWallet.value = 'Tunai';
    inputWalletTo.value = 'Tunai';
    groupWalletTo.style.display = 'none';
    groupCategory.style.display = 'flex';
    labelWallet.textContent = 'Sumber Dana';

    inputRecurring.checked = false;
    document.querySelector('.checkbox-group').style.display = 'flex'; // show when adding

    btnSubmit.disabled = false;
    btnSubmit.classList.remove('is-loading');
    btnSubmit.innerHTML = '<i class="ph-bold ph-plus-circle btn-icon"></i> Simpan';
    btnCancel.style.display = 'none';

    [inputDate, inputTitle, inputCategory, inputAmount, inputWallet, inputWalletTo].forEach(function (f) {
      if (f) f.classList.remove('invalid');
    });
  }

  // ─── Get Today String ────────────────────
  function getTodayString() {
    var d = new Date();
    var mm = String(d.getMonth() + 1).padStart(2, '0');
    var dd = String(d.getDate()).padStart(2, '0');
    return d.getFullYear() + '-' + mm + '-' + dd;
  }

  // ─── Add or Update Expense ───────────────
  function handleSubmit(e) {
    e.preventDefault();

    if (!validateForm()) return;
    if (btnSubmit.disabled) return;

    var submitLabel = btnSubmit.innerHTML;
    var completed = false;
    btnSubmit.disabled = true;
    btnSubmit.classList.add('is-loading');
    btnSubmit.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span> Menyimpan...';

    var selectedType = 'expense';
    for (var i = 0; i < inputTypeRadios.length; i++) {
        if (inputTypeRadios[i].checked) {
            selectedType = inputTypeRadios[i].value;
            break;
        }
    }

    var data = {
      id: editingId || generateId(),
      type: selectedType,
      wallet: inputWallet.value || 'Tunai',
      walletTo: selectedType === 'transfer' ? (inputWalletTo.value || 'Tunai') : undefined,
      date: inputDate.value,
      title: inputTitle.value.trim(),
      category: selectedType === 'transfer' ? 'Transfer' : inputCategory.value,
      amount: Number(inputAmount.value.replace(/,/g, '')),
    };

    try {
      if (editingId) {
        expenses = expenses.map(function (item) {
          return item.id === editingId ? data : item;
        });
        showToast('Transaksi berhasil diperbarui', 'success');
      } else {
        expenses.push(data);
        showToast('Transaksi berhasil ditambahkan', 'success');
        
        // Handle Recurring
        if (inputRecurring && inputRecurring.checked) {
          var nextDateObj = new Date(data.date);
          nextDateObj.setMonth(nextDateObj.getMonth() + 1);
          recurringExpenses.push({
            id: generateId(),
            type: data.type,
            wallet: data.wallet,
            title: data.title,
            category: data.category,
            amount: data.amount,
            nextDate: nextDateObj.toISOString().split('T')[0]
          });
          saveRecurringToStorage();
        }
      }

      saveToStorage();
      renderTable();
      resetForm();
      completed = true;
    } finally {
      if (!completed) {
        btnSubmit.innerHTML = submitLabel;
      }
      btnSubmit.disabled = false;
      btnSubmit.classList.remove('is-loading');
    }
  }

  // ─── Edit Expense ────────────────────────
  function startEdit(id) {
    var item = expenses.find(function (e) {
      return e.id === id;
    });
    if (!item) return;

    editingId = item.id;
    inputDate.value = item.date;
    inputTitle.value = item.title;
    inputCategory.value = item.category;
    inputAmount.value = item.amount.toLocaleString('en-US');

    document.querySelector('.checkbox-group').style.display = 'none'; // hide when editing
    
    // Set wallet
    if (item.wallet) {
      inputWallet.value = item.wallet;
    } else {
      inputWallet.value = 'Tunai';
    }
    
    if (item.type === 'transfer') {
      inputWalletTo.value = item.walletTo || 'Tunai';
      groupWalletTo.style.display = 'flex';
      groupCategory.style.display = 'none';
      labelWallet.textContent = 'Dari Dompet';
    } else {
      groupWalletTo.style.display = 'none';
      groupCategory.style.display = 'flex';
      labelWallet.textContent = 'Sumber Dana';
    }
    
    // Set type
    var typeVal = item.type || 'expense';
    for (var i = 0; i < inputTypeRadios.length; i++) {
        inputTypeRadios[i].checked = (inputTypeRadios[i].value === typeVal);
    }

    btnSubmit.innerHTML = '<i class="ph-bold ph-check btn-icon"></i> Update';
    btnCancel.style.display = 'inline-flex';

    form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    inputTitle.focus();
  }

  // ─── Delete Expense ──────────────────────
  function showDeleteConfirm(id) {
    deleteTargetId = id;
    modalOverlay.classList.add('active');
  }

  function hideDeleteConfirm() {
    deleteTargetId = null;
    modalOverlay.classList.remove('active');
  }

  function confirmDelete() {
    if (!deleteTargetId) return;
    var targetId = deleteTargetId;
    var row = tbody.querySelector('tr[data-id="' + targetId + '"]');
    var deletedItem = expenses.find(function (e) {
      return e.id === targetId;
    });

    hideDeleteConfirm();

    function finalizeDelete() {
      pushUndo(expenses);
      expenses = expenses.filter(function (e) {
        return e.id !== targetId;
      });
      saveToStorage();
      renderTable();

      if (deletedItem) {
        lastDeleted = deletedItem;
        if (undoTimer) clearTimeout(undoTimer);
        undoTimer = setTimeout(function () {
          lastDeleted = null;
        }, 5500);
        showUndoToast('Pengeluaran dihapus', function () {
          if (!lastDeleted) return;
          expenses.push(lastDeleted);
          lastDeleted = null;
          saveToStorage();
          renderTable();
          showToast('Pengeluaran dikembalikan', 'success');
        });
      } else {
        showToast('Pengeluaran berhasil dihapus', 'error');
      }
    }

    if (row) {
      row.classList.add('row-removing');
      setTimeout(finalizeDelete, 180);
    } else {
      finalizeDelete();
    }
  }

  // ─── Table Click Delegation ──────────────
  function handleTableClick(e) {
    var btn = e.target.closest('[data-action]');
    if (!btn) return;

    var action = btn.dataset.action;
    var id = btn.dataset.id;

    if (action === 'edit') {
      startEdit(id);
    } else if (action === 'delete') {
      showDeleteConfirm(id);
    } else if (action === "pin") {
      var item = expenses.find(function(ex) { return ex.id === id; });
      if (item) {
        if (templates.length >= 10) {
          showToast("Maksimal 10 template diperbolehkan.", "error");
          return;
        }
        var newTpl = {
          id: generateId(),
          title: item.title,
          category: item.category,
          amount: item.amount,
          type: item.type,
          wallet: item.wallet
        };
        templates.push(newTpl);
        saveTemplates();
        showToast("Transaksi berhasil di-pin ke Quick Add", "success");
      }

    }
  }

  // ─── Export CSV ──────────────────────────
  function exportCSV() {
    var data = getFilteredData();
    if (data.length === 0) {
      showToast('Tidak ada data untuk diekspor', 'info');
      return;
    }

    var headers = ['Tanggal', 'Nama', 'Kategori', 'Nominal'];
    var rows = data.map(function (item) {
      return [
        item.date,
        '"' + item.title.replace(/"/g, '""') + '"',
        item.category,
        item.amount,
      ].join(',');
    });

    var csv = '\uFEFF' + headers.join(',') + '\n' + rows.join('\n');
    var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    var url = URL.createObjectURL(blob);
    var link = document.createElement('a');
    link.href = url;
    link.download = 'pengeluaran_' + getTodayString() + '.csv';
    link.click();
    URL.revokeObjectURL(url);

    showToast('CSV berhasil diunduh', 'success');
  }

  // ─── Export JSON ─────────────────────────
  function exportJSON() {
    if (!expenses.length) {
      showToast('Tidak ada data untuk diekspor', 'info');
      return;
    }

    var json = JSON.stringify(expenses, null, 2);
    var blob = new Blob([json], { type: 'application/json;charset=utf-8;' });
    var url = URL.createObjectURL(blob);
    var link = document.createElement('a');
    link.href = url;
    link.download = 'pengeluaran_' + getTodayString() + '.json';
    link.click();
    URL.revokeObjectURL(url);

    showToast('JSON berhasil diunduh', 'success');
  }

  // ─── Import JSON ─────────────────────────
  function importJSONFile(file) {
    if (!file) return;
    var reader = new FileReader();
    reader.onload = function (e) {
      try {
        var parsed = JSON.parse(e.target.result);
        if (!Array.isArray(parsed)) {
          showToast('Format JSON tidak valid', 'error');
          return;
        }

        var cleaned = parsed.filter(function (item) {
          return item && item.id && item.date && item.title && item.category && typeof item.amount === 'number';
        });

        pendingImportData = cleaned;
        openImportModal();
      } catch (err) {
        showToast('Gagal membaca file JSON', 'error');
      } finally {
        inputImportJson.value = '';
      }
    };
    reader.readAsText(file);
  }

  function openImportModal() {
    if (!pendingImportData) return;
    importOverlay.classList.add('active');
  }

  function closeImportModal() {
    importOverlay.classList.remove('active');
    pendingImportData = null;
  }

  function openImportSummary(mode, added, skipped) {
    importSummaryMode.textContent = mode;
    importSummaryAdded.textContent = String(added);
    importSummarySkipped.textContent = String(skipped);
    importSummaryOverlay.classList.add('active');
  }

  function closeImportSummary() {
    importSummaryOverlay.classList.remove('active');
  }

  function applyImport() {
    if (!pendingImportData) return;
    var selected = document.querySelector('input[name="import-mode"]:checked');
    var mode = selected ? selected.value : 'replace';

    pushUndo(expenses);

    var added = 0;
    var skipped = 0;

    if (mode === 'replace') {
      expenses = pendingImportData.slice();
      added = expenses.length;
    } else if (mode === 'merge-id') {
      var existing = {};
      expenses.forEach(function (e) { existing[e.id] = true; });
      pendingImportData.forEach(function (item) {
        if (!existing[item.id]) {
          expenses.push(item);
          added += 1;
        } else {
          skipped += 1;
        }
      });
    } else {
      var seen = {};
      function normText(value) {
        return String(value || '')
          .trim()
          .replace(/\s+/g, ' ')
          .toLowerCase();
      }
      function makeKey(item) {
        return [
          item.date,
          normText(item.title),
          item.category,
          item.amount,
        ].join('|');
      }
      expenses.forEach(function (e) {
        seen[makeKey(e)] = true;
      });
      pendingImportData.forEach(function (item) {
        var k = makeKey(item);
        if (!seen[k]) {
          expenses.push(item);
          seen[k] = true;
          added += 1;
        } else {
          skipped += 1;
        }
      });
    }

    saveToStorage();
    renderTable();
    closeImportModal();
    var modeLabel =
      mode === 'replace' ? 'Ganti semua data' :
      mode === 'merge-id' ? 'Gabung (berdasarkan ID)' :
      'Gabung (berdasarkan konten)';
    openImportSummary(modeLabel, added, skipped);
    showUndoStackToast();
  }

  // ─── Reset Filters ──────────────────────
  function resetFilters() {
    if (filterSearch) filterSearch.value = '';
    filterCategory.value = 'Semua';
    filterMonth.value = '';
    filterSort.value = 'date-desc';
    localStorage.removeItem(FILTER_KEY);
    renderTable();
    showToast('Filter direset', 'info');
  }

  function saveFilters() {
    var payload = {
      search: filterSearch ? filterSearch.value : '',
      category: filterCategory.value,
      month: filterMonth.value,
      sort: filterSort.value,
    };
    localStorage.setItem(FILTER_KEY, JSON.stringify(payload));
  }

  function loadFilters() {
    try {
      var raw = localStorage.getItem(FILTER_KEY);
      var saved = raw ? JSON.parse(raw) : null;
      if (saved && typeof saved.search === 'string' && filterSearch) {
        filterSearch.value = saved.search;
      }
      if (saved && saved.category) {
        filterCategory.value = saved.category;
      }
      if (saved && typeof saved.month === 'string') {
        filterMonth.value = saved.month;
      }
      if (saved && typeof saved.sort === 'string') {
        filterSort.value = saved.sort;
      }
    } catch (e) {
      // ignore corrupted filters
    }
  }

  // ─── Event Listeners ─────────────────────
  form.addEventListener('submit', handleSubmit);

  btnCancel.addEventListener('click', function () {
    resetForm();
  });

  tbody.addEventListener('click', handleTableClick);

  if (filterSearch) {
    filterSearch.addEventListener('input', function () {
      saveFilters();
      renderTable();
    });
  }

  filterCategory.addEventListener('change', function () {
    saveFilters();
    renderTable();
  });

  filterMonth.addEventListener('change', function () {
    saveFilters();
    renderTable();
  });

  filterSort.addEventListener('change', function () {
    saveFilters();
    renderTable();
  });

  btnUndo.addEventListener('click', undoLast);

  // New Feature Event Listeners
  if (btnManageWallet) {
    btnManageWallet.addEventListener('click', function() {
      walletOverlay.classList.add('active');
      renderWalletList();
    });
  }

  if (btnCloseWallet) {
    btnCloseWallet.addEventListener('click', function() {
      walletOverlay.classList.remove('active');
    });
  }

  if (btnAddWallet) {
    btnAddWallet.addEventListener('click', function() {
      var name = normalizeWalletName(inputWalletName.value);
      var icon = inputWalletIcon.value;
      if (!name) {
        showToast('Nama dompet harus diisi.', 'error');
        return;
      }
      if (name.length < 2) {
        showToast('Nama dompet minimal 2 karakter.', 'error');
        return;
      }
      if (name.length > 32) {
        showToast('Nama dompet maksimal 32 karakter.', 'error');
        return;
      }
      if (wallets.some(function(w) { return w.name.toLowerCase() === name.toLowerCase(); })) {
        showToast('Nama dompet sudah ada.', 'error');
        return;
      }
      wallets.push({ id: generateId(), name: name, icon: icon });
      saveWallets();
      if (inputWallet) inputWallet.value = name;
      inputWalletName.value = '';
      renderWalletList();
      showToast('Dompet "' + name + '" berhasil ditambah.', 'success');
    });
  }

  if (btnCalPrev) {
    btnCalPrev.addEventListener('click', function() {
      calendarViewDate.setMonth(calendarViewDate.getMonth() - 1);
      renderCalendar();
    });
  }

  if (btnCalNext) {
    btnCalNext.addEventListener('click', function() {
      calendarViewDate.setMonth(calendarViewDate.getMonth() + 1);
      renderCalendar();
    });
  }

  if (btnCalDetailClose) {
    btnCalDetailClose.addEventListener('click', function() {
      calendarDayDetail.style.display = 'none';
    });
  }

  inputDate.addEventListener('input', function () {
    if (!inputDate.value) {
      dateHelp.textContent = 'Tanggal wajib diisi';
      inputDate.classList.add('invalid');
      return;
    }
    if (inputDate.value > getTodayString()) {
      dateHelp.textContent = 'Tanggal tidak boleh di masa depan';
      inputDate.classList.add('invalid');
      return;
    }
    dateHelp.textContent = '';
    inputDate.classList.remove('invalid');
  });

  inputCategory.addEventListener('change', function () {
    if (!inputCategory.value) {
      categoryHelp.textContent = 'Kategori wajib diisi';
      inputCategory.classList.add('invalid');
      return;
    }
    categoryHelp.textContent = '';
    inputCategory.classList.remove('invalid');
  });

  inputAmount.addEventListener('input', function () {
    var rawValue = inputAmount.value.replace(/,/g, '');
    var value = Number(rawValue);
    if (!rawValue || value <= 0) {
      amountHelp.textContent = 'Nominal harus lebih dari 0';
      inputAmount.classList.add('invalid');
      return;
    }
    amountHelp.textContent = '';
    inputAmount.classList.remove('invalid');
  });

  inputTitle.addEventListener('input', function () {
    if (!inputTitle.value.trim()) {
      if (titleHelp) titleHelp.textContent = 'Nama transaksi wajib diisi';
      inputTitle.classList.add('invalid');
      return;
    }
    if (inputTitle.value.trim().length < 3) {
      if (titleHelp) titleHelp.textContent = 'Minimal 3 karakter';
      inputTitle.classList.add('invalid');
      return;
    }
    if (titleHelp) titleHelp.textContent = '';
    inputTitle.classList.remove('invalid');
  });

  inputWallet.addEventListener('change', function () {
    var isTransfer = document.querySelector('input[name="input-type"]:checked').value === 'transfer';
    if (!inputWallet.value) {
      if (walletHelp) walletHelp.textContent = 'Pilih sumber dana';
      inputWallet.classList.add('invalid');
      return;
    }
    if (isTransfer && inputWallet.value === inputWalletTo.value) {
      if (walletToHelp) walletToHelp.textContent = 'Dompet asal dan tujuan tidak boleh sama';
      inputWalletTo.classList.add('invalid');
    } else if (walletToHelp) {
      walletToHelp.textContent = '';
      inputWalletTo.classList.remove('invalid');
    }
    if (walletHelp) walletHelp.textContent = '';
    inputWallet.classList.remove('invalid');
  });

  inputWalletTo.addEventListener('change', function () {
    var isTransfer = document.querySelector('input[name="input-type"]:checked').value === 'transfer';
    if (!isTransfer) {
      if (walletToHelp) walletToHelp.textContent = '';
      inputWalletTo.classList.remove('invalid');
      return;
    }
    if (!inputWalletTo.value) {
      if (walletToHelp) walletToHelp.textContent = 'Pilih tujuan dana';
      inputWalletTo.classList.add('invalid');
      return;
    }
    if (inputWallet.value === inputWalletTo.value) {
      if (walletToHelp) walletToHelp.textContent = 'Dompet asal dan tujuan tidak boleh sama';
      inputWalletTo.classList.add('invalid');
      return;
    }
    if (walletToHelp) walletToHelp.textContent = '';
    inputWalletTo.classList.remove('invalid');
  });

  btnResetFilter.addEventListener('click', resetFilters);
  btnExportCsv.addEventListener('click', exportCSV);
  btnExportJson.addEventListener('click', exportJSON);
  btnImportJson.addEventListener('click', function () {
    inputImportJson.click();
  });
  inputImportJson.addEventListener('change', function (e) {
    var file = e.target.files && e.target.files[0];
    importJSONFile(file);
  });
  btnConfirmImport.addEventListener('click', applyImport);
  btnCancelImport.addEventListener('click', closeImportModal);
  btnCloseImportSummary.addEventListener('click', closeImportSummary);

  btnConfirmDelete.addEventListener('click', confirmDelete);
  btnCancelDelete.addEventListener('click', hideDeleteConfirm);

  btnThemeToggle.addEventListener('click', toggleTheme);
  if (!hasChartJs) {
    chartCanvas.addEventListener('mousemove', handleChartHoverQueued);
    chartCanvas.addEventListener('mouseleave', hideChartTooltip);
  }

  // Close modal on overlay click
  modalOverlay.addEventListener('click', function (e) {
    if (e.target === modalOverlay) {
      hideDeleteConfirm();
    }
  });
  importOverlay.addEventListener('click', function (e) {
    if (e.target === importOverlay) {
      closeImportModal();
    }
  });
  importSummaryOverlay.addEventListener('click', function (e) {
    if (e.target === importSummaryOverlay) {
      closeImportSummary();
    }
  });

  // Close modal on Escape key
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
      hideDeleteConfirm();
    }
    if (e.key === 'Escape' && importOverlay.classList.contains('active')) {
      closeImportModal();
    }
    if (e.key === 'Escape' && importSummaryOverlay.classList.contains('active')) {
      closeImportSummary();
    }
    if (categoryBudgetOverlay && e.key === 'Escape' && categoryBudgetOverlay.classList.contains('active')) {
      closeCategoryBudgetModal();
    }
  });

  // ─── Handle canvas DPI for retina ────────
  function setupCanvas() {
    var displaySize = isPerfLite ? 260 : 320;
    chartCanvas.style.width = displaySize + 'px';
    chartCanvas.style.height = displaySize + 'px';
    if (hasChartJs) {
      chartCanvas.width = displaySize;
      chartCanvas.height = displaySize;
      if (categoryChartInstance) {
        categoryChartInstance.resize();
      }
      return;
    }
    var dpr = window.devicePixelRatio || 1;
    chartCanvas.width = displaySize * dpr;
    chartCanvas.height = displaySize * dpr;
    var ctx = chartCanvas.getContext('2d');
    ctx.scale(dpr, dpr);
  }

  function detectPerfLite(prefersReduced) {
    if (prefersReduced) return true;

    var memory = navigator.deviceMemory || 0;
    var cores = navigator.hardwareConcurrency || 0;
    var conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    var saveData = conn && conn.saveData;
    var effectiveType = conn && conn.effectiveType ? String(conn.effectiveType) : '';
    var slowNetwork = effectiveType.indexOf('2g') !== -1;
    var coarsePointer = window.matchMedia && window.matchMedia('(pointer: coarse)').matches;

    if (saveData || slowNetwork) return true;
    if (memory && memory <= 4) return true;
    if (cores && cores <= 4) return true;
    if (coarsePointer && cores && cores <= 6) return true;
    return false;
  }

  function applyPerformanceMode(enabled) {
    document.documentElement.classList.toggle('perf-lite', enabled);
    document.body.classList.toggle('perf-lite', enabled);
  }

  function initVisualEffects() {
    var prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    isPerfLite = detectPerfLite(prefersReduced);
    applyPerformanceMode(isPerfLite);
    setupCanvas();
    setupScrollReveal(prefersReduced || isPerfLite);
    setupCardGlow(prefersReduced || isPerfLite);
    setupHeroTilt(prefersReduced || isPerfLite);
  }

  function setupScrollReveal(prefersReduced) {
    var sections = document.querySelectorAll('.container > section');
    if (!sections || sections.length === 0) return;
    if (prefersReduced || !('IntersectionObserver' in window)) return;

    var viewport = window.innerHeight || document.documentElement.clientHeight;
    sections.forEach(function (section) {
      var rect = section.getBoundingClientRect();
      if (rect.top <= viewport * 0.9) return;
      section.classList.add('reveal-ready');
    });

    var observer = new IntersectionObserver(function (entries) {
      entries.forEach(function (entry) {
        if (!entry.isIntersecting) return;
        entry.target.classList.add('revealed');
        observer.unobserve(entry.target);
      });
    }, {
      threshold: 0.18,
      rootMargin: '0px 0px -8% 0px'
    });

    sections.forEach(function (section) {
      if (section.classList.contains('reveal-ready')) {
        observer.observe(section);
      }
    });
  }

  function setupCardGlow(prefersReduced) {
    if (prefersReduced) return;
    if (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) return;

    var cards = document.querySelectorAll('.card');
    cards.forEach(function (card) {
      var frame = null;
      var nextX = 50;
      var nextY = 50;

      card.addEventListener('pointermove', function (e) {
        var rect = card.getBoundingClientRect();
        if (!rect.width || !rect.height) return;
        nextX = ((e.clientX - rect.left) / rect.width) * 100;
        nextY = ((e.clientY - rect.top) / rect.height) * 100;
        if (!frame) {
          frame = requestAnimationFrame(function () {
            frame = null;
            card.style.setProperty('--mx', nextX.toFixed(2) + '%');
            card.style.setProperty('--my', nextY.toFixed(2) + '%');
          });
        }
        card.classList.add('card-glow');
      });

      card.addEventListener('pointerleave', function () {
        if (frame) {
          cancelAnimationFrame(frame);
          frame = null;
        }
        card.classList.remove('card-glow');
        card.style.setProperty('--mx', '50%');
        card.style.setProperty('--my', '50%');
      });
    });
  }

  function setupHeroTilt(prefersReduced) {
    if (prefersReduced) return;
    if (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) return;

    var hero = document.querySelector('.hero-card');
    if (!hero) return;
    var frame = null;
    var next = { x: 0, y: 0, mx: 50, my: 50 };

    hero.addEventListener('pointermove', function (e) {
      var rect = hero.getBoundingClientRect();
      if (!rect.width || !rect.height) return;

      var px = (e.clientX - rect.left) / rect.width;
      var py = (e.clientY - rect.top) / rect.height;
      next.x = (0.5 - py) * 8;
      next.y = (px - 0.5) * 12;
      next.mx = px * 100;
      next.my = py * 100;

      if (!frame) {
        frame = requestAnimationFrame(function () {
          frame = null;
          hero.style.setProperty('--hero-tilt-x', next.x.toFixed(2) + 'deg');
          hero.style.setProperty('--hero-tilt-y', next.y.toFixed(2) + 'deg');
          hero.style.setProperty('--hero-mx', next.mx.toFixed(2) + '%');
          hero.style.setProperty('--hero-my', next.my.toFixed(2) + '%');
        });
      }
    });

    hero.addEventListener('pointerleave', function () {
      if (frame) {
        cancelAnimationFrame(frame);
        frame = null;
      }
      hero.style.setProperty('--hero-tilt-x', '0deg');
      hero.style.setProperty('--hero-tilt-y', '0deg');
      hero.style.setProperty('--hero-mx', '50%');
      hero.style.setProperty('--hero-my', '50%');
    });
  }

  // ═══════════════════════════════════════════
  //  SPLIT BILL MODULE
  // ═══════════════════════════════════════════
  var splitOverlay = document.getElementById('split-overlay');
  var btnOpenSplit = document.getElementById('btn-open-split');
  var btnCloseSplit = document.getElementById('btn-close-split');
  var splitTitleEl = document.getElementById('split-title');
  var splitBillName = document.getElementById('split-bill-name');
  var splitTotal = document.getElementById('split-total');
  var splitOwnerName = document.getElementById('split-owner-name');
  var splitPayer = document.getElementById('split-payer');
  var modeEqual = document.getElementById('mode-equal');
  var modeCustom = document.getElementById('mode-custom');
  var splitPersonList = document.getElementById('split-person-list');
  var btnAddPerson = document.getElementById('btn-add-person');
  var btnCalculateSplit = document.getElementById('btn-calculate-split');
  var splitFormView = document.getElementById('split-form-view');
  var splitResultsView = document.getElementById('split-results-view');
  var splitResultSummary = document.getElementById('split-result-summary');
  var splitResultList = document.getElementById('split-result-list');
  var btnSaveSplit = document.getElementById('btn-save-split');
  var btnBackSplit = document.getElementById('btn-back-split');
  var splitHistoryList = document.getElementById('split-history-list');

  var splitMode = 'equal'; // 'equal' or 'custom'
  var splitResults = null;
  var splitLedger = [];
  var splitPersonIdCounter = 0;
  var splitEditingId = null;
  var splitEditingDate = null;

  var AVATAR_COLORS = [
    '#6366f1', '#ec4899', '#f97316', '#10b981',
    '#3b82f6', '#8b5cf6', '#ef4444', '#06b6d4',
    '#f59e0b', '#14b8a6', '#e11d48', '#7c3aed',
  ];

  // ─── Open / Close Split Modal ─────────────
  function updateSplitModalHeader() {
    if (!splitTitleEl || !btnSaveSplit) return;
    if (splitEditingId) {
      splitTitleEl.innerHTML = '<i class="ph-bold ph-pencil-simple"></i> Edit Split Bill';
      btnSaveSplit.innerHTML = '<i class="ph-bold ph-check-circle"></i> Update Ledger Split';
    } else {
      splitTitleEl.innerHTML = '<i class="ph-bold ph-receipt"></i> Split Bill';
      btnSaveSplit.innerHTML = '<i class="ph-bold ph-floppy-disk"></i> Simpan ke Ledger Split';
    }
  }

  function applySplitMode(mode) {
    splitMode = mode === 'custom' ? 'custom' : 'equal';
    if (splitMode === 'equal') {
      modeEqual.classList.add('active');
      modeCustom.classList.remove('active');
    } else {
      modeCustom.classList.add('active');
      modeEqual.classList.remove('active');
    }
    updateCustomAmountVisibility();
  }

  function setSplitPayerByName(name) {
    if (!splitPayer) return;
    var target = normalizePersonName(name);
    if (!target) return;
    var rows = splitPersonList.querySelectorAll('.split-person-row');
    for (var i = 0; i < rows.length; i++) {
      if (normalizePersonName(getSplitParticipantLabel(rows[i], i)) === target) {
        splitPayer.value = rows[i].dataset.personId || '';
        return;
      }
    }
  }

  function openSplitModal() {
    splitEditingId = null;
    splitEditingDate = null;
    splitResults = null;
    updateSplitModalHeader();
    splitOverlay.classList.add('active');
    splitFormView.style.display = 'block';
    splitResultsView.style.display = 'none';
    resetSplitForm();
    renderSplitHistory();
  }

  function closeSplitModal() {
    splitOverlay.classList.remove('active');
  }

  function resetSplitForm() {
    splitBillName.value = '';
    splitTotal.value = '';
    if (splitOwnerName) {
      splitOwnerName.value = userProfile.name || '';
      splitOwnerName.classList.remove('invalid');
    }
    splitResults = null;
    splitPersonIdCounter = 0;
    applySplitMode('equal');
    splitPersonList.innerHTML = '';
    // Add 2 default persons
    addPersonRow((userProfile.name || '').trim());
    addPersonRow('');
    syncSplitPayerOptions();
  }

  function startEditSplit(splitId) {
    var entry = splitLedger.find(function (item) { return item.id === splitId; });
    if (!entry) {
      showToast('Data split tidak ditemukan', 'error');
      return;
    }

    splitEditingId = entry.id;
    splitEditingDate = entry.date || getTodayString();
    splitResults = null;
    updateSplitModalHeader();

    splitOverlay.classList.add('active');
    splitFormView.style.display = 'block';
    splitResultsView.style.display = 'none';

    splitBillName.value = entry.billName || '';
    splitTotal.value = Number(entry.total || 0).toLocaleString('en-US');
    if (splitOwnerName) {
      splitOwnerName.value = entry.ownerName || userProfile.name || '';
      splitOwnerName.classList.remove('invalid');
    }

    splitPersonIdCounter = 0;
    splitPersonList.innerHTML = '';
    applySplitMode(entry.mode === 'custom' ? 'custom' : 'equal');

    var people = Array.isArray(entry.people) ? entry.people : [];
    if (people.length === 0) {
      addPersonRow((entry.ownerName || userProfile.name || '').trim());
      addPersonRow('');
    } else {
      people.forEach(function (p) {
        var row = addPersonRow(p.name || '');
        if (row && splitMode === 'custom') {
          var customField = row.querySelector('.custom-amount');
          if (customField) customField.value = Number(p.share || 0).toLocaleString('en-US');
        }
      });
      if (people.length === 1) {
        addPersonRow('');
      }
    }

    syncSplitPayerOptions();
    setSplitPayerByName(entry.payerName || '');
    renderSplitHistory();
  }

  // ─── Person Rows ──────────────────────────
  function addPersonRow(name) {
    var personId = 'p-' + (++splitPersonIdCounter);
    var row = document.createElement('div');
    row.className = 'split-person-row';
    row.dataset.personId = personId;
    row.innerHTML =
      '<input type="text" class="person-name-input" placeholder="Nama peserta" value="' + escapeHtml(name || '') + '" />' +
      '<input type="text" class="custom-amount' + (splitMode === 'custom' ? ' visible' : '') + '" placeholder="Nominal" inputmode="numeric" />' +
      '<button class="btn-remove-person" title="Hapus" type="button">×</button>';

    // Remove button
    row.querySelector('.btn-remove-person').addEventListener('click', function () {
      if (splitPersonList.children.length > 2) {
        row.remove();
        syncSplitPayerOptions();
      } else {
        showToast('Minimal 2 peserta', 'error');
      }
    });

    splitPersonList.appendChild(row);
    syncSplitPayerOptions();
    return row;
  }

  function getSplitParticipantLabel(row, index) {
    var nameInput = row.querySelector('.person-name-input');
    var name = nameInput ? nameInput.value.trim() : '';
    return name || ('Peserta ' + (index + 1));
  }

  function syncSplitPayerOptions() {
    if (!splitPayer) return;

    var rows = splitPersonList.querySelectorAll('.split-person-row');
    var prevPayerId = splitPayer.value;
    var hasPrev = false;
    var firstId = '';
    splitPayer.innerHTML = '';

    rows.forEach(function (row, i) {
      var personId = row.dataset.personId || ('p-auto-' + i);
      row.dataset.personId = personId;

      var opt = document.createElement('option');
      opt.value = personId;
      opt.textContent = getSplitParticipantLabel(row, i);
      splitPayer.appendChild(opt);

      if (!firstId) firstId = personId;
      if (personId === prevPayerId) hasPrev = true;
    });

    if (!firstId) return;
    splitPayer.value = hasPrev ? prevPayerId : firstId;
  }

  function getOwnerSettlementDescriptor(net) {
    if (net > 0) {
      return { key: 'receive', text: 'Teman harus bayar saya ' + formatRupiah(net) };
    }
    if (net < 0) {
      return { key: 'pay', text: 'Saya harus bayar ' + formatRupiah(Math.abs(net)) };
    }
    return { key: 'even', text: 'Lunas' };
  }

  function getOwnerSettlement(ownerName, results) {
    var ownerKey = normalizePersonName(ownerName);
    if (!ownerKey) return null;

    var owner = null;
    results.forEach(function (p) {
      if (!owner && normalizePersonName(p.name) === ownerKey) {
        owner = p;
      }
    });
    if (!owner) return null;

    var status = getOwnerSettlementDescriptor(owner.net);
    return {
      id: owner.id,
      name: owner.name,
      share: owner.share,
      paid: owner.paid,
      net: owner.net,
      statusKey: status.key,
      statusText: status.text,
    };
  }

  function persistProfileNameFromSplit() {
    if (!splitOwnerName) return;
    var nextName = splitOwnerName.value.trim();
    if (!nextName) return;
    userProfile.name = nextName;
    saveProfileToStorage();
  }

  function updateCustomAmountVisibility() {
    var fields = splitPersonList.querySelectorAll('.custom-amount');
    fields.forEach(function (f) {
      if (splitMode === 'custom') {
        f.classList.add('visible');
      } else {
        f.classList.remove('visible');
      }
    });
  }

  // ─── Split Mode Toggle ────────────────────
  function setSplitMode(mode) {
    applySplitMode(mode);
  }

  // ─── Calculate Split ──────────────────────
  function calculateSplit() {
    syncSplitPayerOptions();
    persistProfileNameFromSplit();

    var ownerNameInput = (splitOwnerName && splitOwnerName.value ? splitOwnerName.value : '').trim();
    if (!ownerNameInput) {
      if (splitOwnerName) splitOwnerName.classList.add('invalid');
      showToast('Isi Nama Saya untuk tracking split bill', 'error');
      return;
    }
    if (splitOwnerName) splitOwnerName.classList.remove('invalid');

    var billName = splitBillName.value.trim() || 'Split Bill';
    var totalText = splitTotal.value.replace(/,/g, '');
    var total = Number(totalText);

    if (!total || total <= 0) {
      splitTotal.classList.add('invalid');
      showToast('Masukkan total tagihan', 'error');
      return;
    }
    splitTotal.classList.remove('invalid');

    var rows = splitPersonList.querySelectorAll('.split-person-row');
    var people = [];

    rows.forEach(function (row, i) {
      var personId = row.dataset.personId || ('p-' + (i + 1));
      row.dataset.personId = personId;
      var nameInput = row.querySelector('.person-name-input');
      var name = nameInput.value.trim() || 'Peserta ' + (i + 1);
      var customAmt = 0;

      if (splitMode === 'custom') {
        var customAmtText = row.querySelector('.custom-amount').value.replace(/,/g, '');
        customAmt = Number(customAmtText) || 0;
      }

      people.push({ id: personId, name: name, customAmount: customAmt });
    });

    if (people.length < 2) {
      showToast('Minimal 2 peserta', 'error');
      return;
    }

    var payerId = splitPayer && splitPayer.value ? splitPayer.value : people[0].id;
    var payer = people.find(function (p) { return p.id === payerId; }) || people[0];
    payerId = payer.id;

    // Calculate shares
    var results = [];
    if (splitMode === 'equal') {
      var share = Math.round(total / people.length);
      var remainder = total - (share * people.length);
      people.forEach(function (p, i) {
        results.push({
          id: p.id,
          name: p.name,
          share: share + (i === 0 ? remainder : 0),
        });
      });
    } else {
      // Custom mode: validate totals
      var customTotal = people.reduce(function (s, p) { return s + p.customAmount; }, 0);
      if (customTotal !== total) {
        showToast('Total custom (Rp ' + customTotal.toLocaleString('en-US') + ') tidak sama dengan tagihan (Rp ' + total.toLocaleString('en-US') + ')', 'error');
        return;
      }
      people.forEach(function (p) {
        results.push({ id: p.id, name: p.name, share: p.customAmount });
      });
    }

    results = results.map(function (p) {
      var paid = p.id === payerId ? total : 0;
      return {
        id: p.id,
        name: p.name,
        share: p.share,
        paid: paid,
        net: paid - p.share,
      };
    });

    var ownerSettlement = getOwnerSettlement(ownerNameInput, results);
    if (!ownerSettlement) {
      showToast('Nama Saya harus ada di daftar peserta', 'error');
      return;
    }

    splitResults = {
      billName: billName,
      total: total,
      mode: splitMode,
      payerId: payerId,
      payerName: payer.name,
      ownerId: ownerSettlement.id,
      ownerName: ownerSettlement.name,
      ownerShare: ownerSettlement.share,
      ownerPaid: ownerSettlement.paid,
      ownerNet: ownerSettlement.net,
      ownerStatusKey: ownerSettlement.statusKey,
      ownerStatusText: ownerSettlement.statusText,
      people: results,
      date: splitEditingDate || getTodayString(),
    };

    showSplitResults();
  }

  // ─── Show Results ─────────────────────────
  function showSplitResults() {
    splitFormView.style.display = 'none';
    splitResultsView.style.display = 'block';

    splitResultSummary.innerHTML =
      '<div class="result-bill-name">' + escapeHtml(splitResults.billName) + '</div>' +
      '<div class="result-total">' + formatRupiah(splitResults.total) + '</div>' +
      '<div class="result-people-count">' + splitResults.people.length + ' peserta • ' +
        (splitResults.mode === 'equal' ? '<i class="ph-bold ph-scales"></i> Bagi Rata' : '<i class="ph-bold ph-pencil-simple"></i> Custom') + '</div>' +
      '<div class="result-payer">Dibayar oleh: ' + escapeHtml(splitResults.payerName) + '</div>' +
      '<div class="result-owner-status">Status Saya (' + escapeHtml(splitResults.ownerName) + '): ' + escapeHtml(splitResults.ownerStatusText) + '</div>';

    splitResultList.innerHTML = '';
    splitResults.people.forEach(function (p, i) {
      var color = AVATAR_COLORS[i % AVATAR_COLORS.length];
      var initials = p.name.split(' ').map(function (w) { return w[0]; }).slice(0, 2).join('').toUpperCase();
      var settlementText = 'Lunas';
      var settlementClass = 'even';
      if (p.net > 0) {
        settlementText = 'Harus terima ' + formatRupiah(p.net);
        settlementClass = 'receive';
      } else if (p.net < 0) {
        settlementText = 'Harus bayar ' + formatRupiah(Math.abs(p.net));
        settlementClass = 'pay';
      }

      var item = document.createElement('div');
      item.className = 'split-result-item';
      item.style.animationDelay = (i * 0.06) + 's';
      item.innerHTML =
        '<div class="person-info">' +
          '<div class="person-avatar" style="background:' + color + '">' + initials + '</div>' +
          '<div class="person-text">' +
            '<span class="person-name">' + escapeHtml(p.name) + (p.id === splitResults.payerId ? ' (Pembayar)' : '') + (p.id === splitResults.ownerId ? ' (Saya)' : '') + '</span>' +
            '<span class="person-detail">Bayar: ' + formatRupiah(p.paid) + '</span>' +
          '</div>' +
        '</div>' +
        '<div class="person-result">' +
          '<span class="person-share">Porsi: ' + formatRupiah(p.share) + '</span>' +
          '<span class="person-settlement ' + settlementClass + '">' + settlementText + '</span>' +
        '</div>';

      splitResultList.appendChild(item);
    });
  }

  // ─── Save Split to Ledger ──────────────────
  function saveSplitToLedger() {
    if (!splitResults) return;

    var historyEntry = {
      id: splitEditingId || generateId(),
      date: splitResults.date,
      billName: splitResults.billName,
      total: splitResults.total,
      people: splitResults.people,
      mode: splitResults.mode,
      payerId: splitResults.payerId,
      payerName: splitResults.payerName,
      ownerId: splitResults.ownerId,
      ownerName: splitResults.ownerName,
      ownerShare: splitResults.ownerShare,
      ownerPaid: splitResults.ownerPaid,
      ownerNet: splitResults.ownerNet,
      ownerStatusKey: splitResults.ownerStatusKey,
      ownerStatusText: splitResults.ownerStatusText,
      syncedExpenseId: null,
      syncedAt: null,
      isDone: false,
      doneAt: null,
    };

    if (splitEditingId) {
      var editIndex = splitLedger.findIndex(function (item) {
        return item.id === splitEditingId;
      });

      if (editIndex !== -1) {
        var prevEntry = splitLedger[editIndex];
        historyEntry.syncedExpenseId = prevEntry.syncedExpenseId || null;
        historyEntry.syncedAt = prevEntry.syncedAt || null;
        historyEntry.isDone = Boolean(prevEntry.isDone);
        historyEntry.doneAt = prevEntry.doneAt || null;

        if (historyEntry.syncedExpenseId) {
          var expenseIndex = expenses.findIndex(function (item) {
            return item.id === historyEntry.syncedExpenseId;
          });

          if (expenseIndex !== -1) {
            if (Number(historyEntry.ownerShare) > 0) {
              expenses[expenseIndex] = {
                id: historyEntry.syncedExpenseId,
                type: 'expense',
                wallet: expenses[expenseIndex].wallet || 'Tunai',
                date: historyEntry.date || getTodayString(),
                title: 'Split Bill: ' + historyEntry.billName + ' (' + historyEntry.ownerName + ')',
                category: 'Makanan',
                amount: Number(historyEntry.ownerShare),
                splitLedgerId: historyEntry.id,
              };
              historyEntry.syncedAt = getTodayString();
            } else {
              expenses.splice(expenseIndex, 1);
              historyEntry.syncedExpenseId = null;
              historyEntry.syncedAt = null;
            }
            saveToStorage();
            renderTable();
          } else {
            historyEntry.syncedExpenseId = null;
            historyEntry.syncedAt = null;
          }
        }

        splitLedger[editIndex] = historyEntry;
        localStorage.setItem(SPLIT_LEDGER_KEY, JSON.stringify(splitLedger));
        renderSplitHistory();
        renderSplitLedgerTable();
        showToast('Split bill berhasil diperbarui', 'success');
        splitEditingId = null;
        splitEditingDate = null;
        splitResults = null;
        updateSplitModalHeader();
        closeSplitModal();
        return;
      }
    }

    splitLedger.unshift(historyEntry);
    if (splitLedger.length > 100) splitLedger = splitLedger.slice(0, 100);
    localStorage.setItem(SPLIT_LEDGER_KEY, JSON.stringify(splitLedger));

    renderSplitHistory();
    renderSplitLedgerTable();
    showToast('Split bill disimpan ke ledger. Sync ke pengeluaran bersifat opsional.', 'success');
    splitEditingId = null;
    splitEditingDate = null;
    splitResults = null;
    updateSplitModalHeader();
    closeSplitModal();
  }

  function markSplitLedgerDone(splitId) {
    var entryIndex = splitLedger.findIndex(function (item) {
      return item.id === splitId;
    });

    if (entryIndex === -1) {
      showToast('Data split tidak ditemukan', 'error');
      return;
    }

    if (splitLedger[entryIndex].isDone) {
      showToast('Split bill ini sudah selesai', 'info');
      return;
    }

    splitLedger[entryIndex].isDone = true;
    splitLedger[entryIndex].doneAt = getTodayString();
    localStorage.setItem(SPLIT_LEDGER_KEY, JSON.stringify(splitLedger));

    renderSplitHistory();
    renderSplitLedgerTable();
    showToast('Split bill ditandai selesai', 'success');
  }

  function deleteSplitLedgerEntry(splitId) {
    var entryIndex = splitLedger.findIndex(function (item) {
      return item.id === splitId;
    });

    if (entryIndex === -1) {
      showToast('Data split tidak ditemukan', 'error');
      return;
    }

    var deletedEntry = splitLedger.splice(entryIndex, 1)[0];
    localStorage.setItem(SPLIT_LEDGER_KEY, JSON.stringify(splitLedger));

    if (splitEditingId === splitId) {
      splitEditingId = null;
      splitEditingDate = null;
      splitResults = null;
      updateSplitModalHeader();
    }

    renderSplitHistory();
    renderSplitLedgerTable();
    showToast('Split bill "' + (deletedEntry.billName || 'Tanpa nama') + '" dihapus', 'info');
  }

  function syncSplitLedgerToExpense(splitId) {
    var entry = splitLedger.find(function (item) { return item.id === splitId; });
    if (!entry) {
      showToast('Data split tidak ditemukan', 'error');
      return;
    }
    if (entry.syncedExpenseId) {
      showToast('Split ini sudah tersinkron ke pengeluaran', 'info');
      return;
    }
    if (!entry.ownerShare || Number(entry.ownerShare) <= 0) {
      showToast('Porsi Anda tidak valid untuk disinkron', 'error');
      return;
    }

    pushUndo(expenses);

    var expense = {
      id: generateId(),
      type: 'expense',
      wallet: 'Tunai',
      date: entry.date || getTodayString(),
      title: 'Split Bill: ' + entry.billName + ' (' + entry.ownerName + ')',
      category: 'Makanan',
      amount: Number(entry.ownerShare),
      splitLedgerId: entry.id,
    };
    expenses.push(expense);
    saveToStorage();
    renderTable();

    entry.syncedExpenseId = expense.id;
    entry.syncedAt = getTodayString();
    localStorage.setItem(SPLIT_LEDGER_KEY, JSON.stringify(splitLedger));
    renderSplitHistory();
    renderSplitLedgerTable();
    showToast('Porsi Anda berhasil disinkron ke pengeluaran', 'success');
  }

  // ─── Split History ────────────────────────
  function loadSplitHistory() {
    try {
      var raw = localStorage.getItem(SPLIT_LEDGER_KEY);
      var parsed = raw ? JSON.parse(raw) : [];
      splitLedger = Array.isArray(parsed) ? parsed : [];

      splitLedger = splitLedger
        .filter(function (entry) {
          return entry && entry.id && entry.billName && Number(entry.total || 0) > 0;
        })
        .map(function (entry) {
          var people = Array.isArray(entry.people) ? entry.people : [];
          var ownerName = (entry.ownerName || '').trim();
          var ownerShare = Number(entry.ownerShare);
          var ownerPaid = Number(entry.ownerPaid);
          var ownerNet = Number(entry.ownerNet);

          if (!ownerName && userProfile.name) {
            var byProfile = people.find(function (p) {
              return normalizePersonName(p.name) === normalizePersonName(userProfile.name);
            });
            if (byProfile) ownerName = byProfile.name;
          }
          if (!ownerName && people.length) ownerName = people[0].name;

          var ownerEntry = people.find(function (p) {
            return normalizePersonName(p.name) === normalizePersonName(ownerName);
          });

          if (!Number.isFinite(ownerShare) && ownerEntry) ownerShare = Number(ownerEntry.share) || 0;
          if (!Number.isFinite(ownerPaid) && ownerEntry) ownerPaid = Number(ownerEntry.paid) || 0;
          if (!Number.isFinite(ownerNet) && ownerEntry) {
            ownerNet = Number(ownerEntry.net);
            if (!Number.isFinite(ownerNet)) ownerNet = ownerPaid - ownerShare;
          }

          ownerShare = Number.isFinite(ownerShare) ? ownerShare : 0;
          ownerPaid = Number.isFinite(ownerPaid) ? ownerPaid : 0;
          ownerNet = Number.isFinite(ownerNet) ? ownerNet : (ownerPaid - ownerShare);
          var isDone = Boolean(entry.isDone);
          var doneAt = entry.doneAt || null;
          if (isDone && !doneAt) doneAt = entry.date || getTodayString();

          var ownerStatus = getOwnerSettlementDescriptor(ownerNet);

          return {
            id: entry.id,
            date: entry.date || getTodayString(),
            billName: entry.billName || 'Split Bill',
            total: Number(entry.total) || 0,
            people: people,
            mode: entry.mode || 'equal',
            payerId: entry.payerId || '',
            payerName: entry.payerName || '',
            ownerId: entry.ownerId || '',
            ownerName: ownerName,
            ownerShare: ownerShare,
            ownerPaid: ownerPaid,
            ownerNet: ownerNet,
            ownerStatusKey: entry.ownerStatusKey || ownerStatus.key,
            ownerStatusText: entry.ownerStatusText || ownerStatus.text,
            syncedExpenseId: entry.syncedExpenseId || null,
            syncedAt: entry.syncedAt || null,
            isDone: isDone,
            doneAt: doneAt,
          };
        });

      localStorage.setItem(SPLIT_LEDGER_KEY, JSON.stringify(splitLedger));
    } catch (e) {
      splitLedger = [];
    }
  }

  function renderSplitHistory() {
    splitHistoryList.innerHTML = '';

    if (splitLedger.length === 0) {
      splitHistoryList.innerHTML = '<p class="split-history-empty">Belum ada riwayat split</p>';
      return;
    }

    splitLedger.slice(0, 12).forEach(function (entry) {
      var payerText = entry.payerName ? (' • Dibayar: ' + escapeHtml(entry.payerName)) : '';
      var ownerText = entry.ownerName ? (' • Saya: ' + escapeHtml(entry.ownerName)) : '';
      var item = document.createElement('div');
      item.className = 'split-history-item';
      item.innerHTML =
        '<div>' +
          '<div class="hist-name">' + escapeHtml(entry.billName) + '</div>' +
          '<div class="hist-meta">' + formatDate(entry.date) + ' • ' + entry.people.length + ' peserta' + payerText + ownerText + '</div>' +
        '</div>' +
        '<span class="hist-amount">' + formatRupiah(entry.total) + '</span>';
      splitHistoryList.appendChild(item);
    });
  }

  function renderSplitLedgerTable() {
    if (!splitLedgerTbody || !splitLedgerEmpty) return;

    splitLedgerTbody.innerHTML = '';
    if (splitLedger.length === 0) {
      splitLedgerEmpty.classList.add('visible');
      return;
    }

    splitLedgerEmpty.classList.remove('visible');
    var fragment = document.createDocumentFragment();

    splitLedger.forEach(function (entry) {
      var tr = document.createElement('tr');
      var statusKey = entry.ownerStatusKey || 'even';
      var statusText = entry.ownerStatusText || 'Status belum tersedia';
      var isDone = Boolean(entry.isDone);
      var doneText = isDone
        ? ('Selesai' + (entry.doneAt ? (' • ' + formatDate(entry.doneAt)) : ''))
        : statusText;
      var doneClass = isDone ? 'done' : statusKey;
      var syncDone = Boolean(entry.syncedExpenseId);
      var syncClass = syncDone ? 'synced' : 'pending';
      var syncText = syncDone
        ? ('Tersinkron' + (entry.syncedAt ? (' • ' + formatDate(entry.syncedAt)) : ''))
        : 'Belum sync';

      var syncButton = '';
      if (syncDone) {
        syncButton = '<button class="btn btn-sm btn-ghost" type="button" disabled><i class="ph-bold ph-check-circle"></i> Tersinkron</button>';
      } else if (Number(entry.ownerShare) > 0) {
        syncButton = '<button class="btn btn-sm btn-primary" type="button" data-split-action="sync" data-id="' + entry.id + '"><i class="ph-bold ph-arrows-clockwise"></i> Sync</button>';
      } else {
        syncButton = '<button class="btn btn-sm btn-ghost" type="button" disabled>Tidak ada porsi</button>';
      }

      var doneButton = isDone
        ? '<button class="btn btn-sm btn-ghost" type="button" disabled><i class="ph-bold ph-check"></i> Selesai</button>'
        : '<button class="btn btn-sm btn-ghost" type="button" data-split-action="done" data-id="' + entry.id + '"><i class="ph-bold ph-check-circle"></i> Mark Done</button>';

      var deleteButton = '<button class="btn btn-sm btn-delete" type="button" data-split-action="delete" data-id="' + entry.id + '"><i class="ph-bold ph-trash"></i> Hapus</button>';

      var actionHtml =
        '<div class="action-group">' +
          '<button class="btn btn-sm btn-edit" type="button" data-split-action="edit" data-id="' + entry.id + '"><i class="ph-bold ph-pencil-simple"></i> Edit</button>' +
          doneButton +
          syncButton +
          deleteButton +
        '</div>';

      tr.innerHTML =
        '<td data-label="Tanggal">' + formatDate(entry.date) + '</td>' +
        '<td data-label="Bill"><div style="font-weight:700">' + escapeHtml(entry.billName) + '</div>' +
          '<div style="font-size:0.78rem; color:var(--clr-text-secondary)">Saya: ' + escapeHtml(entry.ownerName || '-') + ' • Dibayar: ' + escapeHtml(entry.payerName || '-') + '</div></td>' +
        '<td class="text-right" data-label="Total"><strong>' + formatRupiah(entry.total) + '</strong></td>' +
        '<td class="text-right" data-label="Porsi Saya"><strong>' + formatRupiah(entry.ownerShare || 0) + '</strong></td>' +
        '<td data-label="Status Saya"><span class="split-ledger-status ' + doneClass + '">' + escapeHtml(doneText) + '</span></td>' +
        '<td data-label="Sync"><span class="split-ledger-sync ' + syncClass + '">' + escapeHtml(syncText) + '</span></td>' +
        '<td class="text-center" data-label="Aksi">' + actionHtml + '</td>';

      fragment.appendChild(tr);
    });

    splitLedgerTbody.appendChild(fragment);
  }

  // ─── Split Bill Event Listeners ───────────
  btnOpenSplit.addEventListener('click', openSplitModal);
  btnCloseSplit.addEventListener('click', closeSplitModal);

  splitOverlay.addEventListener('click', function (e) {
    if (e.target === splitOverlay) closeSplitModal();
  });

  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && splitOverlay.classList.contains('active')) {
      closeSplitModal();
    }
  });

  modeEqual.addEventListener('click', function () { setSplitMode('equal'); });
  modeCustom.addEventListener('click', function () { setSplitMode('custom'); });

  btnAddPerson.addEventListener('click', function () { addPersonRow(''); });

  btnCalculateSplit.addEventListener('click', calculateSplit);
  btnSaveSplit.addEventListener('click', saveSplitToLedger);

  btnBackSplit.addEventListener('click', function () {
    splitFormView.style.display = 'block';
    splitResultsView.style.display = 'none';
  });

  if (splitOwnerName) {
    splitOwnerName.addEventListener('input', function () {
      splitOwnerName.classList.remove('invalid');
    });
    splitOwnerName.addEventListener('change', persistProfileNameFromSplit);
    splitOwnerName.addEventListener('blur', persistProfileNameFromSplit);
  }

  if (splitLedgerTbody) {
    splitLedgerTbody.addEventListener('click', function (e) {
      var btn = e.target.closest('[data-split-action]');
      if (!btn) return;
      var action = btn.dataset.splitAction;
      var id = btn.dataset.id;
      if (action === 'sync' && id) {
        syncSplitLedgerToExpense(id);
      } else if (action === 'edit' && id) {
        startEditSplit(id);
      } else if (action === 'done' && id) {
        if (window.confirm('Tandai split bill ini sebagai selesai?')) {
          markSplitLedgerDone(id);
        }
      } else if (action === 'delete' && id) {
        if (window.confirm('Hapus split bill ini dari ledger?')) {
          deleteSplitLedgerEntry(id);
        }
      }
    });
  }

  // ─── Budget Modal Event Listeners ─────────
  btnEditBudget.addEventListener('click', function () {
    var b = getBudgetLimit();
    inputBudgetLimit.value = b ? b.toLocaleString('en-US') : '';
    budgetOverlay.classList.add('active');
  });

  btnCancelBudget.addEventListener('click', function () {
    budgetOverlay.classList.remove('active');
  });

  btnSaveBudget.addEventListener('click', function () {
    var val = Number(inputBudgetLimit.value.replace(/,/g, ''));
    saveBudgetLimit(val);
    budgetOverlay.classList.remove('active');
    updateHero();
    showToast('Batas bulanan berhasil disimpan', 'success');
  });

  budgetOverlay.addEventListener('click', function (e) {
    if (e.target === budgetOverlay) budgetOverlay.classList.remove('active');
  });

  if (btnEditCategoryBudget) {
    btnEditCategoryBudget.addEventListener('click', openCategoryBudgetModal);
  }

  if (btnCancelCategoryBudget) {
    btnCancelCategoryBudget.addEventListener('click', closeCategoryBudgetModal);
  }

  if (btnSaveCategoryBudget) {
    btnSaveCategoryBudget.addEventListener('click', saveCategoryBudgetFromEditor);
  }

  if (categoryBudgetOverlay) {
    categoryBudgetOverlay.addEventListener('click', function (e) {
      if (e.target === categoryBudgetOverlay) closeCategoryBudgetModal();
    });
  }
  
  // ─── Input Formatting ───────────────────
  function formatInputCurrency(e) {
    var value = e.target.value.replace(/\D/g, "");
    if (value !== "") {
      e.target.value = Number(value).toLocaleString('en-US');
    } else {
      e.target.value = "";
    }
  }

  inputAmount.addEventListener('input', formatInputCurrency);
  inputBudgetLimit.addEventListener('input', formatInputCurrency);
  splitTotal.addEventListener('input', formatInputCurrency);

  inputTitle.addEventListener('input', function(e) {
    var val = e.target.value.trim().toLowerCase();
    if (!val) return;
    
    var match = null;
    for (var i = expenses.length - 1; i >= 0; i--) {
      if (expenses[i].title.toLowerCase() === val) {
        match = expenses[i];
        break; // take latest
      }
    }

    if (match) {
      // auto-fill type
      var typeRadio = document.querySelector('input[name="input-type"][value="' + match.type + '"]');
      if (typeRadio) {
        typeRadio.checked = true;
      }
      // auto-fill wallet & category
      if (match.wallet) inputWallet.value = match.wallet;
      if (match.category) inputCategory.value = match.category;
    }
  });

  for (var i = 0; i < inputTypeRadios.length; i++) {
    inputTypeRadios[i].addEventListener('change', function(e) {
      if (e.target.value === 'transfer') {
        groupWalletTo.style.display = 'flex';
        groupCategory.style.display = 'none';
        labelWallet.textContent = 'Dari Dompet';
        inputCategory.removeAttribute('required');
        inputWalletTo.setAttribute('required', 'required');
        if (categoryHelp) categoryHelp.textContent = '';
        inputCategory.classList.remove('invalid');
      } else {
        groupWalletTo.style.display = 'none';
        groupCategory.style.display = 'flex';
        labelWallet.textContent = 'Sumber Dana';
        inputCategory.setAttribute('required', 'required');
        inputWalletTo.removeAttribute('required');
        if (walletToHelp) walletToHelp.textContent = '';
        inputWalletTo.classList.remove('invalid');
      }
    });
  }

  splitPersonList.addEventListener('input', function(e) {
    if (e.target.classList.contains('custom-amount')) {
      formatInputCurrency(e);
    }
    if (e.target.classList.contains('person-name-input')) {
      syncSplitPayerOptions();
    }
  });

  // ─── Custom Categories ────────────────────
  function loadCustomCategories() {
    try {
      var raw = localStorage.getItem(CUSTOM_CAT_KEY);
      customCategories = raw ? JSON.parse(raw) : [];
      
      var optExpense = document.getElementById('optgroup-expense');
      var optIncome = document.getElementById('optgroup-income');

      customCategories.forEach(function(cat) {
        CATEGORY_COLORS[cat.name] = cat.color;
        CATEGORY_ICONS[cat.name] = cat.icon;

        var opt = document.createElement('option');
        opt.value = cat.name;
        opt.textContent = cat.name;

        var filterOpt = opt.cloneNode(true);
        filterCategory.appendChild(filterOpt);

        if (cat.type === 'expense') {
          if(optExpense) optExpense.appendChild(opt);
        } else {
          if(optIncome) optIncome.appendChild(opt);
        }
      });
    } catch (e) {
      customCategories = [];
    }
  }

  function renderIconSelector() {
    iconSelector.innerHTML = '';
    AVAILABLE_ICONS.forEach(function(iconCls) {
      var btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'icon-btn';
      if (inputCustomCatIcon.value === iconCls) {
        btn.classList.add('selected');
      }
      btn.innerHTML = '<i class="ph-bold ' + iconCls + '"></i>';

      btn.addEventListener('click', function() {
        inputCustomCatIcon.value = iconCls;
        renderIconSelector(); // refresh selection state
      });

      iconSelector.appendChild(btn);
    });
  }

  if (btnAddCategory) {
    btnAddCategory.addEventListener('click', function() {
      if (!inputCustomCatIcon.value || inputCustomCatIcon.value === "") {
        inputCustomCatIcon.value = AVAILABLE_ICONS[0];
      }
      renderIconSelector();
      inputCustomCatName.value = '';
      categoryOverlay.classList.add('active');
    });
  }

  if (btnCancelCategory) {
    btnCancelCategory.addEventListener('click', function() {
      categoryOverlay.classList.remove('active');
    });
  }

  if (btnSaveCategory) {
    btnSaveCategory.addEventListener('click', function() {
      var catName = inputCustomCatName.value.trim();
      var catType = inputCustomCatType.value;
      var catIcon = inputCustomCatIcon.value;

      if (!catName) {
        showToast('Nama kategori tidak boleh kosong', 'error');
        return;
      }
      
      // Select a random color for this category
      var randIndex = Math.floor(Math.random() * AVAILABLE_COLORS.length);
      var catColor = AVAILABLE_COLORS[randIndex] || '#0ea5e9';
      
      var fullIconString = '<i class="ph-fill ' + catIcon + '"></i>';
      var newCat = {
        id: generateId(),
        name: catName,
        type: catType,
        icon: fullIconString,
        color: catColor
      };

      customCategories.push(newCat);
      saveCustomCategories();

      CATEGORY_COLORS[newCat.name] = newCat.color;
      CATEGORY_ICONS[newCat.name] = newCat.icon;

      var opt = document.createElement('option');
      opt.value = newCat.name;
      opt.textContent = newCat.name;

      var filterOpt = opt.cloneNode(true);
      filterCategory.appendChild(filterOpt);

      if (newCat.type === 'expense') {
        document.getElementById('optgroup-expense').appendChild(opt);
      } else {
        document.getElementById('optgroup-income').appendChild(opt);
      }

      inputCategory.value = newCat.name;
      categoryOverlay.classList.remove('active');
      renderCategoryBudgetSummary();
      if (categoryBudgetOverlay && categoryBudgetOverlay.classList.contains('active')) {
        renderCategoryBudgetEditor();
      }
      showToast('Kategori baru ditambahkan', 'success');
    });
  }

  var pendingRecurring = [];

  // ─── Automated Recurring Expenses ─────────
  function processRecurringExpenses() {
    var todayStr = getTodayString();
    var todayObj = new Date(todayStr);
    pendingRecurring = [];

    recurringExpenses.forEach(function(rec) {
      if (!rec.nextDate) return;
      var nextDateObj = new Date(rec.nextDate);
      
      while (nextDateObj <= todayObj) {
        pendingRecurring.push({
          recRef: rec,
          expenseData: {
            id: generateId(),
            type: rec.type,
            wallet: rec.wallet,
            date: nextDateObj.toISOString().split('T')[0],
            title: rec.title,
            category: rec.category,
            amount: rec.amount
          }
        });
        nextDateObj.setMonth(nextDateObj.getMonth() + 1);
      }
    });

    if (pendingRecurring.length > 0) {
      showRecurringPrompt();
    }
  }

  function showRecurringPrompt() {
    var recurringOverlay = document.getElementById('recurring-overlay');
    var recurringList = document.getElementById('recurring-list');
    var btnConfirm = document.getElementById('btn-confirm-recurring');
    var btnCancel = document.getElementById('btn-cancel-recurring');

    if (!recurringOverlay || !recurringList) return;

    recurringList.innerHTML = '';
    pendingRecurring.forEach(function(item) {
      var div = document.createElement('div');
      div.style.marginBottom = '8px';
      div.innerHTML = '<strong>' + escapeHtml(item.expenseData.title) + '</strong><br>' +
                      '<span style="font-size:0.8rem; opacity:0.8">' + formatDate(item.expenseData.date) + ' - ' + formatRupiah(item.expenseData.amount) + '</span>';
      recurringList.appendChild(div);
    });

    // Handle Confirm
    btnConfirm.onclick = function() {
      var updated = false;
      pendingRecurring.forEach(function(item) {
        expenses.push(item.expenseData);
        var currentNextDateObj = new Date(item.expenseData.date);
        currentNextDateObj.setMonth(currentNextDateObj.getMonth() + 1);
        item.recRef.nextDate = currentNextDateObj.toISOString().split('T')[0];
        updated = true;
      });
      if (updated) {
        saveToStorage();
        saveRecurringToStorage();
        renderTable();
        showToast('Tagihan otomatis berhasil dicatat!', 'success');
      }
      recurringOverlay.classList.remove('active');
    };

    // Handle Skip
    btnCancel.onclick = function() {
      var updated = false;
      pendingRecurring.forEach(function(item) {
        var currentNextDateObj = new Date(item.expenseData.date);
        currentNextDateObj.setMonth(currentNextDateObj.getMonth() + 1);
        item.recRef.nextDate = currentNextDateObj.toISOString().split('T')[0];
        updated = true;
      });
      if (updated) {
        saveRecurringToStorage();
      }
      recurringOverlay.classList.remove('active');
    };

    recurringOverlay.classList.add('active');
  }

  // ─── Goal Tracking (Tabungan Impian) ─────
  function renderGoals() {
    if (!goalListEl) return;
    goalListEl.innerHTML = '';
    
    // Calculate current amounts for each goal based on transfer transactions
    var goalBalances = {};
    expenses.forEach(function(e) {
      if (e.type === 'transfer' && e.walletTo && e.walletTo.startsWith('Goal-')) {
        var gid = e.walletTo.replace('Goal-', '');
        goalBalances[gid] = (goalBalances[gid] || 0) + e.amount;
      }
    });

    if (goals.length === 0) {
      goalListEl.innerHTML =
        '<div class="goal-empty">Belum ada tabungan impian.' +
        '<span class="goal-empty-hint">Buat goal baru untuk mulai menabung.</span>' +
        '</div>';
      return;
    }

    goals.forEach(function(g) {
      var current = goalBalances[g.id] || 0;
      var safeTarget = g.target > 0 ? g.target : 1;
      var pctValue = Math.min((current / safeTarget) * 100, 100);
      var pct = pctValue.toFixed(1);
      
      var card = document.createElement('article');
      card.className = 'goal-item';
      
      card.innerHTML = 
        '<div class="goal-item-header">' +
          '<div class="goal-item-name">' + escapeHtml(g.name) + '</div>' +
          '<div class="goal-item-amount">' + formatRupiah(current) + ' / ' + formatRupiah(g.target) + '</div>' +
        '</div>' +
        '<div class="goal-progress-track">' +
          '<div class="goal-progress-fill" style="width: ' + pct + '%;"></div>' +
        '</div>' +
        '<div class="goal-item-footer">' +
          '<div class="goal-progress-label">' + pct + '% Tercapai</div>' +
          '<div class="goal-action-group">' +
            '<button class="btn btn-sm btn-ghost btn-fund-goal" data-id="' + g.id + '" type="button"><i class="ph-bold ph-piggy-bank"></i> Isi Dana</button>' +
            '<button class="btn btn-sm btn-ghost btn-del-goal" data-id="' + g.id + '" type="button" aria-label="Hapus goal"><i class="ph-bold ph-trash"></i></button>' +
          '</div>' +
        '</div>';
      
      goalListEl.appendChild(card);
    });

    var fundBtns = goalListEl.querySelectorAll('.btn-fund-goal');
    fundBtns.forEach(function(b) {
      b.addEventListener('click', function() {
        var gid = this.dataset.id;
        var goal = goals.find(function(g) { return g.id === gid; });
        if(goal) {
          inputGoalFundId.value = gid;
          goalFundSubtitle.textContent = 'Menabung untuk: ' + goal.name;
          inputGoalFundAmount.value = '';
          goalFundOverlay.classList.add('active');
        }
      });
    });

    var delBtns = goalListEl.querySelectorAll('.btn-del-goal');
    delBtns.forEach(function(b) {
      b.addEventListener('click', function() {
        var gid = this.dataset.id;
        if(confirm('Hapus tabungan impian ini? (Dana yang sudah dialokasikan tidak akan kembali ke dompet secara otomatis)')) {
          goals = goals.filter(function(g) { return g.id !== gid; });
          saveGoalsToStorage();
          renderGoals();
          showToast('Tabungan impian dihapus', 'info');
        }
      });
    });
  }

  if (btnAddGoal) {
    btnAddGoal.addEventListener('click', function() {
      inputGoalName.value = '';
      inputGoalTarget.value = '';
      goalAddOverlay.classList.add('active');
    });
  }

  if (btnCancelGoal) {
    btnCancelGoal.addEventListener('click', function() {
      goalAddOverlay.classList.remove('active');
    });
  }

  if (btnSaveGoal) {
    btnSaveGoal.addEventListener('click', function() {
      var name = inputGoalName.value.trim();
      var target = Number(inputGoalTarget.value.replace(/,/g, ''));
      if (!name || !target) {
        showToast('Lengkapi nama dan target dana', 'error');
        return;
      }
      
      goals.push({ id: generateId(), name: name, target: target });
      saveGoalsToStorage();
      renderGoals();
      goalAddOverlay.classList.remove('active');
      showToast('Tabungan impian ditambahkan', 'success');
    });
  }

  if (btnCancelGoalFund) {
    btnCancelGoalFund.addEventListener('click', function() {
      goalFundOverlay.classList.remove('active');
    });
  }

  if (btnSaveGoalFund) {
    btnSaveGoalFund.addEventListener('click', function() {
      var gid = inputGoalFundId.value;
      var amt = Number(inputGoalFundAmount.value.replace(/,/g, ''));
      var src = inputGoalFundSource.value;
      
      if (!amt || amt <= 0) {
        showToast('Nominal tidak valid', 'error');
        return;
      }
      
      var goal = goals.find(function(g) { return g.id === gid; });
      if(!goal) return;

      var data = {
        id: generateId(),
        type: 'transfer',
        wallet: src,
        walletTo: 'Goal-' + gid,
        date: getTodayString(),
        title: 'Tabungan: ' + goal.name,
        category: 'Transfer',
        amount: amt
      };
      
      expenses.push(data);
      saveToStorage();
      renderTable();
      renderGoals();
      
      goalFundOverlay.classList.remove('active');
      showToast('Dana berhasil dialokasikan', 'success');
    });
  }
  
  if (inputGoalTarget) inputGoalTarget.addEventListener('input', formatInputCurrency);
  if (inputGoalFundAmount) inputGoalFundAmount.addEventListener('input', formatInputCurrency);

  // ─── Init ─────────────────────────────────
  function init() {
    loadRecurringFromStorage();
    expenses = getFromStorage(); // Must load expenses before processing recurring
    loadGoalsFromStorage();
    loadWallets();
    loadTemplates();
    loadProfileFromStorage();
    processRecurringExpenses();
    renderCalendar();
    isPerfLite = detectPerfLite(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches);
    applyPerformanceMode(isPerfLite);
    
    setTheme(getTheme());
    loadCustomCategories();
    loadCategoryBudgets();
    inputDate.value = getTodayString();
    inputDate.max = getTodayString();
    loadFilters();
    updateUndoIndicator();
    loadSplitHistory();
    renderSplitLedgerTable();
    initVisualEffects();
    renderTable();
    renderGoals();
    renderWalletDropdowns();
    renderTemplateStrip();

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./service-worker.js').then(function(reg) {
          console.log('ServiceWorker registration successful with scope: ', reg.scope);
        }).catch(function(err) {
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
  }

  init();
})();
    </script>
    <script>
      (function () {
        'use strict';

        var VIEW_KEY = 'expense_tracker_active_view';
        var VALID_VIEWS = ['dashboard', 'add', 'history', 'report', 'tools'];
        var sections = Array.prototype.slice.call(document.querySelectorAll('.container > section[data-view]'));
        var navButtons = Array.prototype.slice.call(document.querySelectorAll('[data-nav-view]'));
        var fabAdd = document.getElementById('fab-add');
        var inputTitle = document.getElementById('input-title');
        var btnEditCategoryBudgetEmpty = document.getElementById('btn-edit-category-budget-empty');
        var btnEditCategoryBudget = document.getElementById('btn-edit-category-budget');
        var btnOpenSplitEmpty = document.getElementById('btn-open-split-empty');
        var btnOpenSplit = document.getElementById('btn-open-split');

        function isValidView(view) {
          return VALID_VIEWS.indexOf(view) !== -1;
        }

        function setActiveView(view, shouldFocus) {
          if (!isValidView(view)) view = 'dashboard';

          sections.forEach(function (section) {
            var active = section.getAttribute('data-view') === view;
            section.classList.toggle('is-active', active);
            section.setAttribute('aria-hidden', active ? 'false' : 'true');
          });

          navButtons.forEach(function (btn) {
            var activeBtn = btn.getAttribute('data-nav-view') === view;
            btn.classList.toggle('is-active', activeBtn);
            btn.setAttribute('aria-selected', activeBtn ? 'true' : 'false');
          });

          try {
            localStorage.setItem(VIEW_KEY, view);
          } catch (e) {
            // ignore
          }

          if (shouldFocus && view === 'add' && inputTitle) {
            setTimeout(function () {
              inputTitle.focus();
            }, 120);
          }
        }

        navButtons.forEach(function (btn) {
          btn.addEventListener('click', function () {
            setActiveView(btn.getAttribute('data-nav-view'), btn.getAttribute('data-nav-view') === 'add');
          });
        });

        if (fabAdd) {
          fabAdd.addEventListener('click', function () {
            setActiveView('add', true);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          });
        }

        document.addEventListener('click', function (e) {
          var navTargetBtn = e.target.closest('[data-nav-target]');
          if (navTargetBtn) {
            var targetView = navTargetBtn.getAttribute('data-nav-target');
            setActiveView(targetView, targetView === 'add');
            if (targetView === 'add') {
              window.scrollTo({ top: 0, behavior: 'smooth' });
            }
          }
        });

        if (btnEditCategoryBudgetEmpty && btnEditCategoryBudget) {
          btnEditCategoryBudgetEmpty.addEventListener('click', function () {
            btnEditCategoryBudget.click();
          });
        }

        if (btnOpenSplitEmpty && btnOpenSplit) {
          btnOpenSplitEmpty.addEventListener('click', function () {
            btnOpenSplit.click();
          });
        }

        function parseCurrency(value) {
          var numeric = String(value || '').replace(/[^0-9-]/g, '');
          return Number(numeric || 0);
        }

        function formatRupiah(value) {
          return 'Rp ' + Number(value || 0).toLocaleString('id-ID');
        }

        function animateCurrency(el, targetValue, options) {
          if (!el) return;
          options = options || {};
          var duration = options.duration || 420;
          var formatter = options.formatter || formatRupiah;

          var currentRaw = Number(el.getAttribute('data-anim-value'));
          if (!Number.isFinite(currentRaw)) {
            currentRaw = parseCurrency(el.textContent);
          }

          if (currentRaw === targetValue) {
            el.textContent = formatter(targetValue);
            el.setAttribute('data-anim-value', String(targetValue));
            return;
          }

          var start = currentRaw;
          var startTime = null;

          function tick(ts) {
            if (!startTime) startTime = ts;
            var progress = Math.min((ts - startTime) / duration, 1);
            var eased = 1 - Math.pow(1 - progress, 3);
            var now = Math.round(start + (targetValue - start) * eased);
            el.textContent = formatter(now);
            el.setAttribute('data-anim-value', String(now));
            if (progress < 1) {
              requestAnimationFrame(tick);
            } else {
              el.textContent = formatter(targetValue);
              el.setAttribute('data-anim-value', String(targetValue));
            }
          }

          requestAnimationFrame(tick);
        }

        var reportIncomeEl = document.getElementById('report-income');
        var reportExpenseEl = document.getElementById('report-expense');
        var dashboardIncomeEl = document.getElementById('dashboard-income');
        var dashboardExpenseEl = document.getElementById('dashboard-expense');
        var dashboardNetEl = document.getElementById('dashboard-net');

        function syncDashboardMonthlyStats() {
          if (!reportIncomeEl || !reportExpenseEl || !dashboardIncomeEl || !dashboardExpenseEl || !dashboardNetEl) {
            return;
          }
          var income = parseCurrency(reportIncomeEl.textContent);
          var expense = parseCurrency(reportExpenseEl.textContent);
          var net = income - expense;

          animateCurrency(dashboardIncomeEl, income);
          animateCurrency(dashboardExpenseEl, expense);
          animateCurrency(dashboardNetEl, net);

          dashboardNetEl.classList.remove('summary-value-income', 'summary-value-expense');
          dashboardNetEl.classList.add(net >= 0 ? 'summary-value-income' : 'summary-value-expense');
        }

        if (reportIncomeEl && reportExpenseEl) {
          var monthlyObserver = new MutationObserver(syncDashboardMonthlyStats);
          monthlyObserver.observe(reportIncomeEl, { childList: true, characterData: true, subtree: true });
          monthlyObserver.observe(reportExpenseEl, { childList: true, characterData: true, subtree: true });
        }

        var totalBalanceEl = document.getElementById('total-balance');
        var isBalanceAnimating = false;
        if (totalBalanceEl) {
          var balanceObserver = new MutationObserver(function () {
            if (isBalanceAnimating) return;
            var target = parseCurrency(totalBalanceEl.textContent);
            isBalanceAnimating = true;
            animateCurrency(totalBalanceEl, target, {
              duration: 480,
              formatter: formatRupiah,
            });
            setTimeout(function () {
              isBalanceAnimating = false;
            }, 520);
          });
          balanceObserver.observe(totalBalanceEl, { childList: true, characterData: true, subtree: true });
        }

        var recentList = document.getElementById('recent-list');
        var recentEmpty = document.getElementById('recent-empty');

        function formatDate(dateStr) {
          if (!dateStr) return '-';
          var d = new Date(dateStr + 'T00:00:00');
          if (isNaN(d.getTime())) return dateStr;
          return d.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
        }

        function sortByRecent(a, b) {
          var dateCmp = String(b.date || '').localeCompare(String(a.date || ''));
          if (dateCmp !== 0) return dateCmp;
          return String(b.id || '').localeCompare(String(a.id || ''));
        }

        function renderRecentTransactions() {
          if (!recentList || !recentEmpty) return;

          var data = [];
          try {
            data = JSON.parse(localStorage.getItem('expense_tracker_data') || '[]');
            if (!Array.isArray(data)) data = [];
          } catch (e) {
            data = [];
          }

          data.sort(sortByRecent);
          var recent = data.slice(0, 5);

          recentList.innerHTML = '';
          if (!recent.length) {
            recentEmpty.style.display = 'block';
            return;
          }

          recentEmpty.style.display = 'none';
          recent.forEach(function (item) {
            var row = document.createElement('div');
            row.className = 'recent-row';
            var isIncome = item.type === 'income';
            var isTransfer = item.type === 'transfer';
            var amountPrefix = isIncome ? '+' : (isTransfer ? '↔ ' : '-');
            var amountClass = isIncome ? 'text-success' : (isTransfer ? 'text-accent' : 'text-danger');

            row.innerHTML =
              '<div class="recent-row-main">' +
                '<div class="recent-row-title">' + String(item.title || '-') + '</div>' +
                '<div class="recent-row-meta">' + formatDate(item.date) + ' • ' + String(item.category || '-') + '</div>' +
              '</div>' +
              '<div class="recent-row-amount ' + amountClass + '">' + amountPrefix + formatRupiah(item.amount || 0) + '</div>';
            recentList.appendChild(row);
          });
        }

        var expenseTbody = document.getElementById('expense-tbody');
        if (expenseTbody) {
          var recentObserver = new MutationObserver(function () {
            renderRecentTransactions();
          });
          recentObserver.observe(expenseTbody, { childList: true, subtree: true });
        }

        var form = document.getElementById('expense-form');
        var btnCancel = document.getElementById('btn-cancel');
        var pendingRowHighlight = false;
        if (form) {
          form.addEventListener(
            'submit',
            function () {
              var isEdit = btnCancel && btnCancel.style.display !== 'none';
              pendingRowHighlight = !isEdit;
            },
            true
          );
        }

        if (expenseTbody) {
          var rowObserver = new MutationObserver(function () {
            if (!pendingRowHighlight) return;
            var firstRow = expenseTbody.querySelector('tr');
            if (!firstRow) return;
            firstRow.classList.add('row-new');
            setTimeout(function () {
              firstRow.classList.remove('row-new');
            }, 2300);
            pendingRowHighlight = false;
          });
          rowObserver.observe(expenseTbody, { childList: true });
        }

        function setButtonLoading(button, loadingText, ms) {
          if (!button || button.dataset.loading === '1') return;
          button.dataset.loading = '1';
          button.dataset.originalHtml = button.innerHTML;
          button.disabled = true;
          button.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span> ' + loadingText;
          setTimeout(function () {
            button.disabled = false;
            button.innerHTML = button.dataset.originalHtml || button.innerHTML;
            button.dataset.loading = '0';
          }, ms || 900);
        }

        var btnExportCsv = document.getElementById('btn-export-csv');
        var btnExportJson = document.getElementById('btn-export-json');
        var btnConfirmImport = document.getElementById('btn-confirm-import');

        if (btnExportCsv) {
          btnExportCsv.addEventListener('click', function () {
            setButtonLoading(btnExportCsv, 'Export...', 850);
          });
        }

        if (btnExportJson) {
          btnExportJson.addEventListener('click', function () {
            setButtonLoading(btnExportJson, 'Export...', 850);
          });
        }

        if (btnConfirmImport) {
          btnConfirmImport.addEventListener('click', function () {
            setButtonLoading(btnConfirmImport, 'Import...', 1200);
          });
        }

        var inputTypeRadios = Array.prototype.slice.call(document.querySelectorAll('input[name="input-type"]'));
        var groupWalletTo = document.getElementById('group-wallet-to');
        var groupCategory = document.getElementById('group-category');
        var inputCategory = document.getElementById('input-category');
        var optgroupExpense = document.getElementById('optgroup-expense');
        var optgroupIncome = document.getElementById('optgroup-income');

        function firstEnabledValue(group) {
          if (!group) return '';
          var options = Array.prototype.slice.call(group.querySelectorAll('option'));
          var first = options.find(function (opt) {
            return !opt.disabled;
          });
          return first ? first.value : '';
        }

        function syncConditionalFields() {
          var selected = document.querySelector('input[name="input-type"]:checked');
          var type = selected ? selected.value : 'expense';
          var isTransfer = type === 'transfer';

          if (groupWalletTo) {
            groupWalletTo.setAttribute('data-collapsed', isTransfer ? 'false' : 'true');
          }
          if (groupCategory) {
            groupCategory.setAttribute('data-collapsed', isTransfer ? 'true' : 'false');
          }

          if (!optgroupExpense || !optgroupIncome || !inputCategory) {
            return;
          }

          var expenseOptions = Array.prototype.slice.call(optgroupExpense.querySelectorAll('option'));
          var incomeOptions = Array.prototype.slice.call(optgroupIncome.querySelectorAll('option'));

          if (type === 'expense') {
            expenseOptions.forEach(function (opt) { opt.disabled = false; });
            incomeOptions.forEach(function (opt) { opt.disabled = true; });
          } else if (type === 'income') {
            expenseOptions.forEach(function (opt) { opt.disabled = true; });
            incomeOptions.forEach(function (opt) { opt.disabled = false; });
          } else {
            expenseOptions.forEach(function (opt) { opt.disabled = false; });
            incomeOptions.forEach(function (opt) { opt.disabled = false; });
          }

          if (!isTransfer) {
            var selectedOption = inputCategory.options[inputCategory.selectedIndex];
            if (!selectedOption || selectedOption.disabled) {
              inputCategory.value = type === 'income' ? firstEnabledValue(optgroupIncome) : firstEnabledValue(optgroupExpense);
            }
          }
        }

        inputTypeRadios.forEach(function (radio) {
          radio.addEventListener('change', function () {
            setTimeout(syncConditionalFields, 0);
          });
        });

        var btnCancelEdit = document.getElementById('btn-cancel');
        if (btnCancelEdit) {
          btnCancelEdit.addEventListener('click', function () {
            setTimeout(syncConditionalFields, 0);
          });
        }

        if (form) {
          form.addEventListener('submit', function () {
            setTimeout(syncConditionalFields, 40);
          });
        }

        if (expenseTbody) {
          expenseTbody.addEventListener('click', function (e) {
            var editBtn = e.target.closest('[data-action=\"edit\"]');
            if (editBtn) {
              setTimeout(syncConditionalFields, 10);
            }
          });
        }

        if (inputTitle) {
          inputTitle.addEventListener('input', function () {
            setTimeout(syncConditionalFields, 0);
          });
        }

        var goalList = document.getElementById('goal-list');
        if (goalList) {
          var goalObserver = new MutationObserver(function () {
            var emptyNode = goalList.querySelector('.goal-empty');
            if (!emptyNode || emptyNode.getAttribute('data-enhanced') === '1') return;
            emptyNode.setAttribute('data-enhanced', '1');
            emptyNode.innerHTML =
              '<svg class="empty-svg" viewBox="0 0 120 120" fill="none" aria-hidden="true">' +
                '<circle cx="60" cy="60" r="36" stroke="currentColor" stroke-width="4"></circle>' +
                '<path d="M60 32v20l14 14" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>' +
              '</svg>' +
              '<p class="empty-title">Belum ada tabungan impian</p>' +
              '<p class="empty-text">Buat goal baru untuk mulai menabung secara konsisten.</p>' +
              '<button class="btn btn-primary" type="button" id="btn-empty-create-goal">Buat Goal</button>';

            var trigger = document.getElementById('btn-empty-create-goal');
            var addGoalBtn = document.getElementById('btn-add-goal');
            if (trigger && addGoalBtn) {
              trigger.addEventListener('click', function () {
                addGoalBtn.click();
              });
            }
          });
          goalObserver.observe(goalList, { childList: true, subtree: true });
        }

        var initialView = 'dashboard';
        try {
          var stored = localStorage.getItem(VIEW_KEY);
          if (isValidView(stored)) {
            initialView = stored;
          }
        } catch (e) {
          initialView = 'dashboard';
        }

        setActiveView(initialView, false);
        syncConditionalFields();
        syncDashboardMonthlyStats();
        renderRecentTransactions();
      })();
    </script>
  </body>
</html>
